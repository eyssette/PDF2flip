let screenWidth=window.innerWidth,screenHeight=window.innerHeight;function debounce(e,t){let i;return function(...n){clearTimeout(i),i=setTimeout((()=>e.apply(this,n)),t)}}const debounceZoom=debounce((function(e,t){this.zoom(e,t)}),30);function getDeltaPercentage(e,t,i){return{x:(e.x-t/2)/t*100,y:(e.y-i/2)/i*100}}let distanceTouches=0;function getTouchesDistance(e){if(e.length<2)return 0;let t=e[0],i=e[1],n=i.clientX-t.clientX,a=i.clientY-t.clientY;return Math.sqrt(n*n+a*a)}function getPinchCenter(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}!function(){var e={101:function(){function e(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}!function(){var t,i,n=n||(t=[],{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e){if(0===t.length)return!1;var i=0;for(e=null!=e?e:window.performance.now();i<t.length;)t[i].update(e)?i++:t.splice(i,1);return!0}});n.Tween=function(t){var i=t,a={},o={},s={},r=1e3,l=0,h=!1,u=!1,p=!1,c=0,d=null,f=n.Easing.Linear.None,g=n.Interpolation.Linear,v=[],m=null,y=!1,b=null,w=null,P=null;for(var S in t)a[S]=parseFloat(t[S],10);this.to=function(e,t){return null!=t&&(r=t),o=e,this},this.start=function(t){for(var r in n.add(this),u=!0,y=!1,d=null!=t?t:window.performance.now(),d+=c,o){if(e(o[r],Array)){if(0===o[r].length)continue;o[r]=[i[r]].concat(o[r])}null!=a[r]&&(a[r]=i[r],!1===e(a[r],Array)&&(a[r]*=1),s[r]=a[r]||0)}return this},this.stop=function(){return u?(n.remove(this),u=!1,null!=P&&P.call(i),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=v.length;e<t;e++)v[e].stop()},this.complete=function(){return u?(n.remove(this),u=!1,null!=w&&w.call(i),this.completeChainedTweens(),this):this},this.completeChainedTweens=function(){for(var e=0,t=v.length;e<t;e++)v[e].complete()},this.delay=function(e){return c=e,this},this.repeat=function(e){return l=e,this},this.yoyo=function(e){return h=e,this},this.easing=function(e){return f=null==e?f:e,this},this.interpolation=function(e){return g=e,this},this.chain=function(){return v=arguments,this},this.onStart=function(e){return m=e,this},this.onUpdate=function(e){return b=e,this},this.onComplete=function(e){return w=e,this},this.onStop=function(e){return P=e,this},this.update=function(t){var n,u,P;if(t<d)return!0;for(n in!1===y&&(null!=m&&m.call(i),y=!0),P=f(u=(u=(t-d)/r)>1?1:u),o)if(null!=a[n]){var S=a[n]||0,x=o[n];e(x,Array)?i[n]=g(x,P):("string"==typeof x&&(x=x.startsWith("+")||x.startsWith("-")?S+parseFloat(x,10):parseFloat(x,10)),"number"==typeof x&&(i[n]=S+(x-S)*P))}if(null!=b&&b.call(i,P),1===u){if(l>0){for(n in isFinite(l)&&l--,s){if("string"==typeof o[n]&&(s[n]=s[n]+parseFloat(o[n],10)),h){var C=s[n];s[n]=o[n],o[n]=C}a[n]=s[n]}return h&&(p=!p),d=t+c,!0}null!=w&&w.call(i);for(var T=0,E=v.length;T<E;T++)v[T].start(d+r);return!1}return!0}},n.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}},n.Interpolation={Linear:function(e,t){var i=e.length-1,a=i*t,o=Math.floor(a),s=n.Interpolation.Utils.Linear;return t<0?s(e[0],e[1],a):t>1?s(e[i],e[i-1],i-a):s(e[o],e[o+1>i?i:o+1],a-o)},Bezier:function(e,t){for(var i=0,a=e.length-1,o=Math.pow,s=n.Interpolation.Utils.Bernstein,r=0;r<=a;r++)i+=o(1-t,a-r)*o(t,r)*e[r]*s(a,r);return i},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=n.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(i=[1],function(e){var t=1;if(i[e])return i[e];for(var n=e;n>1;n--)t*=n;return i[e]=t,t}),CatmullRom:function(e,t,i,n,a){var o=.5*(i-e),s=.5*(n-t),r=a*a;return(2*t-2*i+o+s)*(a*r)+(-3*t+3*i-2*o-s)*r+o*a+t}}},window.TWEEN=n}()}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.amdO={},function(){"use strict";var e={jQuery:jQuery,version:"2.3.53",autoDetectLocation:!0,slug:void 0,locationVar:"dearViewerLocation",locationFile:void 0,MOUSE_CLICK_ACTIONS:{NONE:"none",NAV:"nav"},ARROW_KEYS_ACTIONS:{NONE:"none",NAV:"nav"},MOUSE_DBL_CLICK_ACTIONS:{NONE:"none",ZOOM:"zoom"},MOUSE_SCROLL_ACTIONS:{NONE:"none",ZOOM:"zoom",NAV:"nav"},PAGE_SCALE:{PAGE_FIT:"fit",PAGE_WIDTH:"width",AUTO:"auto",ACTUAL:"actual",MANUAL:"manual"},READ_DIRECTION:{LTR:"ltr",RTL:"rtl"},TURN_DIRECTION:{LEFT:"left",RIGHT:"right",NONE:"none"},INFO_TYPE:{INFO:"info",ERROR:"error"},FLIPBOOK_PAGE_MODE:{SINGLE:"single",DOUBLE:"double",AUTO:"auto"},FLIPBOOK_SINGLE_PAGE_MODE:{ZOOM:"zoom",BOOKLET:"booklet",AUTO:"auto"},FLIPBOOK_PAGE_SIZE:{AUTO:"auto",SINGLE:"single",DOUBLE_INTERNAL:"dbl_int",DOUBLE:"dbl",DOUBLE_COVER_BACK:"dbl_cover_back"},LINK_TARGET:{NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4},CONTROLS_POSITION:{HIDDEN:"hidden",TOP:"top",BOTTOM:"bottom"},TURN_CORNER:{TL:"tl",TR:"tr",BL:"bl",BR:"br",L:"l",R:"r",NONE:"none"},REQUEST_STATUS:{OFF:"none",ON:"pending",COUNT:"counting"},TEXTURE_TARGET:{THUMB:0,VIEWER:1,ZOOM:2},FLIPBOOK_CENTER_SHIFT:{RIGHT:1,LEFT:-1,NONE:0},FLIPBOOK_COVER_TYPE:{NONE:"none",PLAIN:"plain",BASIC:"basic",RIDGE:"ridge"}};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function n(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,i){if(!e)return;if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,i)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}e._defaults={is3D:!0,has3DShadow:!0,color3DCover:"#aaaaaa",color3DSheets:"#fff",cover3DType:e.FLIPBOOK_COVER_TYPE.NONE,flexibility:.9,drag3D:!1,height:"auto",autoOpenOutline:!1,autoOpenThumbnail:!1,showDownloadControl:!0,showSearchControl:!0,showPrintControl:!0,enableSound:!0,duration:800,pageRotation:0,flipbook3DTiltAngleUp:0,flipbook3DTiltAngleLeft:0,readDirection:e.READ_DIRECTION.LTR,pageMode:e.FLIPBOOK_PAGE_MODE.AUTO,singlePageMode:e.FLIPBOOK_SINGLE_PAGE_MODE.AUTO,flipbookFitPages:!1,backgroundColor:"transparent",flipbookHardPages:"none",openPage:1,annotationClass:"",maxTextureSize:3200,minTextureSize:256,rangeChunkSize:524288,disableAutoFetch:!0,disableStream:!0,disableFontFace:!1,icons:{altnext:"df-icon-arrow-right1",altprev:"df-icon-arrow-left1",next:"df-icon-arrow-right1",prev:"df-icon-arrow-left1",end:"df-icon-last-page",start:"df-icon-first-page",share:"df-icon-share","outline-open":"df-icon-arrow-right","outline-close":"df-icon-arrow-down",help:"df-icon-help",more:"df-icon-more",download:"df-icon-download",zoomin:"df-icon-add-circle",zoomout:"df-icon-minus-circle",resetzoom:"df-icon-minus-circle",fullscreen:"df-icon-fullscreen","fullscreen-off":"df-icon-fit-screen",fitscreen:"df-icon-fit-screen",thumbnail:"df-icon-grid-view",outline:"df-icon-list",close:"df-icon-close",doublepage:"df-icon-double-page",singlepage:"df-icon-file",print:"df-icon-print",play:"df-icon-play",pause:"df-icon-pause",search:"df-icon-search",sound:"df-icon-volume","sound-off":"df-icon-volume",facebook:"df-icon-facebook",google:"df-icon-google",twitter:"df-icon-twitter",whatsapp:"df-icon-whatsapp",linkedin:"df-icon-linkedin",pinterest:"df-icon-pinterest",mail:"df-icon-mail"},text:{toggleSound:"Turn on/off Sound",toggleThumbnails:"Toggle Thumbnails",toggleOutline:"Toggle Outline/Bookmark",previousPage:"Previous Page",nextPage:"Next Page",toggleFullscreen:"Toggle Fullscreen",zoomIn:"Zoom In",zoomOut:"Zoom Out",resetZoom:"Reset Zoom",pageFit:"Fit Page",widthFit:"Fit Width",toggleHelp:"Toggle Help",search:"Search in PDF",singlePageMode:"Single Page Mode",doublePageMode:"Double Page Mode",downloadPDFFile:"Download PDF File",gotoFirstPage:"Goto First Page",gotoLastPage:"Goto Last Page",print:"Print",play:"Start AutoPlay",pause:"Pause AutoPlay",share:"Share",close:"Close",mailSubject:"Check out this FlipBook",mailBody:"Check out this site {{url}}",loading:"Loading",thumbTitle:"Thumbnails",outlineTitle:"Table of Contents",searchTitle:"Search",searchPlaceHolder:"Search",analyticsEventCategory:"DearFlip",analyticsViewerReady:"Document Ready",analyticsViewerOpen:"Document Opened",analyticsViewerClose:"Document Closed",analyticsFirstPageChange:"First Page Changed"},share:{facebook:"https://www.facebook.com/sharer/sharer.php?u={{url}}&t={{mailsubject}}",twitter:"https://twitter.com/share?url={{url}}&text={{mailsubject}}",mail:void 0,whatsapp:"https://api.whatsapp.com/send/?text={{mailsubject}}+{{url}}&type=custom_url&app_absent=0",linkedin:"https://www.linkedin.com/shareArticle?url={{url}}&title={{mailsubject}}",pinterest:"https://www.pinterest.com/pin/create/button/?url={{url}}&media=&description={{mailsubject}}"},allControls:"altPrev,pageNumber,altNext,play,outline,thumbnail,zoomIn,zoomOut,zoom,fullScreen,share,download,search,pageMode,startPage,endPage,sound,search,print,more",moreControls:"download,pageMode,pageFit,startPage,endPage,sound",leftControls:"outline,thumbnail",rightControls:"fullScreen,share,download,more",hideControls:"",hideShareControls:"",controlsPosition:e.CONTROLS_POSITION.BOTTOM,paddingTop:20,paddingLeft:15,paddingRight:15,paddingBottom:20,enableAnalytics:!1,zoomRatio:2,maxDPI:2,fakeZoom:1,pageScale:e.PAGE_SCALE.PAGE_FIT,controlsFloating:!0,sideMenuOverlay:!0,enableAnnotation:!0,enableAutoLinks:!0,arrowKeysAction:e.ARROW_KEYS_ACTIONS.NAV,clickAction:e.MOUSE_CLICK_ACTIONS.NAV,dblClickAction:e.MOUSE_DBL_CLICK_ACTIONS.NONE,mouseScrollAction:e.MOUSE_SCROLL_ACTIONS.NONE,linkTarget:e.LINK_TARGET.BLANK,soundFile:"sound/turn2.mp3",imagesLocation:"images",imageResourcesPath:"images/pdfjs/",popupThumbPlaceholder:"data:image/svg+xml,"+escape('<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 210 297"><rect width="210" height="297" style="fill:#f1f2f2"/><circle cx="143" cy="95" r="12" style="fill:#e3e8ed"/><polygon points="131 138 120 149 95 124 34 184 176 185 131 138" style="fill:#e3e8ed"/></svg>'),cMapUrl:"js/libs/cmaps/",logo:"",logoUrl:"",sharePrefix:"",pageSize:e.FLIPBOOK_PAGE_SIZE.AUTO,backgroundImage:"",pixelRatio:window.devicePixelRatio||1,spotLightIntensity:.22,ambientLightColor:"#fff",ambientLightIntensity:.8,shadowOpacity:.1,slug:void 0,headerElementSelector:void 0,onReady:function(e){},onPageChanged:function(e){},beforePageChanged:function(e){},onCreate:function(e){},onCreateUI:function(e){},onFlip:function(e){},beforeFlip:function(e){},autoPDFLinktoViewer:!1,autoLightBoxFullscreen:!1,thumbLayout:"book-title-hover",cleanupAfterRender:!0,canvasWillReadFrequently:!0,providerType:"pdf",loadMoreCount:-1,autoPlay:!1,autoPlayDuration:1e3,autoPlayStart:!1,popupBackGroundColor:"#eee",mockupMode:!1,instantTextureProcess:!1,cachePDFTexture:!1,pdfVersion:"default"},e.defaults={},e.jQuery.extend(!0,e.defaults,e._defaults),e.viewers={},e.providers={},e.openFileOptions={},e.executeCallback=function(){};var a,o,s=e,r=e.jQuery,l="WebKitCSSMatrix"in window||document.body&&"MozPerspective"in document.body.style,h="onmousedown"in window,u=s.utils={mouseEvents:h?{type:"mouse",start:"mousedown",move:"mousemove",end:"mouseup"}:{type:"touch",start:"touchstart",move:"touchmove",end:"touchend"},html:{div:"<div></div>",a:"<a>",input:"<input type='text'/>",select:"<select></select>"},getSharePrefix:function(){return u.getSharePrefixes()[0]},getSharePrefixes:function(){return(s.defaults.sharePrefix+",dflip-,flipbook-,dearflip-,dearpdf-").split(",").map((function(e){return e.trim()}))},toRad:function(e){return e*Math.PI/180},toDeg:function(e){return 180*e/Math.PI},ifdef:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null==e?t:e},createBtn:function(e,t,i){var n=r(u.html.div,{class:"df-ui-btn df-ui-"+e,title:i,html:void 0!==i?"<span>"+i+"</span>":""});return void 0!==t&&t.indexOf("<svg")>-1?n.html(t.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg" ')):n.addClass(t),n},transition:function(e,t){return e?t/1e3+"s ease-out":"0s none"},display:function(e){return e?"block":"none"},resetTranslate:function(){return u.translateStr(0,0)},bgImage:function(e){return null==e||"blank"===e?"":' url("'+e+'")'},translateStr:function(e,t){return l?" translate3d("+e+"px,"+t+"px, 0px) ":" translate("+e+"px, "+t+"px) "},httpsCorrection:function(e){try{if(null==e)return null;if("string"!=typeof e)return e;var t=window.location;if(t.href.split(".")[0]===e.split(".")[0])return e;e.split("://")[1].split("/")[0].replace("www.","")===t.hostname.replace("www.","")&&e.indexOf(t.hostname.replace("www.",""))>-1&&(t.href.indexOf("https://")>-1?e=e.replace("http://","https://"):t.href.indexOf("http://")>-1&&(e=e.replace("https://","http://")),t.href.indexOf("://www.")>-1&&-1===e.indexOf("://www.")&&(e=e.replace("://","://www.")),-1===t.href.indexOf("://www.")&&e.indexOf("://www.")>-1&&(e=e.replace("://www.","://")))}catch(e){}return e},rotateStr:function(e){return" rotateZ("+e+"deg) "},lowerPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},nearestPowerOfTwo:function(e,t){return Math.min(t||2048,Math.pow(2,Math.ceil(Math.log(e)/Math.LN2)))},getFullscreenElement:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},hasFullscreenEnabled:function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},fixMouseEvent:function(e){if(e){var t=e.originalEvent||e;if(t.changedTouches&&t.changedTouches.length>0){var i=r.event.fix(e),n=t.changedTouches[0];return i.clientX=n.clientX,i.clientY=n.clientY,i.pageX=n.pageX,i.touches=t.touches,i.pageY=n.pageY,i.movementX=n.movementX,i.movementY=n.movementY,i}return e}return e},limitAt:function(e,t,i){return e<t?t:e>i?i:e},distOrigin:function(e,t){return u.distPoints(0,0,e,t)},distPoints:function(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))},angleByDistance:function(e,t){var i=t/2,n=u.limitAt(e,0,t);return n<i?u.toDeg(Math.asin(n/i)):90+u.toDeg(Math.asin((n-i)/i))},calculateScale:function(e,t){var i=u.distPoints(e[0].x,e[0].y,e[1].x,e[1].y);return u.distPoints(t[0].x,t[0].y,t[1].x,t[1].y)/i},getVectorAvg:function(e){return{x:e.map((function(e){return e.x})).reduce(u.sum)/e.length,y:e.map((function(e){return e.y})).reduce(u.sum)/e.length}},sum:function(e,t){return e+t},getTouches:function(e,t){return t=t||{left:0,top:0},Array.prototype.slice.call(e.touches).map((function(e){return{x:e.pageX-t.left,y:e.pageY-t.top}}))},getScriptCallbacks:[],getScript:function(e,t,i,n){var a,o=u.getScriptCallbacks[e];function s(){a.removeEventListener("load",l,!1),a.removeEventListener("readystatechange",l,!1),a.removeEventListener("complete",l,!1),a.removeEventListener("error",h,!1),a.onload=a.onreadystatechange=null,a=null,a=null}function l(e,t){if(null!=a&&(t||!a.readyState||/loaded|complete/.test(a.readyState))){if(!t){for(var n=0;n<o.length;n++)o[n]&&o[n](),o[n]=null;i=null}s()}}function h(){i(),s(),i=null}if(0===r("script[src='"+e+"']").length){(o=u.getScriptCallbacks[e]=[]).push(t),a=document.createElement("script");var p=document.body.getElementsByTagName("script")[0];a.async=!0,a.setAttribute("data-cfasync","false"),!0===n&&a.setAttribute("type","module"),null!=p?(p.parentNode.insertBefore(a,p),p=null):document.body.appendChild(a),a.addEventListener("load",l,!1),a.addEventListener("readystatechange",l,!1),a.addEventListener("complete",l,!1),i&&a.addEventListener("error",h,!1),a.src=e+("MS"===u.prefix.dom?"?"+Math.random():"")}else o.push(t)},detectScriptLocation:function(){if(void 0===window[e.locationVar])r("script").each((function(){var t=r(this)[0].src;if((t.indexOf("/"+e.locationFile+".js")>-1||t.indexOf("/"+e.locationFile+".min.js")>-1||t.indexOf("js/"+e.locationFile+".")>-1)&&(t.indexOf("https://")>-1||t.indexOf("http://")>-1)){var i=t.split("/");window[e.locationVar]=i.slice(0,-2).join("/")}}));else if(-1==window[e.locationVar].indexOf(":")){var t=document.createElement("a");t.href=window[e.locationVar],window[e.locationVar]=t.href,t=null}void 0!==window[e.locationVar]&&window[e.locationVar].length>2&&"/"!==window[e.locationVar].slice(-1)&&(window.window[e.locationVar]+="/")},disposeObject:function(e){return e&&e.dispose&&e.dispose(),e=null},log:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var a;!0===s.defaults.enableDebugLog&&window.console&&(a=console).log.apply(a,n(t))},color:{getBrightness:function(e){var t=e.replace("#","").match(/.{1,2}/g).map((function(e){return parseInt(e,16)}));return.299*t[0]+.587*t[1]+.114*t[2]},isLight:function(e){return!u.color.isDark(e)},isDark:function(e){return u.color.getBrightness(e)<128}},isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isIOS:/(iPad|iPhone|iPod)/g.test(navigator.userAgent),isIPad:"iPad"===navigator.platform||void 0!==navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/Mac/.test(navigator.platform),isMac:navigator.platform.toUpperCase().indexOf("MAC")>=0,isSafari:/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||window.safari.pushNotification).toString(),isIEUnsupported:!!navigator.userAgent.match(/(MSIE|Trident)/),isSafariWindows:function(){return!u.isMac&&u.isSafari},hasWebgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),hasES2022:void 0!==Array.prototype.at,canSupport3D:function(){var e=!0;try{if(0==u.hasWebgl)e=!1;else if(0==u.hasES2022)e=!1;else if(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)e=!1;else if(u.isSafariWindows())e=!1;else{var t=navigator.userAgent.toString().toLowerCase().match(/android\s([0-9\.]*)/i);(t=t?t[1]:void 0)&&(t=parseInt(t,10),!isNaN(t)&&t<9&&(e=!1))}}catch(e){}return e},prefix:(a=window.getComputedStyle(document.documentElement,""),o=Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)[1],{dom:"WebKit|Moz|MS".match(new RegExp("("+o+")","i"))[1],lowercase:o,css:"-"+o+"-",js:o[0].toUpperCase()+o.substr(1)}),scrollIntoView:function(e,t,i){(t=t||e.parentNode).scrollTop=e.offsetTop+(!1===i?e.offsetHeight-t.offsetHeight:0),t.scrollLeft=e.offsetLeft-t.offsetLeft},getVisibleElements:function(e){var t=e.container,i=e.elements,n=e.visible||[],a=t.scrollTop,o=a+t.clientHeight;if(0==o)return n;var s=0,r=i.length-1,l=i[s],h=l.offsetTop+l.clientTop+l.clientHeight;if(h<a)for(;s<r;){var u=s+r>>1;(h=(l=i[u]).offsetTop+l.clientTop+l.clientHeight)>a?r=u:s=u+1}for(var p=s;p<i.length;p++){if(!((l=i[p]).offsetTop+l.clientTop<=o))break;n.push(p+1)}return n},getMouseDelta:function(e){var t=0;return null!=e.wheelDelta?t=e.wheelDelta:null!=e.detail&&(t=-e.detail),t},pan:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.startPoint,a=e.app.zoomValue,o=e.left+(!0===i?0:t.raw.x-n.raw.x),s=e.top+(!0===i?0:t.raw.y-n.raw.y);e.left=Math.ceil(u.limitAt(o,-e.shiftWidth,e.shiftWidth)),e.top=Math.ceil(u.limitAt(s,-e.shiftHeight,e.shiftHeight)),1===a&&(e.left=0,e.top=0),!1===i&&(e.startPoint=t)}};u.isChromeExtension=function(){return 0===window.location.href.indexOf("chrome-extension://")};var p=/\x00+/g,c=/[\x01-\x1F]/g;u.removeNullCharacters=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"string"!=typeof e?(warn("The argument for removeNullCharacters must be a string."),e):(t&&(e=e.replace(c," ")),e.replace(p,""))},e.hashFocusBookFound=!1,u.detectHash=function(){e.preParseHash=window.location.hash;var t=u.getSharePrefixes();-1==t.indexOf("")&&t.push(""),Array.prototype.forEach.call(t,(function(t){var i=e.preParseHash;if(i&&i.indexOf(t)>=0&&!1===e.hashFocusBookFound){t.length>0&&(i=i.split(t)[1]);var n=i.split("/")[0].replace("#","");if(n.length>0){var a,o=i.split("/")[1];if(null!=o&&(o=o.split("/")[0]),0===(a=r("[data-df-slug="+n+"]")).length&&(a=r("[data-slug="+n+"]")),0===a.length&&(a=r("#df-"+n+",#"+n)),0===a.length&&(a=r("[data-_slug="+n+"]")),a.length>0&&a.is("._df_thumb,._df_button,._df_custom,._df_link,._df_book,.df-element,.dp-element")){a=r(a[0]),e.hashFocusBookFound=!0,o=parseInt(o,10),u.focusHash(a);var s=e.activeLightBox&&e.activeLightBox.app||a.data("df-app");if(null!=s)return s.gotoPage(o),s.hashNavigationEnabled=!0,u.focusHash(s.element),!1;null!=o&&a.attr("data-hash-page",o),a.addClass("df-hash-focused",!0),(null!=a.data("lightbox")||null!=a.data("df-lightbox")||null!=a.attr("href")&&a.attr("href").indexOf(".pdf")>-1)&&a.trigger("click")}}}}))},u.focusHash=function(e){var t,i;null===(t=(i=e[0]).scrollIntoView)||void 0===t||t.call(i,{behavior:"smooth",block:"nearest",inline:"nearest"})},u.contain=function(e,t,i,n){var a=Math.min(i/e,n/t);return{width:e*a,height:t*a}},u.containUnStretched=function(e,t,i,n){var a=Math.min(1,i/e,n/t);return{width:e*a,height:t*a}},u.fallbackOptions=function(e){return void 0===e.share.mail&&(e.share.mail="mailto:?subject="+e.text.mailSubject+"&body="+e.text.mailBody),e.openPage&&(e.openPage=parseInt(e.openPage,10)),e};u.getOptions=function(e){null==(e=r(e)).data("df-option")&null==e.data("option")&&e.data("df-option","option_"+e.attr("id")),void 0!==e.attr("source")&&e.data("df-source",e.attr("source"));var t,i=e.data("df-option")||e.data("option"),n=void 0;n="object"==(void 0===i?"undefined":(t=i)&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t)?i:null==i||""===i||null==window[i]?{}:window[i];var a=function(e){var t={},i={id:"",thumb:"",openPage:"data-hash-page,df-page,data-df-page,data-page,page",target:"",height:"",showDownloadControl:"data-download",source:"pdf-source,df-source,source",is3D:"webgl,is3d",viewerType:"viewertype,viewer-type",pagemode:""};for(var n in i)for(var a=(n+","+i[n]).split(","),o=0;o<a.length;o++){var s=a[o];if(""!==s){var r=e.data(s);if(null!==r&&""!==r&&void 0!==r){t[n]=r;break}if(null!==(r=e.attr(s))&&""!==r&&void 0!==r){t[n]=r;break}}}return e.removeAttr("data-hash-page"),t}(e);return n=r.extend(!0,{},n,a)},u.isTrue=function(e){return"true"===e||!0===e},u.parseInt=function(e){return parseInt(e,10)},u.parseFloat=function(e){return parseFloat(e)},u.parseIntIfExists=function(e){return void 0!==e&&(e=parseInt(e,10)),e},u.parseFloatIfExists=function(e){return void 0!==e&&(e=parseFloat(e)),e},u.parseBoolIfExists=function(e){return void 0!==e&&(e=u.isTrue(e)),e},u.getCurveAngle=function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?(i=t>135?180-2*(180-t):t>45?t-45:0,i=u.limitAt(i,n,180)):(i=t<45?2*t:t<135?t+45:180,i=u.limitAt(i,0,180-n)),i},u.sanitizeOptions=function(e){if(e.showDownloadControl=u.parseBoolIfExists(e.showDownloadControl),e.showSearchControl=u.parseBoolIfExists(e.showSearchControl),e.showPrintControl=u.parseBoolIfExists(e.showPrintControl),e.flipbook3DTiltAngleLeft=u.parseIntIfExists(e.flipbook3DTiltAngleLeft),e.flipbook3DTiltAngleUp=u.parseIntIfExists(e.flipbook3DTiltAngleUp),e.paddingLeft=u.parseIntIfExists(e.paddingLeft),e.paddingRight=u.parseIntIfExists(e.paddingRight),e.paddingTop=u.parseIntIfExists(e.paddingTop),e.paddingBottom=u.parseIntIfExists(e.paddingBottom),e.duration=u.parseIntIfExists(e.duration),e.rangeChunkSize=u.parseIntIfExists(e.rangeChunkSize),e.maxTextureSize=u.parseIntIfExists(e.maxTextureSize),e.linkTarget=u.parseIntIfExists(e.linkTarget),e.zoomRatio=u.parseFloatIfExists(e.zoomRatio),e.enableAnalytics=u.parseBoolIfExists(e.enableAnalytics),e.autoPlay=u.parseBoolIfExists(e.autoPlay),e.autoPlayStart=u.parseBoolIfExists(e.autoPlayStart),e.autoPlayDuration=u.parseIntIfExists(e.autoPlayDuration),void 0!==e.loadMoreCount&&(e.loadMoreCount=u.parseInt(e.loadMoreCount),(isNaN(e.loadMoreCount)||0===e.loadMoreCount)&&(e.loadMoreCount=-1)),null!=e.source&&(Array===e.source.constructor||Array.isArray(e.source)||(i=e.source,null!=(n=Array)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](i):i instanceof n)))for(var t=0;t<e.source.length;t++)e.source[t]=u.httpsCorrection(e.source[t]);else e.source=u.httpsCorrection(e.source);var i,n;return e},u.finalizeOptions=function(e){return e},u.urlify=function(e){for(var t,i,n=/[a-zA-Z0-9][^\s,]{3,}\.[^\s,]+[a-zA-Z0-9]/gi,a=[];t=n.exec(e);){var o=t[0];1==(o.match(/@/g)||[]).length?o.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,7})+/gi)&&a.push({index:t.index,length:o.length,text:o}):o.match(/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_\+.~#?&//=]*/g)&&(0!==(i=o.toLowerCase()).indexOf("http:")&&0!==i.indexOf("https:")&&0!==i.indexOf("www.")||a.push({index:t.index,length:o.length,text:o}))}return a;return e.replace(n,(function(e,t,i){if(e.indexOf("@")>-1){if(e.match(/^((?!\.)[\w_.-]*[^.])(@\w+)(\.\w+(\.\w+)?[^.\W])$/gi)){var n=e.toLowerCase();return e.indexOf(!1)&&(n="mailto:"+e),u.log("AutoLink: "+n+" for "+e),'<a href="'+n+'" class="df-autolink" target="_blank">'+e+"</a>"}}else if(e.match(/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b[-a-zA-Z0-9@:%_\+.~#?&//=]*/g)){n=e;if(0===e.indexOf("www."))n="http://"+e;else if(-1===n.indexOf("http:")&&-1===n.indexOf("https:"))return e;return u.log("AutoLink: "+n+" for "+e),'<a href="'+n+'" class="df-autolink" target="_blank">'+e+"</a>"}return e}))},u.oldurlify=function(e){return e.replace(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[.\!\/\\w]*))?)/g,(function(e,t,i,n,a){var o=e=e.toLowerCase();if(e.indexOf(":")>0&&-1===e.indexOf("http:")&&-1===e.indexOf("https:"))return u.log("AutoLink Rejected: "+o+" for "+e),e;if(0===e.indexOf("www."))o="http://"+e;else if(0===e.indexOf("http://")||0===e.indexOf("https://"));else if(0===e.indexOf("mailto:"));else if(e.indexOf("@")>0){o="mailto:"+e;if(null===e.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/))return u.log("AutoLink Rejected: "+o+" for "+e),e}return u.log("AutoLink: "+o+" for "+e),'<a href="'+o+'" class="df-autolink" target="_blank">'+e+"</a>"}))},u.supportsPassive=!1;try{var d=Object.defineProperty({},"passive",{get:function(){u.supportsPassive=!0}});window.addEventListener("testPassive",null,d),window.removeEventListener("testPassive",null,d)}catch(e){}e.parseCSSElements=function(){r(".dvcss").each((function(){var e,t=r(this),i=function(e){for(var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dvcss_e_",n=e.classList,a=0;a<n.length;a++)if(0===(t=n[a]).indexOf(i))return t;return null}(t[0]);t.removeClass(i).removeClass("dvcss"),i=i.replace("dvcss_e_","");try{e=JSON.parse(atob(i))}catch(e){}if(e){var n="df_option_"+e.id;window[n]=r.extend(!0,{},window[n],e),t.addClass("df-element"),"none"!==e.lightbox&&(t.attr("data-df-lightbox",void 0===e.lightbox?"custom":e.lightbox),"thumb"==e.lightbox&&t.attr("data-df-thumb",e.pdfThumb),e.thumbLayout&&t.attr("data-df-thumb-layout",e.thumbLayout),e.apl&&t.attr("apl",e.apl)),t.data("df-option",n),t.attr("data-df-slug",e.slug),t.attr("id","df_"+e.id)}}))},e.parseThumbs=function(t){t.element.html(""),null!=t.thumbURL&&""!=t.thumbURL.toString().trim()||(t.element.addClass("df-thumb-not-found"),t.thumbURL=e.defaults.popupThumbPlaceholder);var i=r("<span class='df-book-title'>").html(t.title),n=r("<div class='df-book-wrapper'>").appendTo(t.element);n.append(r("<div class='df-book-page1'>")),n.append(r("<div class='df-book-page2'>"));var a=r("<div class='df-book-cover'>").append(i).appendTo(n),o=r('<img width="210px" height="297px" class="df-lazy" alt="'+t.title+'"/>');o.attr("data-src",t.thumbURL),o.attr("src",e.defaults.popupThumbPlaceholder),a.prepend(o),e.addLazyElement(o[0]),!0===e.defaults.displayLightboxPlayIcon&&a.addClass("df-icon-play-popup"),"book-title-top"===t.thumbLayout?i.prependTo(t.element):"book-title-bottom"!==t.thumbLayout&&"cover-title"!==t.thumbLayout||(t.hasShelf?t.thumbLayout="book-title-fixed":i.appendTo(t.element),!0===e.defaults.displayLightboxPlayIcon&&(t.element.removeClass("df-icon-play-popup"),n.addClass("df-icon-play-popup"))),t.element.addClass("df-tl-"+t.thumbLayout),t.element.attr("title",t.title)},e.initId=10,e.embeds=[],e.activeEmbeds=[],e.removeEmbeds=[],e.removeEmbedsLimit=u.isMobile?1:2,e.parseNormalElements=function(){r(".df-posts").each((function(){if(!1!==e.defaults.loadMoreCount&&-1!==e.defaults.loadMoreCount){var t=r(this);if("true"!==t.data("df-parsed")){t.data("df-parsed","true"),t.attr("df-parsed","true");var i=0,n=t.find(".df-element"),a=n.length;n.each((function(){++i>e.defaults.loadMoreCount&&r(this).attr("skip-parse","true")})),a>e.defaults.loadMoreCount&&t.append("<div class='df-load-more-button-wrapper'><div class='df-load-more-button'>Load More..</div></div>")}}})),e.triggerId=10,r(".df-element").each((function(){var t=r(this);if("true"!==t.attr("skip-parse")&&"true"!==t.data("df-parsed")){t.data("df-parsed","true"),t.attr("df-parsed","true");var i=t.data("df-lightbox")||t.data("lightbox");if(void 0===i)t.addClass("df-lazy-embed"),e.addLazyElement(t[0]);else if(t.addClass("df-popup-"+i),"thumb"===i){var n=t.data("df-thumb-layout")||e.defaults.thumbLayout,a=u.httpsCorrection(t.data("df-thumb"));t.removeAttr("data-thumb").removeAttr("data-thumb-layout");var o=t.html().trim();void 0!==o&&""!==o||(o="Click to Open");var s=t.parent().hasClass("df-has-shelf");e.parseThumbs({element:t,thumbURL:a,title:o,thumbLayout:n,hasShelf:s}),s&&t.after(r("<df-post-shelf>"))}else"button"===i&&e.defaults.buttonClass&&t.addClass(e.defaults.buttonClass);var l=t.attr("data-trigger");null!=l&&l.length>1&&(l=l.split(","),e.triggerId++,l.forEach((function(i){t.attr("df-trigger-id",e.triggerId),r("#"+i).addClass("df-trigger").attr("df-trigger",e.triggerId)})))}})),e.handleLazy=function(){var t;if(e.removeEmbeds.length>e.removeEmbedsLimit&&(t=e.removeEmbeds.shift())){var i=r("[initID='"+t+"']");if(i.length>0){var n=i.data("df-app");if(n){i.attr("data-df-page",n.currentPageNumber),u.log("Removed app id "+t),n.dispose(),n=null;var a=e.activeEmbeds.indexOf(t);a>-1&&e.activeEmbeds.splice(a,1)}}}if(t=e.embeds.shift()){var o=r("[initID='"+t+"']");if(o.length>0)if(o.is("img"))o.hasClass("df-lazy")?(o.attr("src",o.attr("data-src")),o.removeAttr("data-src"),o.removeClass("df-lazy"),e.lazyObserver.unobserve(o[0]),e.handleLazy()):(u.log("Prevent this"),e.handleLazy());else{var s=o.data("df-app");null==s?o.dearviewer():s.softInit(),u.log("Created app id "+t),e.activeEmbeds.push(t)}}e.removeEmbeds.length<=e.removeEmbedsLimit&&0==e.embeds.length&&(e.checkRequestQueue=null)}},e.lazyObserver={observe:function(e){(e=r(e)).is("img")?e.hasClass("df-lazy")&&(e.attr("src",e.attr("data-src")),e.removeAttr("data-src"),e.removeClass("df-lazy")):e.dearviewer()}},"function"==typeof IntersectionObserver&&(e.lazyObserver=new IntersectionObserver((function(t,i){t.forEach((function(t){var i,n=r(t.target),a=n.attr("initID");t.isIntersecting?(n.attr("initID")||(n.attr("initID",e.initId),a=e.initId.toString(),e.initId++),(i=e.removeEmbeds.indexOf(a))>-1?(e.removeEmbeds.splice(i,1),u.log("Removed id "+a+"from Removal list")):-1==(i=e.embeds.indexOf(a))&&(e.embeds.push(a),u.log("Added id "+a+"to Add list"))):a&&((i=e.embeds.indexOf(a))>-1?(e.embeds.splice(i,1),u.log("Removed id "+a+" from Add list")):-1==(i=e.removeEmbeds.indexOf(a))&&(e.removeEmbeds.push(a),u.log("Added id "+a+" to Removal list"))),f=0,(e.removeEmbeds.length>e.removeEmbedsLimit||e.embeds.length>0)&&null==e.checkRequestQueue&&(e.checkRequestQueue=function(){f++,e.checkRequestQueue&&requestAnimationFrame((function(){e&&e.checkRequestQueue&&e.checkRequestQueue()})),f>20&&(f=0,e.handleLazy())},e.checkRequestQueue())}))})));var f=0;function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.addLazyElement=function(t){e.lazyObserver.observe(t)},e.parseElements=u.parseElements=function(){e.parseCSSElements(),e.parseNormalElements()},e.initUtils=function(){u.detectScriptLocation();var t=r("body");(u.isSafari||u.isIOS)&&t.addClass("df-ios"),t.on("click",(function(){})),t.on("click",".df-posts .df-load-more-button",(function(){var t=r(this).closest(".df-posts");if(t.length>0){var i=0;t.find(".df-element").each((function(){var t=r(this);"true"===t.attr("skip-parse")&&(i<e.defaults.loadMoreCount&&t.removeAttr("skip-parse"),i++)})),e.parseNormalElements()}})),e.defaults.shelfImage&&""!=e.defaults.shelfImage&&t.append("<style>.df-has-shelf df-post-shelf:before, .df-has-shelf df-post-shelf:after{background-image: url('"+e.defaults.shelfImage+"');}</style>")};var v=e,m=e.utils,y=function(){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.pages=[],this.app=i,this.parentElement=this.app.viewerContainer;var n="df-viewer "+(e.viewerClass||"");this.element=jQuery("<div>",{class:n}),this.parentElement.append(this.element),this.wrapper=jQuery("<div>",{class:"df-viewer-wrapper"}),this.element.append(this.wrapper),this.oldBasePageNumber=0,this.pages=[],this.minZoom=1,this.maxZoom=4,this.swipeThreshold=20,this.stageDOM=null,this.events={},this.arrowKeysAction=e.arrowKeysAction,this.clickAction=e.clickAction,this.scrollAction=e.scrollAction,this.dblClickAction=e.dblClickAction,this.pageBuffer=[],this.pageBufferSize=10}var i,n,a;return i=t,n=[{key:"init",value:function(){}},{key:"softDispose",value:function(){}},{key:"updateBuffer",value:function(e){}},{key:"pageResetCallback",value:function(e){}},{key:"initCustomControls",value:function(){}},{key:"_getInnerWidth",value:function(){return this.app.dimensions.containerWidth-this.app.dimensions.padding.width-this.app.dimensions.offset.width}},{key:"_getInnerHeight",value:function(){return this.app.dimensions.maxHeight-this.app.dimensions.padding.height}},{key:"_getOuterHeight",value:function(e){return e}},{key:"dispose",value:function(){this.stageDOM&&(this.stageDOM.removeEventListener("mousemove",this.events.mousemove,!1),this.stageDOM.removeEventListener("mousedown",this.events.mousedown,!1),this.stageDOM.removeEventListener("mouseup",this.events.mouseup,!1),this.stageDOM.removeEventListener("touchmove",this.events.mousemove,!1),this.stageDOM.removeEventListener("touchstart",this.events.mousedown,!1),this.stageDOM.removeEventListener("touchend",this.events.mouseup,!1),this.stageDOM.removeEventListener("dblclick",this.events.dblclick,!1),this.stageDOM.removeEventListener("scroll",this.events.scroll,!1),this.stageDOM.removeEventListener("mousewheel",this.events.mousewheel,!1),this.stageDOM.removeEventListener("DOMMouseScroll",this.events.mousewheel,!1)),this.events=null,this.stageDOM=null,this.element.remove()}},{key:"checkDocumentPageSizes",value:function(){}},{key:"getViewerPageNumber",value:function(e){return e}},{key:"getDocumentPageNumber",value:function(e){return e}},{key:"getRenderContext",value:function(t,i){var n=this.app,a=n.provider,o=i.pageNumber,s=m.ifdef(i.textureTarget,e.TEXTURE_TARGET.VIEWER),r=(n.dimensions.pageFit,a.viewPorts[o]),l=n.viewer.getTextureSize(i),h=null;if(h=s===e.TEXTURE_TARGET.THUMB?n.thumbSize:Math.floor(l.height),void 0===a.getCache(o,h)){var u=l.height/r.height,p=document.createElement("canvas"),c=this.filterViewPort(t.getViewport({scale:u,rotation:t._pageInfo.rotate+n.options.pageRotation}),o);s===e.TEXTURE_TARGET.THUMB&&(u=c.width/c.height>180/n.thumbSize?180*u/c.width:u*n.thumbSize/c.height,c=this.filterViewPort(t.getViewport({scale:u,rotation:t._pageInfo.rotate+n.options.pageRotation}),o)),p.height=Math.floor(c.height),p.width=Math.floor(c.width);var d=Math.abs(p.width-l.width)/l.width*100;return d>.001&&d<2&&(p.width=Math.floor(l.width),p.height=Math.floor(l.height)),n.viewer.filterViewPortCanvas(c,p,o),{canvas:p,canvasContext:p.getContext("2d",{willReadFrequently:!0===e.defaults.canvasWillReadFrequently}),viewport:c}}}},{key:"filterViewPort",value:function(e,t){return e}},{key:"getViewPort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.app.provider.viewPorts[e];return t?null!=i?i:this.app.provider.defaultPage.viewPort:i}},{key:"pagesReady",value:function(){}},{key:"onReady",value:function(){}},{key:"filterViewPortCanvas",value:function(e){}},{key:"finalizeAnnotations",value:function(){}},{key:"finalizeTextContent",value:function(){}},{key:"updateTextContent",value:function(e){null==e&&(e=this.getBasePage(e)),this.app.provider.processTextContent(e,this.getTextElement(e,!0))}},{key:"isActivePage",value:function(e){return e===this.app.currentPageNumber}},{key:"initEvents",value:function(){var e=this,t=e.stageDOM=m.ifdef(e.stageDOM,e.parentElement[0]);if(t){var i=!1;t.addEventListener("mousemove",e.events.mousemove=e.mouseMove.bind(e),!1),t.addEventListener("mousedown",e.events.mousedown=e.mouseDown.bind(e),!1),t.addEventListener("mouseup",e.events.mouseup=e.mouseUp.bind(e),!1),t.addEventListener("touchmove",e.events.mousemove=e.mouseMove.bind(e),i),t.addEventListener("touchstart",e.events.mousedown=e.mouseDown.bind(e),i),t.addEventListener("touchend",e.events.mouseup=e.mouseUp.bind(e),!1),t.addEventListener("dblclick",e.events.dblclick=e.dblclick.bind(e),!1),t.addEventListener("scroll",e.events.scroll=e.onScroll.bind(e),!1),t.addEventListener("mousewheel",e.events.mousewheel=e.mouseWheel.bind(e),i),t.addEventListener("DOMMouseScroll",e.events.mousewheel=e.mouseWheel.bind(e),!1)}this.startTouches=null,this.lastScale=null,this.startPoint=null}},{key:"refresh",value:function(){}},{key:"reset",value:function(){}},{key:"eventToPoint",value:function(e){var t={x:e.clientX,y:e.clientY};return t.x=t.x-this.app.viewerContainer[0].getBoundingClientRect().left,t.y=t.y-this.app.viewerContainer[0].getBoundingClientRect().top,{raw:t}}},{key:"mouseMove",value:function(e){e=m.fixMouseEvent(e),this.pinchMove(e),!0===this.pinchZoomDirty&&e.preventDefault(),this.startPoint&&1!=this.pinchZoomDirty&&(this.pan(this.eventToPoint(e)),e.preventDefault())}},{key:"mouseDown",value:function(e){e=m.fixMouseEvent(e),this.pinchDown(e),this.startPoint=this.eventToPoint(e)}},{key:"mouseUp",value:function(e){e=m.fixMouseEvent(e);var t=this;!0===t.pinchZoomDirty&&e.preventDefault();var i=t.eventToPoint(e),n=e.target||e.originalTarget,a=t.startPoint&&i.x===t.startPoint.x&&i.y===t.startPoint.y&&"A"!==n.nodeName;!0===e.ctrlKey&&a&&this.zoomOnPoint(i),this.pinchUp(e),this.startPoint=null}},{key:"pinchDown",value:function(e){null!=e.touches&&2==e.touches.length&&null==this.startTouches&&(this.startTouches=e.touches)}},{key:"pinchUp",value:function(e){if(null!=e.touches&&e.touches.length<2&&1==this.pinchZoomDirty){if(this.startTouches&&distanceTouches&&0!=distanceTouches){const e=distanceTouches>0,t={raw:getPinchCenter(this.startTouches)};this.zoomOnPoint(t,e)}else this.app.viewer.lastScale=this.lastScale,this.app.container.removeClass("df-pinch-zoom"),this.updateTemporaryScale(!0),this.app.zoom();this.lastScale=null,this.app.viewer.canSwipe=!1,this.pinchZoomDirty=!1,this.app.viewer._pinchZoomLastScale=null,this.startTouches=null,distanceTouches=0}}},{key:"pinchMove",value:function(t){if(distanceTouches=this.startTouches&&null!=t.touches&&2==t.touches.length?getTouchesDistance(this.startTouches)-getTouchesDistance(t.touches):0,null!=t.touches&&2==t.touches.length&&null!=this.startTouches){this.pinchZoomDirty=!0,this.app.container.addClass("df-pinch-zoom");var i=m.calculateScale(this.startTouches,m.getTouches(t));return this.lastScale,this.lastScale=i,this.app.viewer.pinchZoomUpdateScale=m.limitAt(i,this.app.viewer.minZoom/this.app.zoomValue,this.app.viewer.maxZoom/this.app.zoomValue),this.app.viewer._pinchZoomLastScale!=this.app.viewer.pinchZoomUpdateScale&&(this.app.viewer.pinchZoomRequestStatus=e.REQUEST_STATUS.ON,this.app.viewer._pinchZoomLastScale=this.app.viewer.pinchZoomUpdateScale),void t.preventDefault()}}},{key:"updateTemporaryScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===e)this.parentElement[0].style.transform="none";else if(this.app.viewer.zoomCenter){var t=this.app.viewer.pinchZoomUpdateScale;this.parentElement[0].style.transformOrigin=this.app.viewer.zoomCenter.x+"px "+this.app.viewer.zoomCenter.y+"px",this.parentElement[0].style.transform="scale3d("+t+","+t+",1)"}}},{key:"pan",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.panRequestStatus=e.REQUEST_STATUS.ON,m.pan(this,t,i)}},{key:"updatePan",value:function(){this.element.css({transform:"translate3d("+this.left+"px,"+this.top+"px,0)"})}},{key:"dblclick",value:function(e){}},{key:"onScroll",value:function(e){}},{key:"mouseWheel",value:function(t){var i=this.app,n=m.getMouseDelta(t),a=!0===t.ctrlKey,o=i.options.mouseScrollAction===e.MOUSE_SCROLL_ACTIONS.ZOOM&&(!0===i.options.isLightBox||!0===i.isFullscreen);if(0)if(Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(t.deltaX>0?(i.viewer.camera.position.x+=10,i.viewer.camera.updateProjectionMatrix()):(i.viewer.camera.position.x+=-10,i.viewer.camera.updateProjectionMatrix())),n>0?(i.viewer.camera.position.y+=10,i.viewer.camera.updateProjectionMatrix()):n<0&&(i.viewer.camera.position.y+=-10,i.viewer.camera.updateProjectionMatrix()),a||o){if(n>0||n<0){const e=n<0,a=this.eventToPoint(t),o=e?-30:30;debounceZoom.call(i,o,a.raw)}}else i.options.mouseScrollAction===e.MOUSE_SCROLL_ACTIONS.NAV&&(n>0?i.next():n<0&&i.prev())}},{key:"zoomOnPoint",value:function(e,t){this.app.viewer.zoomCenter=e.raw;const i=t?-10:10;this.app.zoom(i,e.raw)}},{key:"getVisiblePages",value:function(){return this.visiblePagesCache=[],{main:this.visiblePagesCache,buffer:[]}}},{key:"getBasePage",value:function(){return this.app.currentPageNumber}},{key:"isFirstPage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),1===e}},{key:"isLastPage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),e===this.app.pageCount}},{key:"isEdgePage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),1===e||e===this.app.pageCount}},{key:"checkRequestQueue",value:function(){var t=e.REQUEST_STATUS;this.panRequestStatus===t.ON&&(this.updatePan(),this.panRequestStatus=t.OFF),this.app.viewer.pinchZoomRequestStatus===t.ON&&(this.app.viewer.updateTemporaryScale(),this.app.viewer.pinchZoomRequestStatus=t.OFF)}},{key:"isAnimating",value:function(){return!1}},{key:"updatePendingStatusClass",value:function(e){void 0===e&&(e=this.isAnimating()),this.app.container.toggleClass("df-pending",e)}},{key:"initPages",value:function(){}},{key:"resize",value:function(){}},{key:"determinePageMode",value:function(){}},{key:"zoom",value:function(){}},{key:"gotoPageCallBack",value:function(){this.requestRefresh()}},{key:"requestRefresh",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.refreshRequestStatus=!0===e?v.REQUEST_STATUS.ON:v.REQUEST_STATUS.OFF}},{key:"getPageByNumber",value:function(e){var t=this.pages,i=void 0;if(this.app.isValidPage(e))for(var n=0;n<t.length;n++)if(e===t[n].pageNumber){i=t[n];break}return i}},{key:"changeAnnotation",value:function(){return!1}},{key:"getAnnotationElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getPageByNumber(e);if(void 0!==i)return void 0===i.annotationElement&&(i.annotationElement=jQuery("<div class='df-link-content'>"),i.contentLayer.append(i.annotationElement)),!0===t&&i.annotationElement.html(""),i.annotationElement[0]}},{key:"getTextElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getPageByNumber(e);if(void 0!==i)return void 0===i.textElement&&(i.textElement=jQuery("<div class='df-text-content'>"),i.contentLayer.append(i.textElement)),!0===t&&(i.textElement.html(""),i.textElement.siblings(".df-auto-link-content").html("")),i.textElement[0]}},{key:"render",value:function(){}},{key:"textureLoadedCallback",value:function(e){}},{key:"handleZoom",value:function(){}},{key:"getTextureSize",value:function(e){}},{key:"textureHeightLimit",value:function(e){return m.limitAt(e,1,this.app.dimensions.maxTextureHeight)}},{key:"textureWidthLimit",value:function(e){return m.limitAt(e,1,this.app.dimensions.maxTextureWidth)}},{key:"setPage",value:function(e){m.log("Set Page detected",e.pageNumber);var t=this.getPageByNumber(e.pageNumber);return!!t&&(e.callback=this.textureLoadedCallback.bind(this),t.loadTexture(e),this.updateBuffer(t),!0)}},{key:"cleanPage",value:function(e){return!0}},{key:"validatePageChange",value:function(e){return e!==this.app.currentPageNumber}},{key:"afterControlUpdate",value:function(){}},{key:"searchPage",value:function(e){return{include:!0,label:this.app.provider.getLabelforPage(e)}}}],n&&g(i.prototype,n),a&&g(i,a),t}();function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function P(e,t,i){return t&&w(e.prototype,t),i&&w(e,i),e}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function x(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function C(e,t){return C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},C(e,t)}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=S(e);if(t){var a=S(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return x(this,i)}}var E=e.utils,k=function(){function e(){b(this,e),this.textureLoadFallback="blank",this.textureStamp="-1",this.textureLoaded=!1,this.texture="blank",this.textureSrc="blank",this.pageNumber=void 0,this.contentLayer=jQuery("<div>",{class:"df-page-content"})}return P(e,[{key:"reset",value:function(){this.resetTexture(),this.resetContent()}},{key:"resetTexture",value:function(){this.textureLoaded=!1,this.textureStamp="-1",this.loadTexture({texture:this.textureLoadFallback}),this.contentLayer.removeClass("df-content-loaded")}},{key:"clearTexture",value:function(){this.loadTexture({texture:this.textureLoadFallback})}},{key:"resetContent",value:function(){}},{key:"loadTexture",value:function(e){}},{key:"getTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.textureSrc;return!0===e&&t&&t.cloneNode&&(t=t.cloneNode()).getContext&&t.getContext("2d").drawImage(this.textureSrc,0,0),t}},{key:"setLoading",value:function(){}},{key:"updateTextureLoadStatus",value:function(e){this.textureLoaded=!0===e,E.log((!0===this.textureLoaded?"Loaded ":"Loading ")+this.textureStamp+" for "+this.pageNumber),this.contentLayer.toggleClass("df-content-loaded",!0===e),this.setLoading()}},{key:"changeTexture",value:function(e,t){var i=this,n=e+"|"+t;return i.textureStamp!==n&&(E.log("Page "+e+" : texture changed from - "+i.textureStamp+" to "+n),i.textureLoaded=!1,i.textureStamp=n,i.updateTextureLoadStatus(!1),!0)}}]),e}(),O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(i,e);var t=T(i);function i(e){var n;return b(this,i),(n=t.call(this)).canvasMode=null,e&&e.parentElement&&(n.parentElement=e.parentElement),n.init(),n}return P(i,[{key:"init",value:function(){var e=this.element=jQuery("<div>",{class:"df-page"});e[0].appendChild(this.contentLayer[0]),this.texture=new Image,this.parentElement&&this.parentElement[0].append(e[0])}},{key:"resetContent",value:function(){void 0!==this.annotationElement&&this.annotationElement.html(""),void 0!==this.textElement&&this.textElement.html("")}},{key:"setLoading",value:function(){this.element.toggleClass("df-loading",!0!==this.textureLoaded)}},{key:"loadTexture",value:function(e){var t=this,i=e.texture,n=e.callback;function a(){t.textureSrc=i,t.element.css({backgroundImage:E.bgImage(i)}),t.updateTextureLoadStatus(!0),"function"==typeof n&&n(e)}null===t.canvasMode&&i&&"CANVAS"===i.nodeName&&(t.canvasMode=!0),!0===t.canvasMode?(t.element.find(">canvas").remove(),i!==t.textureLoadFallback&&(t.textureSrc=i,t.element.append(jQuery(i))),t.updateTextureLoadStatus(!0),"function"==typeof n&&n(e)):i===t.textureLoadFallback?a():(t.texture.onload=a,t.texture.src=i)}},{key:"updateCSS",value:function(e){this.element.css(e)}},{key:"resetCSS",value:function(){this.element.css({transform:"",boxShadow:"",display:"block"})}}]),i}(k);function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t,i){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i||e):a.value}},N(e,t,i||e)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function _(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?R(e):t;var i}function A(e,t){return A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},A(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=I(e);if(t){var a=I(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _(this,i)}}var F=e.utils,D=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(s,t);var i,n,a,o=M(s);function s(t,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t.viewerClass="df-reader",i.options.mouseScrollAction=e.MOUSE_SCROLL_ACTIONS.NONE,(n=o.call(this,t,i)).app.jumpStep=1,n.minZoom=.25,n.stackCount=n.app.pageCount,n.app.options.paddingLeft=0,n.app.options.paddingRight=0,n.app.options.paddingTop=10,n.app.options.paddingBottom=!0===n.app.options.controlsFloating?20:10,n.app.pageScaling=n.app.options.pageScale,n.acceptAppMouseEvents=!0,n.scrollStatus=e.REQUEST_STATUS.OFF,n.deltaPanX=0,n.deltaPanY=0,i._viewerPrepared(),n.zoomViewer=R(n),n}return i=s,n=[{key:"init",value:function(){N(I(s.prototype),"init",this).call(this),this.initEvents(),this.initPages(),this.initScrollBar()}},{key:"initEvents",value:function(){this.stageDOM=this.element[0],N(I(s.prototype),"initEvents",this).call(this)}},{key:"initPages",value:function(){this.stackCount=this.app.pageCount;for(var e=0;e<this.stackCount;e++){var t=new O({parentElement:this.wrapper});t.index=e,t.viewer=this,this.pages.push(t)}}},{key:"initScrollBar",value:function(){this.scrollBar=jQuery("<div class='df-reader-scrollbar'>"),this.scrollBar.appendTo(this.app.container),this.scrollPageNumber=jQuery("<div class='df-reader-scroll-page-number'>").appendTo(this.app.container)}},{key:"afterControlUpdate",value:function(){void 0!==this.scrollBar&&(this.scrollBar[0].innerHTML=this.app.getCurrentLabel(),this.app.provider.pageLabels?this.scrollPageNumber[0].innerHTML=this.app.getCurrentLabel()+"<div>("+this.app.currentPageNumber+" of "+this.app.pageCount+")</div>":this.scrollPageNumber[0].innerHTML=this.app.getCurrentLabel()+"<div>of "+this.app.pageCount+"</div>")}},{key:"updateBuffer",value:function(e){if("-1"!==e.textureStamp&&void 0!==e.pageNumber){for(var t=e.pageNumber,i=e.pageNumber,n=0,a=0;a<this.pageBuffer.length;a++){var o=this.pageBuffer[a].pageNumber;if(t===o)return void F.log("Page "+t+" already in buffer, skipping");Math.abs(this.app.currentPageNumber-o)>Math.abs(this.app.currentPageNumber-i)&&(i=o,n=a)}this.pageBuffer.push(e),this.pageBuffer.length>this.pageBufferSize&&(F.log("Farthest buffer: "+i),this.pageBuffer[n].reset(),this.pageBuffer.splice(n,1))}}},{key:"initCustomControls",value:function(){var e=this.app.ui.controls;e.openRight.hide(),e.openLeft.hide()}},{key:"dispose",value:function(){N(I(s.prototype),"dispose",this).call(this),this.scrollBar&&this.scrollBar.remove(),this.scrollPageNumber&&this.scrollPageNumber.remove(),this.element.remove()}},{key:"_getInnerHeight",value:function(){N(I(s.prototype),"_getInnerHeight",this).call(this);var t=this.app.dimensions.maxHeight-this.app.dimensions.padding.height,i=this.app.dimensions.defaultPage.viewPort,n=this.app.dimensions.containerWidth-20-this.app.dimensions.padding.width;this.app.pageScaling===e.PAGE_SCALE.ACTUAL&&(n=1*this.app.provider.defaultPage.viewPort.width);var a=t;return this.app.pageScaling===e.PAGE_SCALE.PAGE_WIDTH?a=100*i.height:this.app.pageScaling===e.PAGE_SCALE.AUTO?a=1.5*i.height:this.app.pageScaling===e.PAGE_SCALE.ACTUAL&&(a=1*i.height),a-=2,this._containCover=F.contain(i.width,i.height,n,a),a=Math.min(t,this._containCover.height+2),this.app.pageScaleValue=this._containCover.height/i.height,this.app.dimensions.isFixedHeight?t:a}},{key:"handleZoom",value:function(){var e=this.app,t=this.maxZoom=4,i=e.zoomValue;!0===e.pendingZoom&&null!=e.zoomDelta?i=e.zoomDelta>0?i*e.options.zoomRatio:i/e.options.zoomRatio:null!=this.lastScale&&(i*=this.lastScale,this.lastScale=null),i=F.limitAt(i,this.minZoom,t),e.zoomValueChange=i/e.zoomValue,e.zoomChanged=e.zoomValue!==i,e.zoomValue=i}},{key:"resize",value:function(){var e=this,t=e.app,i=(t.dimensions,t.dimensions.padding),n=this.shiftHeight=0;this.element.css({top:-n,bottom:-n,right:-0,left:-0,paddingTop:i.top,paddingRight:i.right,paddingBottom:i.bottom,paddingLeft:i.left});for(var a=e.getVisiblePages().main[0]-1,o=(a=e.pages[a].element[0]).getBoundingClientRect(),s=this.parentElement[0].getBoundingClientRect(),r=0;r<e.pages.length;r++){var l=e.pages[r],h=e.getViewPort(r+1,!0),u=l.element[0].style;u.height=Math.floor(h.height*t.pageScaleValue*t.zoomValue)+"px",u.width=Math.floor(h.width*t.pageScaleValue*t.zoomValue)+"px"}if(e.oldScrollHeight!=e.element[0].scrollHeight&&void 0!==e.oldScrollHeight){var p=e.element[0].scrollHeight/e.oldScrollHeight;e.skipScrollCheck=!0;var c,d=a.offsetTop+a.clientTop-(o.top-s.top+a.clientTop)*p,f=a.offsetLeft+a.clientLeft-(o.left-s.left+a.clientLeft)*p;d+=10*(p-1)/2,f+=10*(p-1)/2,this.zoomCenter=null!==(c=this.zoomCenter)&&void 0!==c?c:{x:0,y:0},d+=(p-1)*this.zoomCenter.y,f+=(p-1)*this.zoomCenter.x,this.zoomCenter=null,e.element[0].scrollTop=d,e.element[0].scrollLeft=f,e.skipScrollCheck=!1}e.oldScrollHeight=e.element[0].scrollHeight,this.scrollBar[0].style.transform="none",this.updateScrollBar()}},{key:"onReady",value:function(){this.gotoPageCallBack(),this.oldScrollHeight=this.element[0].scrollHeight}},{key:"refresh",value:function(){for(var t=this,i=this.app,n=t.getVisiblePages().main,a=0;a<n.length;a++){var o=void 0,s=n[a];s!==(o=t.pages[s-1]).pageNumber&&(o.resetTexture(),this.app.textureRequestStatus=e.REQUEST_STATUS.ON),o.element.attr("number",s),o.pageNumber=s}t.requestRefresh(!1),i.textureRequestStatus=e.REQUEST_STATUS.ON}},{key:"isAnimating",value:function(){return this.scrollStatus===e.REQUEST_STATUS.ON||this.scrollStatus===e.REQUEST_STATUS.COUNT}},{key:"checkRequestQueue",value:function(){N(I(s.prototype),"checkRequestQueue",this).call(this),this.scrollStatus===e.REQUEST_STATUS.ON&&(this.scrollStatus=e.REQUEST_STATUS.OFF),this.scrollStatus===e.REQUEST_STATUS.COUNT&&(this.scrollStatus=e.REQUEST_STATUS.ON)}},{key:"isActivePage",value:function(e){return void 0!==this.visiblePagesCache&&this.visiblePagesCache.includes(e)}},{key:"getVisiblePages",value:function(){var e=F.getVisibleElements({container:this.element[0],elements:this.wrapper[0].children});return e=0===e.length?[this.app.currentPageNumber]:e.splice(0,this.pageBufferSize),this.visiblePagesCache=e,{main:e,buffer:[]}}},{key:"getPageByNumber",value:function(e){var t=this.pages[e-1];return void 0===t&&F.log("Page Not found for: "+e),t}},{key:"onScroll",value:function(t){for(var i=this,n=i.element[0].scrollTop+i.app.dimensions.containerHeight/2,a=i.getVisiblePages().main,o=a[0],s=0;s<a.length;s++){o=a[s];var r=i.pages[o-1].element[0],l=r.offsetTop+r.clientTop;if(l<=n&&r.clientHeight+l>=n)break;if(s>0&&l>n&&r.clientHeight+l>=n){o=a[s-1];break}}i.skipScrollIntoView=!0,i.app.gotoPage(o),i.skipScrollIntoView=!1,i.updateScrollBar(),t.preventDefault&&t.preventDefault(),t.stopPropagation(),i.requestRefresh(),this.scrollStatus=e.REQUEST_STATUS.COUNT,e.handlePopup(i.element,!1)}},{key:"updateScrollBar",value:function(){var e=this.element[0],t=(this.app.container[0],e.scrollLeft,60+(e.offsetHeight-40-60-60)*e.scrollTop/(e.scrollHeight-e.offsetHeight));isNaN(t)&&(t=60),this.scrollBar.lastY=t,this.scrollBar[0].style.transform="translateY("+t+"px)"}},{key:"validatePageChange",value:function(e){}},{key:"gotoPageCallBack",value:function(){var e=this;if(!0!==e.skipScrollIntoView){var t=e.getPageByNumber(e.app.currentPageNumber);null!=t&&F.scrollIntoView(t.element[0],e.element[0])}e.skipScrollIntoView=!1,e.requestRefresh()}},{key:"getTextureSize",value:function(e){var t=this.app.provider.viewPorts[1];this.app.provider.viewPorts[e.pageNumber]&&(t=this.app.provider.viewPorts[e.pageNumber]);var i=this.app.options.pixelRatio;return{height:t.height*this.app.zoomValue*this.app.pageScaleValue*i,width:t.width*this.app.zoomValue*this.app.pageScaleValue*i}}},{key:"textureLoadedCallback",value:function(e){var t=this.getPageByNumber(e.pageNumber),i=this.app,n=this.getViewPort(e.pageNumber,!0);t.element.height(Math.floor(n.height*i.pageScaleValue*i.zoomValue)).width(Math.floor(n.width*i.pageScaleValue*i.zoomValue))}},{key:"pan",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this,a=n.startPoint,o=t.raw.y-a.raw.y,s=t.raw.x-a.raw.x;n.deltaPanY+=o,n.deltaPanX+=s,n.panRequestStatus=e.REQUEST_STATUS.ON,!1===i&&(n.startPoint=t)}},{key:"updatePan",value:function(){this.element[0].scrollTop=this.element[0].scrollTop-this.deltaPanY,this.element[0].scrollLeft=this.element[0].scrollLeft-this.deltaPanX,this.deltaPanY=0,this.deltaPanX=0}},{key:"mouseMove",value:function(e){if(this.startPoint&&this.isScrollBarPressed){var t=F.fixMouseEvent(e),i=this.eventToPoint(t),n=this.element[0],a=this.scrollBar.lastY-(this.startPoint.raw.y-i.raw.y);return this.scrollBar.lastY=a,n.scrollTop=(a-60)*(n.scrollHeight-n.offsetHeight)/(n.offsetHeight-40-60-60),this.startPoint=i,void e.preventDefault()}e.touches&&e.touches.length<2||N(I(s.prototype),"mouseMove",this).call(this,e)}},{key:"mouseDown",value:function(e){N(I(s.prototype),"mouseDown",this).call(this,e),e.srcElement===this.scrollBar[0]&&(this.isScrollBarPressed=!0,this.scrollBar.addClass("df-active"),this.scrollPageNumber.addClass("df-active"))}},{key:"mouseUp",value:function(e){N(I(s.prototype),"mouseUp",this).call(this,e),(this.isScrollBarPressed=this.scrollBar)&&(this.isScrollBarPressed=!1,this.scrollBar.removeClass("df-active"),this.scrollPageNumber.removeClass("df-active"))}}],n&&L(i.prototype,n),a&&L(i,a),s}(y);function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t,i){return t&&B(e.prototype,t),i&&B(e,i),e}function H(e,t,i){return H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i||e):a.value}},H(e,t,i||e)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}function W(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function q(e,t){return q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},q(e,t)}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=V(e);if(t){var a=V(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return W(this,i)}}var Z=e.utils,K=function(t){j(n,t);var i=G(n);function n(t,a){var o,s;return z(this,n),t.viewerClass="df-flipbook "+(t.viewerClass||""),(o=i.call(this,t,a)).isFlipBook=!0,o.sheets=[],o.isRTL=o.app.isRTL,o.foldSense=50,o.isOneSided=!1,o.stackCount=null!==(s=t.stackCount)&&void 0!==s?s:6,o.annotedPage=null,o.pendingAnnotations=[],o.seamPosition=0,o.dragSheet=null,o.drag=null,o.soundOn=!0===t.enableSound,o.soundFile=null,o.minZoom=1,o.maxZoom=4,o.pureMaxZoom=4,o.app.options.pageSize!==e.FLIPBOOK_PAGE_SIZE.AUTO&&o.app.options.pageSize!==e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL||(o.app.checkSecondPage=!0),o.app.pageScaling=e.PAGE_SCALE.PAGE_FIT,t.viewerClass="",o.zoomViewer=new X(t,a),o}return U(n,[{key:"init",value:function(){H(V(n.prototype),"init",this).call(this),this.initSound();var t=this.app;this.pageMode=t.options.pageMode===e.FLIPBOOK_PAGE_MODE.AUTO?Z.isMobile||t.pageCount<=2?e.FLIPBOOK_PAGE_MODE.SINGLE:e.FLIPBOOK_PAGE_MODE.DOUBLE:t.options.pageMode,this.singlePageMode=t.options.singlePageMode||(Z.isMobile?e.FLIPBOOK_SINGLE_PAGE_MODE.BOOKLET:e.FLIPBOOK_SINGLE_PAGE_MODE.ZOOM),this.updatePageMode(),this.rightSheetHeight=this.leftSheetHeight=this._defaultPageSize.height,this.leftSheetWidth=this.rightSheetWidth=this._defaultPageSize.width,this.leftSheetTop=this.rightSheetTop=(this.availablePageHeight()-this._defaultPageSize.height)/2,this.zoomViewer.rightSheetHeight=this.zoomViewer.leftSheetHeight=this._defaultPageSize.height,this.zoomViewer.leftSheetWidth=this.zoomViewer.rightSheetWidth=this._defaultPageSize.width}},{key:"determineHeight",value:function(){}},{key:"initCustomControls",value:function(){H(V(n.prototype),"initCustomControls",this).call(this);var e=this,t=this.app,i=t.ui,a=i.controls,o=t.options.text,s=t.options.icons;a.sound=Z.createBtn("sound",s.sound,o.toggleSound).on("click",(function(){e.soundOn=!e.soundOn,i.updateSound()})),i.updateSound=function(){!1===e.soundOn?a.sound.addClass("disabled"):a.sound.removeClass("disabled")},i.updateSound()}},{key:"dispose",value:function(){H(V(n.prototype),"dispose",this).call(this);for(var e=0;e<this.sheets.length;e++){var t=this.sheets[e];t&&t.currentTween&&(t.currentTween.stop(),t.currentTween=null)}this.zoomViewer.dispose(),this.soundFile=null}},{key:"determinePageMode",value:function(){var t=this.app,i=this.pageMode;if(this.app.pageCount<3)this.pageMode=e.FLIPBOOK_PAGE_MODE.SINGLE;else if(this.app.options.pageMode===e.FLIPBOOK_PAGE_MODE.AUTO&&1!=this.pageModeChangedManually){if(!0===Z.isMobile)if(this.app.dimensions.isAutoHeight&&0==this.app.dimensions.isFixedHeight){var n=this._calculateInnerHeight(!0),a=this._calculateInnerHeight(!1),o=t.dimensions.stage.innerWidth+(1!=t.options.sideMenuOverlay&&t.isSideMenuOpen?220:0);this.pageMode=n>1.1*a&&o<768?e.FLIPBOOK_PAGE_MODE.SINGLE:e.FLIPBOOK_PAGE_MODE.DOUBLE,this._calculateInnerHeight()}else{var s=t.dimensions.stage.innerWidth+(1!=t.options.sideMenuOverlay&&t.isSideMenuOpen?220:0);this.pageMode=t.dimensions.stage.innerHeight>1.1*s&&s<768?e.FLIPBOOK_PAGE_MODE.SINGLE:e.FLIPBOOK_PAGE_MODE.DOUBLE}this.pageMode!=i&&this.setPageMode({isSingle:this.pageMode==e.FLIPBOOK_PAGE_MODE.SINGLE})}}},{key:"initSound",value:function(){this.soundFile=document.createElement("audio"),this.soundFile.setAttribute("src",this.app.options.soundFile+"?ver="+e.version),this.soundFile.setAttribute("type","audio/mpeg")}},{key:"playSound",value:function(){var e=this;try{!0===e.app.userHasInteracted&&!0===e.soundOn&&(e.soundFile.currentTime=0,e.soundFile.play())}catch(e){}}},{key:"checkDocumentPageSizes",value:function(){var t=this.app.provider;t.pageSize===e.FLIPBOOK_PAGE_SIZE.AUTO&&(t._page2Ratio&&t._page2Ratio>1.5*t.defaultPage.pageRatio?t.pageSize=e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL:t.pageSize=e.FLIPBOOK_PAGE_SIZE.SINGLE),t.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL&&(t.pageCount=1===t.numPages?1:2*t.numPages-2),t.pageSize!==e.FLIPBOOK_PAGE_SIZE.DOUBLE_COVER_BACK&&t.pageSize!==e.FLIPBOOK_PAGE_SIZE.DOUBLE||(t.pageCount=2*t.numPages)}},{key:"getViewerPageNumber",value:function(t){return this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL&&t>2&&(t=2*t-1),this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_COVER_BACK&&t>2&&(t=2*t-1),t}},{key:"getDocumentPageNumber",value:function(t){return this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL&&t>2?Math.ceil((t-1)/2)+1:this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_COVER_BACK&&t>1?t===this.app.pageCount?1:Math.ceil((t-1)/2)+1:t}},{key:"getViewPort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return this.filterViewPort(H(V(n.prototype),"getViewPort",this).call(this,e,t),e,i)}},{key:"isDoubleInternal",value:function(){return this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL}},{key:"isDoubleCoverBack",value:function(){return this.app.provider.pageSize===e.FLIPBOOK_PAGE_SIZE.DOUBLE_COVER_BACK}},{key:"isDoubleInternalPage",value:function(e){return this.isDoubleInternal()&&e>1&&e<this.app.provider.pageCount}},{key:"getDoublePageWidthFix",value:function(e){return this.isDoubleInternalPage(e)||this.isDoubleCoverBack()?2:1}},{key:"isDoublePageFix",value:function(e){var t=!1;return(this.isDoubleCoverBack()||this.isDoubleInternalPage(e))&&(this.app.isRTL?e%2==0&&(t=!0):e%2==1&&(t=!0)),t}},{key:"finalizeAnnotations",value:function(e,t){}},{key:"finalizeTextContent",value:function(e,t){this.app.zoomValue>this.app.viewer.pureMaxZoom&&(this.zoomViewer.leftViewPort&&this.zoomViewer.leftPage.contentLayer[0].style.setProperty("--scale-factor",this.zoomViewer.leftSheetHeight/this.zoomViewer.leftViewPort.height),this.zoomViewer.rightViewPort&&this.zoomViewer.rightPage.contentLayer[0].style.setProperty("--scale-factor",this.zoomViewer.rightSheetHeight/this.zoomViewer.rightViewPort.height))}},{key:"isActivePage",value:function(e){return void 0!==this.visiblePagesCache&&this.visiblePagesCache.includes(e)}},{key:"isSheetCover",value:function(e){var t=this.isBooklet;return 0===e||t&&1===e||e===Math.ceil(this.app.pageCount/(t?1:2))-(t?0:1)}},{key:"isSheetHard",value:function(e){var t=this.app.options.flipbookHardPages;this.isBooklet;if("cover"===t)return this.isSheetCover(e);if("all"===t)return!0;var i=(","+t+",").indexOf(","+(2*e+1)+",")>-1,n=(","+t+",").indexOf(","+(2*e+2)+",")>-1;return i||n}},{key:"sheetsIndexShift",value:function(e,t,i){e>t?(this.sheets[i-1].skipFlip=!0,this.sheets.unshift(this.sheets.pop())):e<t&&(this.sheets[0].skipFlip=!0,this.sheets.push(this.sheets.shift()))}},{key:"checkSwipe",value:function(e,t){var i=this;if(!0!==i.pinchZoomDirty&&1===i.app.zoomValue&&!0===i.canSwipe){var n="vertical"==i.orientation?e.y-i.lastPosY:e.x-i.lastPosX;Math.abs(n)>i.swipeThreshold&&(n<0?i.app.openRight():i.app.openLeft(),i.canSwipe=!1,t.preventDefault()),i.lastPosX=e.x,i.lastPosY=e.y}}},{key:"checkCenter",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this,a=this.app,o=e.FLIPBOOK_CENTER_SHIFT,s=a.currentPageNumber%2==0,r=n.getBasePage(),l=n.isRTL,h=n.isSingle;t=0===r||n.isBooklet?n.isRTL?o.RIGHT:o.LEFT:r===a.pageCount?l?o.LEFT:o.RIGHT:h?l?s?o.LEFT:o.RIGHT:s?o.RIGHT:o.LEFT:o.NONE,!0!==n.centerNeedsUpdate&&(n.centerNeedsUpdate=n.centerShift!==t),n.centerNeedsUpdate&&(n.centerShift=t,n.updateCenter(i),n.centerNeedsUpdate=!1)}},{key:"updateCenter",value:function(){}},{key:"reset",value:function(){for(var e,t=0;t<this.sheets.length;t++)(e=this.sheets[t]).reset(),e.pageNumber=-1,e.frontPage&&(e.frontPage.pageNumber=-1),e.backPage&&(e.backPage.pageNumber=-1),e.resetTexture();this.annotedPage=null,this.oldBasePageNumber=-1,this.centerShift=null,this.refresh()}},{key:"handleZoom",value:function(){var e=this.app,t=(e.dimensions,this.getLeftPageTextureSize({zoom:!1,isAnnotation:!0})),i=this.getRightPageTextureSize({zoom:!1,isAnnotation:!0});this.maxZoom,e.zoomValue;this.pureMaxZoom=e.dimensions.maxTextureSize/Math.max(t.height,t.width,i.height,i.width);var n=this.maxZoom=e.options.fakeZoom*this.pureMaxZoom,a=e.zoomValue,o=!1,s=!1;(n<this.minZoom&&(n=this.maxZoom=this.minZoom),!0===e.pendingZoom&&null!=e.zoomDelta)?a=e.zoomDelta>0?a*e.options.zoomRatio:a/e.options.zoomRatio:null!=this.lastScale&&(a*=this.lastScale,this.lastScale=null);a=Z.limitAt(a,this.minZoom,n),e.zoomValueChange=a/e.zoomValue,!(e.zoomChanged=e.zoomValue!==a)||1!==a&&1!==e.zoomValue||(o=1===a,s=1===e.zoomValue),e.zoomValue=a,(s||o)&&(e.container.toggleClass("df-zoom-active",1!==a),s&&this.enterZoom(),o&&this.exitZoom())}},{key:"refresh",value:function(){var t=this,i=this.app,n=t.stackCount,a=t.isRTL,o=t.isBooklet,s=t.getBasePage(),r=o?1:2;a&&(s=i.pageCount-s);var l,h=t.oldBasePageNumber,u=Math.ceil(i.pageCount/r),p=Math.floor(n/2);s!==t.oldBasePageNumber&&(t.pageNumberChanged=!0,this.updatePendingStatusClass(!0),t.zoomViewer.reset()),t.sheetsIndexShift(h,s,n);var c=Math.ceil(s/r);for(l=0;l<n;l++){var d=void 0,f=c-p+l;if(a&&(f=u-f-1),null!=(d=t.sheets[l])){d.targetSide=l<p?e.TURN_DIRECTION.LEFT:e.TURN_DIRECTION.RIGHT;var g=d.side!==d.targetSide,v=f!==d.pageNumber,m=g&&!1===d.skipFlip&&1===i.zoomValue;if(!g&&v&&d.isFlipping&&d.currentTween&&d.currentTween.stop(),d.isHard=t.isSheetHard(f),d.isCover=t.isSheetCover(f),v)d.resetTexture(),(this.app.isRTL?d.backPage:d.frontPage).pageNumber=this.isBooklet?f:2*f+1,(this.app.isRTL?d.frontPage:d.backPage).pageNumber=this.isBooklet?-1:2*f+2,i.textureRequestStatus=e.REQUEST_STATUS.ON;d.pageNumber=f,t.refreshSheet({sheet:d,sheetNumber:f,totalSheets:u,zIndex:this.stackCount+(l<p?l-p:p-l),visible:o?a?l<p||d.isFlipping||m:l>=p||d.isFlipping||m:f>=0&&f<u||o&&f===u,index:l,needsFlip:m,midPoint:p})}}t.requestRefresh(!1),i.textureRequestStatus=e.REQUEST_STATUS.ON,t.oldBasePageNumber=s,this.checkCenter(),this.zoomViewer.refresh(),t.pageNumberChanged=!1}},{key:"validatePageChange",value:function(e){if(e===this.app.currentPageNumber)return!1;var t=this.app,i=!this.isFlipping()||void 0===t.oldPageNumber;return i=(i=i||t.currentPageNumber<e&&t.oldPageNumber<t.currentPageNumber)||t.currentPageNumber>e&&t.oldPageNumber>t.currentPageNumber}},{key:"getVisiblePages",value:function(){for(var e=this,t=[],i=e.getBasePage(),n=e.app.zoomValue>1?1:e.isBooklet&&Z.isMobile?Math.min(e.stackCount/2,2):e.stackCount/2,a=0;a<n;a++)t.push(i-a),t.push(i+a+1);return this.visiblePagesCache=t,{main:t,buffer:[]}}},{key:"getBasePage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),this.isBooklet?e:2*Math.floor(e/2)}},{key:"getRightPageNumber",value:function(){return this.getBasePage()+(this.isBooklet||this.isRTL?0:1)}},{key:"getLeftPageNumber",value:function(){return this.getBasePage()+(this.isBooklet?0:this.isRTL?1:0)}},{key:"afterFlip",value:function(){!0!==this.isAnimating()&&(this.pagesReady(),this.updatePendingStatusClass())}},{key:"isFlipping",value:function(){var e=!1;return this.sheets.forEach((function(t){!0===t.isFlipping&&(e=!0)})),e}},{key:"isAnimating",value:function(){return this.isFlipping()}},{key:"mouseWheel",value:function(t){t.preventDefault(),this.app.options.mouseScrollAction===e.MOUSE_SCROLL_ACTIONS.ZOOM?this.zoomViewer.mouseWheel(t):H(V(n.prototype),"mouseWheel",this).call(this,t)}},{key:"checkRequestQueue",value:function(){this.app.zoomValue>1?this.zoomViewer.checkRequestQueue():H(V(n.prototype),"checkRequestQueue",this).call(this)}},{key:"updatePan",value:function(){}},{key:"resetPageTween",value:function(){}},{key:"gotoPageCallBack",value:function(){this.resetPageTween(),1!==this.app.zoomValue&&!0===this.app.options.resetZoomBeforeFlip&&this.app.resetZoom(),this.beforeFlip(),this.requestRefresh()}},{key:"beforeFlip",value:function(){var e=this;e.app.executeCallback("beforeFlip"),1===e.app.zoomValue&&e.playSound()}},{key:"onFlip",value:function(){this.app.executeCallback("onFlip")}},{key:"getAnnotationElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=void 0;return(a=this.app.zoomValue>1||!0===i?this.zoomViewer.getAnnotationElement(e,t):H(V(n.prototype),"getAnnotationElement",this).call(this,e,t))&&(a.parentNode.classList.toggle("df-double-internal",this.isDoubleInternalPage(e)),a.parentNode.classList.toggle("df-double-internal-fix",this.isDoublePageFix(e))),a}},{key:"getTextElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.app.zoomValue>1||!0===i?this.zoomViewer.getTextElement(e,t):H(V(n.prototype),"getTextElement",this).call(this,e,t)}},{key:"enterZoom",value:function(){this.exchangeTexture(this,this.zoomViewer)}},{key:"exitZoom",value:function(){this.exchangeTexture(this.zoomViewer,this)}},{key:"exchangeTexture",value:function(e,t){var i=this.getBasePage(),n=e.getPageByNumber(i),a=t.getPageByNumber(i);if(a&&"-1"===a.textureStamp?(a.textureStamp=n.textureStamp,a.loadTexture({texture:n.getTexture(!0)}),Z.log("Texture Exchanging at "+i)):Z.log("Texture Exchanging Bypassed at "+i),!this.isBooklet){var o=e.getPageByNumber(i+1),s=t.getPageByNumber(i+1);s&&"-1"===s.textureStamp?(s.textureStamp=o.textureStamp,s.loadTexture({texture:o.getTexture(!0)}),Z.log("Texture Exchanging at "+(i+1))):Z.log("Texture Exchanging Bypassed at "+(i+1))}t.pagesReady()}},{key:"setPageMode",value:function(t){var i=this.app,n=!0===t.isSingle;this.pageMode=n?e.FLIPBOOK_PAGE_MODE.SINGLE:e.FLIPBOOK_PAGE_MODE.DOUBLE,this.updatePageMode(),i.resizeRequestStart(),i.viewer.pageMode===e.FLIPBOOK_PAGE_MODE.DOUBLE&&i.ui.controls.pageMode?i.ui.controls.pageMode.removeClass(i.options.icons.doublepage).addClass(i.options.icons.singlepage).attr("title",i.options.text.singlePageMode).html("<span>"+i.options.text.singlePageMode+"</span>"):i.ui.controls.pageMode.addClass(i.options.icons.doublepage).removeClass(i.options.icons.singlepage).attr("title",i.options.text.doublePageMode).html("<span>"+i.options.text.doublePageMode+"</span>")}},{key:"updatePageMode",value:function(){this.app.pageCount<3&&(this.pageMode=e.FLIPBOOK_PAGE_MODE.SINGLE),this.isSingle=this.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE,this.isBooklet=this.isSingle&&this.singlePageMode===e.FLIPBOOK_SINGLE_PAGE_MODE.BOOKLET,this.app.jumpStep=this.isSingle?1:2,this.totalSheets=Math.ceil(this.app.pageCount/(this.isBooklet?1:2)),this.sheets.length>0&&this.reset()}},{key:"setPage",value:function(t){return t.textureTarget===e.TEXTURE_TARGET.ZOOM?this.zoomViewer.setPage(t):H(V(n.prototype),"setPage",this).call(this,t)}},{key:"_calculateInnerHeight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===t&&(t=this.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE);var i=this.app.dimensions.defaultPage.viewPort,n=this.availablePageWidth(!1,!0,t),a=this.app.dimensions.maxHeight-this.app.dimensions.padding.height;"vertical"==this.orientation&&0==t&&(a/=2),this._defaultPageSize=Z.contain(i.width,i.height,n,a),this._pageFitArea={width:n,height:a};var o=this.app.dimensions.isFixedHeight?a:this._pageFitArea.height;return this.app.dimensions.isAutoHeight&&0==this.app.dimensions.isFixedHeight&&(o=Math.floor(this._defaultPageSize.height)),o}},{key:"_getInnerHeight",value:function(){var e=this._calculateInnerHeight();return this.app.dimensions.stage.width=this.app.dimensions.stage.innerWidth+this.app.dimensions.padding.width,this.app.dimensions.stage.height=e+this.app.dimensions.padding.height,e}},{key:"availablePageWidth",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0===n&&(n=this.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE);var a=!0===i?this.app.dimensions.offset.width:0,o=this.app.dimensions.stage.innerWidth+a;return o/=!0===n||"vertical"==this.orientation?1:2,Math.floor(o*(t?this.app.zoomValue:1))}},{key:"availablePageHeight",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;void 0===i&&(i=this.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE);var n=this.app.dimensions.stage.innerHeight;return!1===i&&"vertical"==this.orientation&&(n/=2),Math.floor(n*(t?this.app.zoomValue:1))}},{key:"getTextureSize",value:function(e){var t=this.getViewPort(e.pageNumber,!0),i=this.app.options.pixelRatio,n=Z.contain(t.width,t.height,i*this.availablePageWidth(e.zoom),i*this.availablePageHeight(e.zoom));return{height:(n=Z.containUnStretched(n.width,n.height,this.app.options.maxTextureSize,this.app.options.maxTextureSize)).height,width:n.width}}},{key:"getLeftPageTextureSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.pageNumber=this.getLeftPageNumber(),this.getTextureSize(e)}},{key:"getRightPageTextureSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.pageNumber=this.getRightPageNumber(),this.getTextureSize(e)}},{key:"filterViewPort",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0!==e){if(1!=i)return e;var n=e.clone();return n.width=n.width/this.getDoublePageWidthFix(t),n}}},{key:"filterViewPortCanvas",value:function(e,t,i){this.isDoublePageFix(i)&&(e.transform[4]=e.transform[4]-Math.floor(Math.min(t.width,2*e.width-t.width))),e.widthFix=this.isDoubleInternalPage(i)?2:1}},{key:"isClosedPage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),1===e||e===this.app.jumpStep*Math.ceil(this.app.pageCount/this.app.jumpStep)&&!this.isBooklet}},{key:"isLeftPage",value:function(e){return void 0===e&&(e=this.app.currentPageNumber),this.isBooklet?this.isRTL:e%2==(this.isRTL?1:0)}},{key:"cleanPage",value:function(e){if(this.isDoubleInternalPage(e)){var t=e+(e%2==1?-1:1);return!1===this.app.provider.requestedPages[e]&&!1===this.app.provider.requestedPages[t]}return H(V(n.prototype),"cleanPage",this).call(this,e)}},{key:"onReady",value:function(){H(V(n.prototype),"onReady",this).call(this)}},{key:"searchPage",value:function(e){return{include:!this.isDoublePageFix(e),label:this.app.provider.getLabelforPage(e)+(this.isDoubleInternalPage(e)?"-"+this.app.provider.getLabelforPage(e+1):"")}}}]),n}(y),X=function(t){j(n,t);var i=G(n);function n(e,t){var a;return z(this,n),e.viewerClass="df-zoomview "+(e.viewerClass||""),(a=i.call(this,e,t)).viewer=a.app.viewer,a.events={},a.init(),a.initEvents(),a.left=0,a.top=0,a}return U(n,[{key:"init",value:function(){this.leftPage=new O,this.rightPage=new O,this.pages.push(this.leftPage),this.pages.push(this.rightPage),this.leftPage.element.addClass("df-page-back"),this.rightPage.element.addClass("df-page-front"),this.wrapper.append(this.leftPage.element),this.wrapper.append(this.rightPage.element),this.bookShadow=jQuery("<div>",{class:"df-book-shadow"}),this.wrapper.append(this.bookShadow),this.wrapper.addClass("df-sheet")}},{key:"initEvents",value:function(){this.stageDOM=this.element[0],H(V(n.prototype),"initEvents",this).call(this)}},{key:"dispose",value:function(){this.element.remove()}},{key:"resize",value:function(){var t=this,i=t.app.dimensions,n=i.padding,a=this.app.viewer.availablePageHeight(),o=this.app.viewer.availablePageWidth(),s=t.fullWidth=o*(this.app.viewer.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE?1:2),r=i.stage.innerWidth,l=i.stage.innerHeight,h=t.shiftHeight=Math.ceil(Z.limitAt((a-l)/2,0,a)),u=t.shiftWidth=Math.ceil(Z.limitAt((s-r)/2,0,s));1===t.app.zoomValue&&(t.left=0,t.top=0),t.element.css({top:-h,bottom:-h,right:-u,left:-u,paddingTop:n.top,paddingRight:n.right,paddingBottom:n.bottom,paddingLeft:n.left,transform:"translate3d("+t.left+"px,"+t.top+"px,0)"}),t.wrapper.css({width:s,height:a,marginTop:i.height-a-n.height>0?(i.height-n.height-a)/2:0}),this.wrapper.height(a).width(s-s%2),!0===t.app.pendingZoom&&t.zoom(),this.app.viewer.annotedPage=null,this.pagesReady()}},{key:"zoom",value:function(){var e=this,t=this.app;if(t.zoomChanged){var i=t.dimensions.origin,n=t.zoomValueChange;if(1===t.zoomValue)e.left=0,e.top=0;else{e.left*=n,e.top*=n,t.viewer.zoomCenter||(t.viewer.zoomCenter={x:i.x,y:i.y});var a={raw:t.viewer.zoomCenter},o={raw:{}},s=(a.raw.x-i.x)*n,r=(a.raw.y-i.y)*n;o.raw.x=i.x+s,o.raw.y=i.y+r,e.startPoint=o,e.pan(a),e.startPoint=null}}t.viewer.zoomCenter=null}},{key:"reset",value:function(){this.leftPage.resetTexture(),this.rightPage.resetTexture()}},{key:"refresh",value:function(){var e=this.app,t=e.viewer,i=t.getBasePage(),n=t.isBooklet?!e.isRTL:e.isRTL,a=n?this.rightPage:this.leftPage,o=n?this.leftPage:this.rightPage;a.pageNumber=i,o.pageNumber=i+1,a.updateCSS({display:0===i?"none":"block"}),o.updateCSS({display:o.pageNumber>e.pageCount||t.isBooklet?"none":"block"})}},{key:"updateCenter",value:function(){var e=this;if(null!==e&&null!==e.app.viewer){var t=e.app.viewer.centerShift,i=e.app.viewer.isRTL,n=t*(!i&&e.app.currentPageNumber>1||i&&e.app.currentPageNumber<e.app.pageCount?e.leftSheetWidth:e.rightSheetWidth)/2;e.wrapper[0].style.left=n+"px"}}},{key:"isDoubleInternalPage",value:function(e){return this.app.viewer.isDoubleInternalPage(e)}},{key:"pagesReady",value:function(){if(!this.app.viewer.isFlipping()&&(1!==this.app.zoomValue&&this.app.viewer.updatePendingStatusClass(!1),!1===this.app.options.flipbookFitPages)){var e=this.app.viewer.getBasePage(),t=this.leftViewPort=this.app.viewer.getViewPort(e+(this.app.viewer.isBooklet?0:this.app.viewer.isRTL?1:0)),i=this.rightViewPort=this.app.viewer.getViewPort(e+(this.app.viewer.isBooklet||this.app.viewer.isRTL?0:1));if(t){var n=Z.contain(t.width,t.height,this.app.viewer.availablePageWidth(),this.app.viewer.availablePageHeight());this.leftSheetWidth=Math.floor(n.width),this.leftSheetHeight=Math.floor(n.height),this.leftSheetTop=(this.app.viewer.availablePageHeight()-this.leftSheetHeight)/2,this.app.zoomValue>this.app.viewer.pureMaxZoom&&this.leftPage.contentLayer[0].style.setProperty("--scale-factor",this.leftSheetHeight/t.height)}if(i){var a=Z.contain(i.width,i.height,this.app.viewer.availablePageWidth(),this.app.viewer.availablePageHeight());this.rightSheetWidth=Math.floor(a.width),this.rightSheetHeight=Math.floor(a.height),this.rightSheetTop=(this.app.viewer.availablePageHeight()-this.rightSheetHeight)/2,this.app.zoomValue>this.app.viewer.pureMaxZoom&&this.rightPage.contentLayer[0].style.setProperty("--scale-factor",this.rightSheetHeight/i.height)}null==t&&null==i||(this.totalSheetsWidth=this.leftSheetWidth+this.rightSheetWidth,this.leftPage.element.height(Math.floor(this.leftSheetHeight)).width(Math.floor(this.leftSheetWidth)).css({transform:"translateY("+Math.floor(this.leftSheetTop)+"px)"}),this.rightPage.element.height(Math.floor(this.rightSheetHeight)).width(Math.floor(this.rightSheetWidth)).css({transform:"translateY("+Math.floor(this.rightSheetTop)+"px)"}))}}},{key:"textureLoadedCallback",value:function(e){this.getPageByNumber(e.pageNumber);this.pagesReady()}}]),n}(y),Q=function(){function t(e){z(this,t),this.parentElement=e.parentElement,this.isFlipping=!1,this.isOneSided=!1,this.viewer=e.viewer,this.frontPage=null,this.backPage=null,this.pageNumber=void 0,this.animateToReset=null}return U(t,[{key:"init",value:function(){}},{key:"flip",value:function(){}},{key:"frontImage",value:function(e){this.frontPage.loadTexture({texture:e.texture,callback:e.callback})}},{key:"backImage",value:function(e){this.backPage.loadTexture({texture:e.texture,callback:e.callback})}},{key:"resetTexture",value:function(){this.frontPage.resetTexture(),this.backPage.resetTexture()}},{key:"reset",value:function(){var t=this;t.animateToReset=null,t.isFlipping=!1,t.currentTween=null,t.pendingPoint=null,t.magnetic=!1,t.skipFlip=!0,t.animateToReset=null,t.viewer.dragPage=null,t.viewer.flipPage=null,t.viewer.corner=e.TURN_CORNER.NONE}}]),t}();function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t,i){return t&&J(e.prototype,t),i&&J(e,i),e}function ee(e,t,i){return ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=te(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i||e):a.value}},ee(e,t,i||e)}function te(e){return te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},te(e)}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}function ne(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function ae(e,t){return ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ae(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=te(e);if(t){var a=te(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return ne(this,i)}}var se=e,re=se.utils,le=function(t){ie(n,t);var i=oe(n);function n(e){var t;return Y(this,n),(t=i.call(this,e)).init(),t}return $(n,[{key:"init",value:function(){var e=this,t="<div>",i=e.element=jQuery(t,{class:"df-sheet"}),n=e.frontPage=new O;n.element.addClass("df-page-front");var a=e.backPage=new O;a.element.addClass("df-page-back");var o=e.wrapper=jQuery(t,{class:"df-sheet-wrapper"}),s=e.foldInnerShadow=jQuery(t,{class:"df-sheet-fold-inner-shadow"}),r=e.foldOuterShadow=jQuery(t,{class:"df-sheet-fold-outer-shadow"});this.parentElement.append(i),i.append(o),i.append(r),o.append(n.element),o.append(a.element),o.append(s)}},{key:"updateCSS",value:function(e){this.element.css(e)}},{key:"resetCSS",value:function(){var e=this;e.wrapper.css({transform:""}),e.frontPage.resetCSS(),e.backPage.resetCSS()}},{key:"updateSize",value:function(e,t,i){e=Math.floor(e),t=Math.floor(t),i=Math.floor(i),this.wrapper[0].style.height=this.wrapper[0].style.width=Math.ceil(re.distOrigin(e,t)*this.viewer.app.zoomValue)+"px",this.element[0].style.height=this.frontPage.element[0].style.height=this.backPage.element[0].style.height=this.foldInnerShadow[0].style.height=t+"px",this.element[0].style.width=this.frontPage.element[0].style.width=this.backPage.element[0].style.width=this.foldInnerShadow[0].style.width=e+"px",this.element[0].style.transform="translateY("+i+"px)"}},{key:"flip",value:function(t){var i=this;if(t=t||i.pendingPoint,null!=i&&null!=i.viewer){i.isFlipping=!0,i.viewer.flipPage=i;var n,a,o=i.viewer.isBooklet,s=i.side===e.TURN_DIRECTION.RIGHT,r=i.viewer.isRTL,l=i.viewer.corner===e.TURN_CORNER.BL||i.viewer.corner===e.TURN_CORNER.BR?i.element.height():0,h=i.viewer.leftSheetWidth+i.viewer.rightSheetWidth,u=0;a=i.end=i&&!0===i.animateToReset?{x:s?h:0,y:l}:{x:s?0:h,y:l},i.flipEasing=i.isHard?TWEEN.Easing.Quadratic.InOut:TWEEN.Easing.Linear.None;var p=i.viewer.app.options.duration;!0===i.isHard?(null!=t&&(u=re.angleByDistance(t.distance,t.fullWidth)),n=i.init={angle:u*(s?-1:1)},a=i.end=i&&!0===i.animateToReset?{angle:s?0:-0}:{angle:s?-180:180}):null==t?n=i.init=i&&!0===i.animateToReset?{x:s?0:h,y:0}:{x:s?h:0,y:0}:(n=i.init={x:t.x,y:t.y,opacity:1},p=i.viewer.app.options.duration*re.distPoints(n.x,n.y,a.x,a.y)/i.viewer.fullWidth,p=re.limitAt(p,i.viewer.app.options.duration/3,i.viewer.duration)),n.index=0,a.index=1,i.isFlipping=!0,o&&(!s&&!r||s&&r)&&(i.element[0].style.opacity=0),!0===i.isHard?i.currentTween=new TWEEN.Tween(n).delay(0).to(a,i.viewer.app.options.duration).onUpdate((function(){i.updateTween(this)})).easing(i.flipEasing).onComplete(i.completeTween.bind(i)).start():i.currentTween=null==t?new TWEEN.Tween(n).delay(0).to(a,i.viewer.app.options.duration).onUpdate((function(){i.updateTween(this)})).easing(TWEEN.Easing.Sinusoidal.Out).onComplete(i.completeTween.bind(i)).start():new TWEEN.Tween(n).delay(0).to(a,p).onUpdate((function(){i.updateTween(this)})).easing(TWEEN.Easing.Sinusoidal.Out).onComplete(i.completeTween.bind(i)).start()}}},{key:"updatePoint",value:function(t){var i=this;if(null!=t){var n=i.element.width(),a=i.element.height(),o=i.viewer.corner!==e.TURN_CORNER.NONE?i.viewer.corner:t.corner,s=e.TURN_CORNER,r=i.side===e.TURN_DIRECTION.RIGHT,l=o===s.BL||o===s.BR;t.rx=!0===r?i.viewer.leftSheetWidth+n-t.x:t.x,t.ry=!0===l?a-t.y:t.y;var h=Math.atan2(t.ry,t.rx);h=Math.PI/2-re.limitAt(h,0,re.toRad(90));var u=n-t.rx/2,p=t.ry/2,c=Math.max(0,Math.sin(h-Math.atan2(p,u))*re.distOrigin(u,p)),d=.5*re.distOrigin(t.rx,t.ry),f=Math.ceil(n-c*Math.sin(h)),g=Math.ceil(c*Math.cos(h)),v=re.toDeg(h),m=l?r?90-v+180:180+v:r?v:90-v,y=l?r?90-v+180:v:r?v+180:m,b=l?r?90-v:v+90:r?m-90:m+180,w=r?n-f:f,P=l?a+g:-g,S=r?-f:f-n,x=l?-a-g:g,C=re.limitAt(.5*t.distance/n,0,.5),T=re.limitAt(.5*(i.viewer.leftSheetWidth+n-t.rx)/n,.05,.3);i.element.addClass("df-folding");var E=r?i.backPage.element:i.frontPage.element,k=r?i.frontPage.element:i.backPage.element,O=i.foldOuterShadow,R=i.foldInnerShadow;i.wrapper.css({transform:re.translateStr(w,P)+re.rotateStr(m)}),k.css({transform:re.rotateStr(-m)+re.translateStr(-w,-P)}),E.css({transform:re.rotateStr(y)+re.translateStr(S,x),boxShadow:"rgba(0, 0, 0, "+C+") 0px 0px 20px"}),R.css({transform:re.rotateStr(y)+re.translateStr(S,x),opacity:T/2,backgroundImage:re.prefix.css+"linear-gradient( "+b+"deg, rgba(0, 0, 0, 0.25) , rgb(0, 0, 0) "+.7*d+"px, rgb(255, 255, 255) "+d+"px)"}),O.css({opacity:T/2,left:r?"auto":0,right:r?0:"auto",backgroundImage:re.prefix.css+"linear-gradient( "+(180-b)+"deg, rgba(0, 0, 0,0) "+d/3+"px, rgb(0, 0, 0) "+d+"px)"})}}},{key:"updateAngle",value:function(e,t){var i=this,n=5*i.element.width();i.wrapper.css({perspective:n,perspectiveOrigin:!0===t?"0% 50%":"100% 50%"}),i.element.addClass("df-folding"),i.backPage.updateCSS({display:!0===t?e<=-90?"block":"none":e<90?"block":"none",transform:("MfS"!==re.prefix.dom?"":"perspective("+n+"px) ")+(!0===t?"translateX(-100%) ":"")+"rotateY("+((!0===t?180:0)+e)+"deg)"}),i.frontPage.updateCSS({display:!0===t?e>-90?"block":"none":e>=90?"block":"none",transform:("MSd"!==re.prefix.dom?"":"perspective("+n+"px) ")+(!1===t?"translateX(100%) ":"")+"rotateY("+((!1===t?-180:0)+e)+"deg)"})}},{key:"updateTween",value:function(t){var i=this,n=i.viewer.isBooklet,a=i.side===e.TURN_DIRECTION.RIGHT,o=i.viewer.isRTL,s=!0===i.animateToReset;!0===i.isHard?(i.updateAngle(t.angle,a),i.angle=t.angle):(i.updatePoint({x:t.x,y:t.y}),i.x=t.x,i.y=t.y),n&&!s&&(i.element[0].style.opacity=a&&!o||!a&&o?t.index>.5?2*(1-t.index):1:t.index<.5?2*t.index:1)}},{key:"completeTween",value:function(){var e=this;!0===e.isHard?(e.updateAngle(e.end.angle),e.backPage.element.css({display:"block"}),e.frontPage.element.css({display:"block"})):e.updatePoint({x:e.end.x,y:e.end.y}),e.element[0].style.opacity=1,!0!==e.animateToReset&&(e.side=e.targetSide),e.reset(),e.viewer.onFlip(),e.viewer.afterFlip(),e.viewer.requestRefresh()}}]),n}(Q),he=function(t){ie(n,t);var i=oe(n);function n(t,a){var o,s;return Y(this,n),t.viewerClass=null!==(s=t.viewerClass)&&void 0!==s?s:"df-flipbook-2d",t.skipViewerLoaded=!0,(o=i.call(this,t,a)).bookShadow=jQuery("<div>",{class:"df-book-shadow"}),o.wrapper.append(o.bookShadow),o.corner=e.TURN_CORNER.NONE,a._viewerPrepared(),o}return $(n,[{key:"init",value:function(){ee(te(n.prototype),"init",this).call(this),this.initEvents(),this.initPages()}},{key:"initEvents",value:function(){this.stageDOM=this.element[0],ee(te(n.prototype),"initEvents",this).call(this)}},{key:"dispose",value:function(){ee(te(n.prototype),"dispose",this).call(this),this.element.remove()}},{key:"initPages",value:function(){for(var e=0;e<this.stackCount;e++){var t=new le({parentElement:this.wrapper});t.index=e,t.viewer=this,this.sheets.push(t),this.pages.push(t.frontPage),this.pages.push(t.backPage)}}},{key:"resize",value:function(){ee(te(n.prototype),"resize",this).call(this);var e=this,t=e.app.dimensions,i=t.padding,a=this.availablePageHeight(),o=this.availablePageWidth(),s=e.fullWidth=2*o,r=t.width,l=t.height,h=e.shiftHeight=Math.ceil(re.limitAt((a-l+i.height)/2,0,a)),u=e.shiftWidth=Math.ceil(re.limitAt((s-r+i.width)/2,0,s));1===e.app.zoomValue&&(e.left=0,e.top=0),e.element.css({top:-h,bottom:-h,right:-u,left:-u,paddingTop:i.top,paddingRight:i.right,paddingBottom:i.bottom,paddingLeft:i.left,transform:"translate3d("+e.left+"px,"+e.top+"px,0)"}),e.wrapper.css({marginTop:Math.max(t.height-a-i.height)/2,height:a,width:s-s%2}),e.zoomViewer.resize(),e.centerNeedsUpdate=!0,e.checkCenter(!0),e.pagesReady()}},{key:"updateCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,i=t.centerShift,n=(t.isRTL,this.isLeftPage()?this.leftSheetWidth:this.rightSheetWidth),a=i*n/2;t.seamPosition=(-t.app.dimensions.offset.width+t.app.dimensions.containerWidth)/2+a,t.wrapperShift=(t.isSingle?-t.app.dimensions.stage.innerWidth/2:0)+a,t.wrapper[0].style.left=t.wrapperShift+"px",t.wrapper[0].style.transition=e?"none":"",this.zoomViewer.updateCenter()}},{key:"refreshSheet",value:function(e){var t=e.sheet,i=e.sheetNumber;!1===t.isFlipping&&(e.needsFlip?(t.element.addClass("df-flipping"),t.flip()):(t.skipFlip=!1,t.element.removeClass("df-flipping df-quick-turn df-folding df-left-side df-right-side"),t.element.addClass(t.targetSide===se.TURN_DIRECTION.LEFT?"df-left-side":"df-right-side"),t.side=t.targetSide,t.targetSide===se.TURN_DIRECTION.LEFT?t.updateSize(this.leftSheetWidth,this.leftSheetHeight,this.leftSheetTop):t.updateSize(this.rightSheetWidth,this.rightSheetHeight,this.rightSheetTop))),t.visible=e.visible,t.isHard?t.element.addClass("df-hard-sheet"):(t.element.removeClass("df-hard-sheet"),t.frontPage.updateCSS({display:"block"}),t.backPage.updateCSS({display:"block"})),t.updateCSS({display:!0===t.visible?"block":"none",zIndex:e.zIndex}),null==t.pendingPoint&&!1===t.isFlipping&&t.resetCSS(),i!==t.pageNumber&&(t.element.attr("number",i),t.backPage.element.attr("pagenumber",t.backPage.pageNumber),t.frontPage.element.attr("pagenumber",t.frontPage.pageNumber))}},{key:"eventToPoint",value:function(e){var t=this;e=re.fixMouseEvent(e);var i,n,a,o,s,r,l,h,u,p=t.wrapper[0].getBoundingClientRect(),c=t.is3D,d=t.sheets,f=(t.app.dimensions,{x:e.clientX,y:e.clientY}),g=t.parentElement[0].getBoundingClientRect();f.x=f.x-g.left,f.y=f.y-g.top,i=(u=t.dragSheet?t.dragSheet.side===se.TURN_DIRECTION.RIGHT:f.x>t.seamPosition)?t.rightSheetWidth:t.leftSheetWidth,a=u?t.rightSheetHeight:t.leftSheetHeight,n=t.rightSheetWidth+t.leftSheetWidth,s=u?t.rightSheetTop:t.leftSheetTop,o=f.x-(t.seamPosition-t.leftSheetWidth),s=f.y-(p.top-g.top)-s,r=t.drag===se.TURN_DIRECTION.NONE?o<i?o:n-o:t.drag===se.TURN_DIRECTION.LEFT?o:n-o,l=u?d[t.stackCount/2]:d[t.stackCount/2-1],h=o<t.foldSense?se.TURN_DIRECTION.LEFT:o>n-t.foldSense?se.TURN_DIRECTION.RIGHT:se.TURN_DIRECTION.NONE;var v,m=o,y=s,b=a,w=n,P=t.foldSense;return{isInsideSheet:m>=0&&m<=w&&y>=0&&y<=b,isInsideCorner:(v=m>=0&&m<P?y>=0&&y<=P?se.TURN_CORNER.TL:y>=b-P&&y<=b?se.TURN_CORNER.BL:y>P&&y<b-P?se.TURN_CORNER.L:se.TURN_CORNER.NONE:m>=w-P&&m<=w?y>=0&&y<=P?se.TURN_CORNER.TR:y>=b-P&&y<=b?se.TURN_CORNER.BR:y>P&&y<b-P?se.TURN_CORNER.R:se.TURN_CORNER.NONE:se.TURN_CORNER.NONE)!==se.TURN_CORNER.NONE&&v!==se.TURN_CORNER.L&&v!==se.TURN_CORNER.R,x:c?f.x:o,y:c?f.y:s,fullWidth:n,sheetWidth:i,sheetHeight:a,rawDistance:n-o,distance:r,sheet:l,drag:h,foldSense:t.foldSense,event:e,raw:f,corner:v}}},{key:"pan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];re.pan(this,e,t)}},{key:"mouseMove",value:function(e){var t=this,i=t.eventToPoint(e);if(null==e.touches||2!=e.touches.length){1!==t.app.zoomValue&&null!=t.startPoint&&!0===t.canSwipe&&(t.pan(i),e.preventDefault());var n=t.dragSheet||i.sheet;if(null==t.flipPage&&(null!=t.dragSheet||!0===i.isInsideCorner)){null!=t.dragSheet||(i.y=re.limitAt(i.y,1,t.availablePageHeight()-1),i.x=re.limitAt(i.x,1,i.fullWidth-1));var a=null!=t.dragSheet?t.corner:i.corner;if(n.isHard){var o=a===se.TURN_CORNER.BR||a===se.TURN_CORNER.TR,s=re.angleByDistance(i.distance,i.fullWidth);n.updateAngle(s*(o?-1:1),o)}else n.updatePoint(i);n.magnetic=!0,n.magneticCorner=i.corner,e.preventDefault()}null==t.dragSheet&&null!=n&&!1===i.isInsideCorner&&!0===n.magnetic&&(n.pendingPoint=i,n.animateToReset=!0,n.magnetic=!1,t.corner=n.magneticCorner,n.flip(n.pendingPoint),n.pendingPoint=null),t.checkSwipe(i,e)}else this.pinchMove(e)}},{key:"mouseUp",value:function(t){var i=this;if(null!=i.startPoint&&(t.touches||0===t.button))if(null!=i.dragSheet||null==t.touches||0!=t.touches.length){var n=i.eventToPoint(t),a=t.target||t.originalTarget,o=1===i.app.zoomValue&&n.x===i.startPoint.x&&n.y===i.startPoint.y&&"A"!==a.nodeName;if(!0===t.ctrlKey&&o)this.zoomOnPoint(n);else if(i.dragSheet){t.preventDefault();var s=i.dragSheet;if(s.pendingPoint=n,i.drag=n.drag,o&&(!0===n.isInsideCorner||n.isInsideSheet&&i.clickAction===se.MOUSE_CLICK_ACTIONS.NAV))n.corner.indexOf("l")>-1?i.app.openLeft():i.app.openRight();else{var r=this.getBasePage();n.distance>n.sheetWidth/2&&(n.sheet.side===e.TURN_DIRECTION.LEFT?i.app.openLeft():i.app.openRight()),r===this.getBasePage()&&(s.animateToReset=!0,s.flip(n))}i.dragSheet=null,s.magnetic=!1}else o&&!n.sheet.isFlipping&&n.isInsideSheet&&i.clickAction===se.MOUSE_CLICK_ACTIONS.NAV&&("left"===n.sheet.side?i.app.openLeft():i.app.openRight());i.startPoint=null,i.canSwipe=!1,i.drag=se.TURN_DIRECTION.NONE}else this.pinchUp(t)}},{key:"mouseDown",value:function(e){if(e.touches||0===e.button)if(null==e.touches||2!=e.touches.length){var t=this,i=t.eventToPoint(e);t.startPoint=i,t.lastPosX=i.x,t.lastPosY=i.y,i.isInsideCorner&&null==t.flipPage?(t.dragSheet=i.sheet,t.drag=i.drag,t.corner=i.corner,0===i.sheet.pageNumber?t.bookShadow.css({width:"50%",left:t.app.isRTL?0:"50%",transitionDelay:""}):i.sheet.pageNumber===Math.ceil(t.app.pageCount/2)-1&&t.bookShadow.css({width:"50%",left:t.app.isRTL?"50%":0,transitionDelay:""})):t.canSwipe=!0}else this.pinchDown(e)}},{key:"onScroll",value:function(e){}},{key:"resetPageTween",value:function(){for(var e=this,t=0;t<e.stackCount;t++){var i=e.sheets[t];i.currentTween&&i.currentTween.complete(!0)}e.requestRefresh()}},{key:"pagesReady",value:function(){if(!this.isFlipping()){if(!1===this.app.options.flipbookFitPages){var e=this.app.viewer.getBasePage(),t=this.leftViewport=this.getViewPort(e+(this.isBooklet?0:this.isRTL?1:0)),i=this.rightViewPort=this.getViewPort(e+(this.isBooklet||this.isRTL?0:1));if(t){var n=re.contain(t.width,t.height,this.availablePageWidth(),this.availablePageHeight());this.leftSheetWidth=Math.floor(n.width),this.leftSheetHeight=Math.floor(n.height),this.leftSheetTop=(this.availablePageHeight()-this.leftSheetHeight)/2}if(i){var a=re.contain(i.width,i.height,this.availablePageWidth(),this.availablePageHeight());this.rightSheetWidth=Math.floor(a.width),this.rightSheetHeight=Math.floor(a.height),this.rightSheetTop=(this.availablePageHeight()-this.rightSheetHeight)/2}this.totalSheetsWidth=this.leftSheetWidth+this.rightSheetWidth;for(var o=0;o<this.sheets.length;o++){var s=this.sheets[o];s.side===se.TURN_DIRECTION.LEFT?s.updateSize(this.leftSheetWidth,this.leftSheetHeight,this.leftSheetTop):s.updateSize(this.rightSheetWidth,this.rightSheetHeight,this.rightSheetTop)}}this.updateCenter(),this.updatePendingStatusClass()}}},{key:"textureLoadedCallback",value:function(e){this.getPageByNumber(e.pageNumber);this.pagesReady()}}]),n}(K);function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t,i){return t&&pe(e.prototype,t),i&&pe(e,i),e}function de(e,t,i){return de="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fe(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i||e):a.value}},de(e,t,i||e)}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}function ge(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}function ve(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function me(e,t){return me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},me(e,t)}function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=fe(e);if(t){var a=fe(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return ve(this,i)}}var be=e.utils,we=function(e){ge(i,e);var t=ye(i);function i(){return ue(this,i),t.apply(this,arguments)}return ce(i,[{key:"init",value:function(){var e=this,t=e.element=jQuery("<div>",{class:"df-sheet"});(e.frontPage=new O).element.addClass("df-page-front").appendTo(e.element),(e.backPage=new O).element.addClass("df-page-back").appendTo(e.element),this.parentElement.append(t),this.frontPage.sheet=this.backPage.sheet=this}},{key:"completeTween",value:function(){var e=this;e.isFlipping=!1,e.viewer.onFlip(),e.viewer.afterFlip(),e.viewer.requestRefresh(),e.element[0].style.opacity=1}},{key:"flip",value:function(e){this.side=this.targetSide,this.completeTween()}},{key:"updateSize",value:function(e,t,i){e=Math.floor(e),t=Math.floor(t),i=Math.floor(i),this.element[0].style.height=this.frontPage.element[0].style.height=t+"px",this.element[0].style.width=this.frontPage.element[0].style.width=e+"px",this.element[0].style.transform="translateX("+this.positionX+"px) translateY("+i+"px)"}}]),i}(le),Pe=function(t){ge(n,t);var i=ye(n);function n(t,a){var o;return ue(this,n),t.viewerClass="df-slider",t.pageMode=e.FLIPBOOK_PAGE_MODE.SINGLE,t.singlePageMode=e.FLIPBOOK_SINGLE_PAGE_MODE.BOOKLET,t.pageSize=e.FLIPBOOK_PAGE_SIZE.SINGLE,(o=i.call(this,t,a)).stackCount=10,o.soundOn=!1,o.foldSense=0,a._viewerPrepared(),o}return ce(n,[{key:"initPages",value:function(){for(var e=0;e<this.stackCount;e++){var t=new we({parentElement:this.wrapper});t.index=e,t.viewer=this,this.sheets.push(t),this.pages.push(t.frontPage),this.pages.push(t.backPage)}}},{key:"resize",value:function(){de(fe(n.prototype),"resize",this).call(this),this.skipTransition=!0}},{key:"refreshSheet",value:function(t){var i=t.sheet,n=t.sheetNumber;i.element.toggleClass("df-no-transition",i.skipFlip||this.skipTransition),!1===i.isFlipping&&(t.needsFlip?i.flip():(i.skipFlip=!1,i.element.removeClass("df-flipping df-quick-turn df-folding df-left-side df-right-side"),i.element.addClass(i.targetSide===e.TURN_DIRECTION.LEFT?"df-left-side":"df-right-side"),i.side=i.targetSide)),i.visible=t.visible,i.updateCSS({display:t.sheetNumber>0&&t.sheetNumber<=this.app.pageCount?"block":"none",zIndex:t.zIndex}),n!==i.pageNumber&&(i.element.attr("number",n),i.backPage.element.attr("pagenumber",i.backPage.pageNumber),i.frontPage.element.attr("pagenumber",i.frontPage.pageNumber))}},{key:"refresh",value:function(){de(fe(n.prototype),"refresh",this).call(this),this.skipTransition=!1}},{key:"eventToPoint",value:function(e){var t=de(fe(n.prototype),"eventToPoint",this).call(this,e);return t.isInsideSheet=jQuery(e.srcElement).closest(".df-page").length>0,t.isInsideCorner=!1,t}},{key:"initCustomControls",value:function(){var e=this.app.ui.controls;e.pageMode&&e.pageMode.hide()}},{key:"setPageMode",value:function(e){e.isSingle=!0,de(fe(n.prototype),"setPageMode",this).call(this,e)}},{key:"pagesReady",value:function(){if(!this.isFlipping()){for(var e=0,t=0,i=this.app,n=(Math.floor(this.stackCount/2),[]),a=i.currentPageNumber,o=0;o<this.stackCount/2;o++)n.push(a+o),n.push(a-o-1);for(var s=0;s<this.stackCount;s++){var r=n[s];if(this.getPageByNumber(r)){var l=this.getPageByNumber(r).sheet,h=this.getViewPort(l.pageNumber,!0),u=be.contain(h.width,h.height,this.availablePageWidth(),this.availablePageHeight());i.currentPageNumber===l.pageNumber&&(this.leftSheetWidth=this.rightSheetWidth=Math.floor(u.width)),i.currentPageNumber>l.pageNumber?(e-=Math.floor(u.width)+10,l.positionX=e):(l.positionX=t,t+=Math.floor(u.width)+10);var p=(this.availablePageHeight()-u.height)/2;l.updateSize(Math.floor(u.width*i.zoomValue),Math.floor(u.height*i.zoomValue),p)}}this.updateCenter(),this.updatePendingStatusClass()}}}]),n}(he);function Se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t,i){return t&&Ce(e.prototype,t),i&&Ce(e,i),e}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}function Oe(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Re(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?Se(e):t;var i}function Le(e,t){return Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Le(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Ee(e);if(t){var a=Ee(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Re(this,i)}}var Ie={};function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fe(e,t,i){return t&&Me(e.prototype,t),i&&Me(e,i),e}function De(e,t,i){return De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ze(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i||e):a.value}},De(e,t,i||e)}function ze(e){return ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(e)}function Be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}function Ue(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?_e(e):t;var i}function He(e,t){return He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},He(e,t)}function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ze(e);if(t){var a=ze(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Ue(this,i)}}Ie.init=function(){if(!0!==Ie.initialized){var e=window.THREE;Ie={init:function(){},initialized:!0,GEOMETRY_TYPE:{PLANE:0,BOX:1,MODEL:2},MATERIAL_FACE:{FRONT:5,BACK:4},WHITE_COLOR:new e.Color("white"),defaults:{anisotropy:8,maxTextureSize:2048,groundTexture:"blank",color:16777215,shininess:15,width:210,height:297,depth:.2,segments:150,textureLoadFallback:"blank"},textureLoader:new e.TextureLoader,clearChild:function(e){var t,i=e.material;if(e.parent.remove(e),e=u.disposeObject(e),null!=i){if(null==i.length)i.map&&(t=i.map,i.dispose(),t.dispose()),i.bumpMap&&(t=i.bumpMap,i.dispose(),t.dispose()),i.normalMap&&(t=i.normalMap,i.dispose(),t.dispose());else for(var n=0;n<i.length;n++)i[n]&&(i[n].map&&(t=i[n].map,i[n].dispose(),t.dispose()),i[n].bumpMap&&(t=i[n].bumpMap,i[n].dispose(),t.dispose()),i[n].normalMap&&(t=i[n].normalMap,i[n].dispose(),t.dispose())),i[n]=null;i=null,t=null}},loadImage:function(t,i,n,a,o){if(null==i){var s=null==t.material[n]?null:t.material[n][a]?t.material[n][a].sourceFile:null;return null==s||s.indexOf("data:image")>-1?null:s}var r=null;return"CANVAS"===i.nodeName||"IMG"===i.nodeName?((r=new e.Texture(i)).needsUpdate=!0,Ie.loadTexture(r,t,a,n),"function"==typeof o&&o(t,r)):"blank"!==i?(r=null==i?null:Ie.textureLoader.load(i,(function(e){e.sourceFile=i,Ie.loadTexture(e,t,a,n),"function"==typeof o&&o(t,e)}),void 0,(function(){null==r.image&&Ie.loadImage(t,Ie.defaults.textureLoadFallback,n,a),Ie.loadTextureFailed()})))&&(r.mapping=e.UVMapping):(Ie.loadTexture(null,t,a,n),"function"==typeof o&&o(t,r)),0},loadTexture:function(t,i,n,a){if(t){var o=t.image;t.naturalWidth=o.naturalWidth,t.naturalHeight=o.naturalHeight,t.needsUpdate=!0,null!=i.textureRotation&&(t.rotation=e.MathUtils.degToRad(i.textureRotation),t.center=i.textureCenter)}null!==t&&"map"===n&&(t.anisotropy=0,Ie.defaults.anisotropy>0&&(t.anisotropy=Ie.defaults.anisotropy),!0===e.skipPowerOfTwo&&(t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter),t.name=(new Date).toTimeString()),Ie.clearTexture(i.material[a][n]),i.material[a][n]=t,"bumpMap"===n&&(i.material[a].bumpScale=i.sheet.getBumpScale(a)),i.material[a].needsUpdate=!0},loadTextureFailed:function(){return null},clearTexture:function(e){e&&(e.image&&"CANVAS"===e.image.nodeName&&(e.image.remove&&e.image.remove(),delete e.image),e=u.disposeObject(e))}},e.skipPowerOfTwo=!0;var t=function(t){ke(n,t);var i=Ne(n);function n(t){var a;xe(this,n);var o=t.width||Ie.defaults.width,s=t.height||Ie.defaults.height,r=t.color||Ie.defaults.color,l=t.segments||Ie.defaults.segments,h=t.depth||Ie.defaults.depth,u={color:r,flatShading:!1,shininess:t.shininess||Ie.defaults.shininess},p=new e.MeshPhongMaterial(u),c=[p,p,p,p,new e.MeshPhongMaterial(u),new e.MeshPhongMaterial(u)];return(a=i.call(this,new e.BoxGeometry(o,s,h,l,1,1),c)).material[5].transparent=!0,a.material[4].transparent=!0,a.baseType="Paper",a.type="Paper",a.castShadow=!0,a.receiveShadow=!0,t.parent3D.add(Se(a)),a}return Te(n,[{key:"loadImage",value:function(e,t,i){Ie.loadImage(this,e,t,"map",i)}},{key:"frontImage",value:function(e,t){Ie.loadImage(this,e,Ie.MATERIAL_FACE.FRONT,"map",t)}},{key:"backImage",value:function(e,t){Ie.loadImage(this,e,Ie.MATERIAL_FACE.BACK,"map",t)}},{key:"loadBump",value:function(e){Ie.loadImage(this,e,Ie.MATERIAL_FACE.FRONT,"bumpMap",null),Ie.loadImage(this,e,Ie.MATERIAL_FACE.BACK,"bumpMap",null)}},{key:"loadNormalMap",value:function(e,t){void 0===t?(Ie.loadImage(this,e,Ie.MATERIAL_FACE.FRONT,"normalMap",null),Ie.loadImage(this,e,Ie.MATERIAL_FACE.BACK,"normalMap",null)):Ie.loadImage(this,e,t,"normalMap",null)}}]),n}(e.Mesh),i=function(e){ke(i,e);var t=Ne(i);function i(e){var n;return xe(this,i),(n=t.call(this,e)).receiveShadow=!0,n.frontImage(Ie.defaults.groundTexture),n.backImage(Ie.defaults.groundTexture),n.type="Ground",n}return i}(t),n=function(t){ke(a,t);var n=Ne(a);function a(t){var o;xe(this,a);var s=Se(o=n.call(this));s.canvas=t.canvas||document.createElement("canvas"),s.canvas=jQuery(o.canvas),s.camera=new e.PerspectiveCamera(20,s.width/s.height,4,5e4),s.renderer=new e.WebGLRenderer({canvas:s.canvas[0],antialias:!0,alpha:!0}),s.renderer.setPixelRatio(t.pixelRatio),s.renderer.setSize(s.width,s.height),s.renderer.setClearColor(16777215,0),s.renderer.shadowMap.enabled=!0,s.renderer.shadowMap.type=1,s.ground=new i({color:16777215,height:s.camera.far/10,width:s.camera.far/10,segments:2,parent3D:s}),s.ambientLight=new e.AmbientLight(4473924),s.add(s.ambientLight);var r=s.spotLight=new e.DirectionalLight(16777215,.25);return r.position.set(0,1,0),!1!==t.castShadow&&(r.castShadow=!0,r.shadow.camera.near=200,r.shadow.camera.far=2e3,r.shadow.camera.top=1350,r.shadow.camera.bottom=-1350,r.shadow.camera.left=-1350,r.shadow.camera.right=1350,r.shadow.radius=2,r.shadow.mapSize.width=1024,r.shadow.mapSize.height=1024,r.shadow.needsUpdate=!0),s.add(r),s.animateCount=0,s.renderCount=0,s.camera.position.set(-300,300,300),s.camera.lookAt(new e.Vector3(0,0,0)),o}return Te(a,[{key:"resizeCanvas",value:function(e,t){this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}},{key:"render",value:function(){this.animateCount++,this.renderer.render(this,this.camera),null!=this.stats&&this.stats.update()}},{key:"clearMaterials",value:function(){for(var e=this.children.length-1;e>=0;e--){var t=this.children[e];if(t.baseType&&"Paper"===t.baseType&&t.material)if(t.material.length)for(var i=0;i<t.material.length;i++)t.material[i].needsUpdate=!0;else t.material.needsUpdate=!0}}},{key:"clearChild",value:function(){this.spotLight.shadow.map=u.disposeObject(this.spotLight.shadow.map),this.spotLight.castShadow=!1,this.clearMaterials();for(var e=this.children.length-1;e>=0;e--){var t=this.children[e];if(t.children&&t.children.length>0)for(var i=t.children.length-1;i>=0;i--)Ie.clearChild(t.children[i]);Ie.clearChild(t),t=null}this.render()}}]),a}(e.Scene);Ie.Paper=t,Ie.Stage=n;var a=function(e){ke(i,e);var t=Ne(i);function i(e){var n;return xe(this,i),(n=t.call(this)).element=e,n.element.style.position="absolute",n.addEventListener("removed",(function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})),n}return i}(e.Object3D);e.CSS3DObject=a;var o=function(e){ke(i,e);var t=Ne(i);function i(e){return xe(this,i),t.call(this,e)}return i}(e.CSS3DObject);e.CSS3DSprite=o,e.MathUtils&&(e.Math=e.MathUtils),e.CSS3DRenderer=function(){var t,i,n,a;u.log("THREE.CSS3DRenderer",e.REVISION);var o=new e.Matrix4,s={camera:{fov:0,style:""},objects:{}},r=document.createElement("div");r.style.overflow="hidden",r.style.WebkitTransformStyle="preserve-3d",r.style.MozTransformStyle="preserve-3d",r.style.oTransformStyle="preserve-3d",r.style.transformStyle="preserve-3d",this.domElement=r;var l=document.createElement("div");l.style.WebkitTransformStyle="preserve-3d",l.style.MozTransformStyle="preserve-3d",l.style.oTransformStyle="preserve-3d",l.style.transformStyle="preserve-3d",r.appendChild(l),this.setClearColor=function(){},this.getSize=function(){return{width:t,height:i}},this.setSize=function(e,o){n=(t=e)/2,a=(i=o)/2,r.style.width=e+"px",r.style.height=o+"px",l.style.width=e+"px",l.style.height=o+"px"};var h=function(e){return Math.abs(e)<Number.EPSILON?0:e},p=function(e){var t=e.elements;return"matrix3d("+h(t[0])+","+h(-t[1])+","+h(t[2])+","+h(t[3])+","+h(t[4])+","+h(-t[5])+","+h(t[6])+","+h(t[7])+","+h(t[8])+","+h(-t[9])+","+h(t[10])+","+h(t[11])+","+h(t[12])+","+h(-t[13])+","+h(t[14])+","+h(t[15])+")"},c=function(e){var t=e.elements;return"translate3d(-50%,-50%,0) matrix3d("+h(t[0])+","+h(t[1])+","+h(t[2])+","+h(t[3])+","+h(-t[4])+","+h(-t[5])+","+h(-t[6])+","+h(-t[7])+","+h(t[8])+","+h(t[9])+","+h(t[10])+","+h(t[11])+","+h(t[12])+","+h(t[13])+","+h(t[14])+","+h(t[15])+")"},d=function(t,i){if(Oe(t,e.CSS3DObject)){var n;Oe(t,e.CSS3DSprite)?(o.copy(i.matrixWorldInverse),o.transpose(),o.copyPosition(t.matrixWorld),o.scale(t.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,n=c(o)):n=c(t.matrixWorld);var a=t.element,r=s.objects[t.id];void 0!==r&&r===n||(a.style.WebkitTransform=n,a.style.MozTransform=n,a.style.oTransform=n,a.style.transform=n,s.objects[t.id]=n),a.parentNode!==l&&l.appendChild(a)}for(var h=0,u=t.children.length;h<u;h++)d(t.children[h],i)};this.render=function(t,o){var h=.5/Math.tan(e.Math.degToRad(.5*o.fov))*i;s.camera.fov!==h&&(r.style.WebkitPerspective=h+"px",r.style.MozPerspective=h+"px",r.style.oPerspective=h+"px",r.style.perspective=h+"px",s.camera.fov=h),t.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),o.matrixWorldInverse.invert?o.matrixWorldInverse.copy(o.matrixWorld).invert():o.matrixWorldInverse.getInverse(o.matrixWorld);var u="translate3d(0,0,"+h+"px)"+p(o.matrixWorldInverse)+" translate3d("+n+"px,"+a+"px, 0)";s.camera.style!==u&&(l.style.WebkitTransform=u,l.style.MozTransform=u,l.style.oTransform=u,l.style.transform=u,s.camera.style=u),d(t,o)}}}};var je=e,We=je.utils,qe=function(e){Be(i,e);var t=Ve(i);function i(e){var n;return Ae(this,i),(n=t.call(this,e)).flexibility=e.flexibility,n.sheetAngle=180,n.curveAngle=0,n.parent3D=e.parent3D,n.segments=e.segments||50,n.width=e.width||100,n.height=e.height||100,n.depth=e.depth||.5,n.matColor="white",n.fallbackMatColor=Ie.WHITE_COLOR,n.init(),n.bumpScale=[0,0,0,0,1,1],n}return Fe(i,[{key:"init",value:function(){var e=this;e.element=new Ie.Paper({parent3D:e.parent3D,segments:e.segments,depth:e.depth,height:e.height,width:e.width,flatShading:0===e.flexibility}),e.element.sheet=e,e.frontPage=new Ze({sheet:e,face:5}),e.backPage=new Ze({sheet:e,face:4}),e.reset(),e.updateAngle()}},{key:"setMatColor",value:function(e,t){if(this.matColor=new THREE.Color(e),void 0===t)for(var i=0;i<6;i++)this.element.material[i].color=this.matColor;else this.element.material[t].color=this.matColor}},{key:"getBumpScale",value:function(e){return this.bumpScale[e]}},{key:"resetMatColor",value:function(e,t){this.element.material[e].color=t?this.matColor:this.fallbackMatColor}},{key:"frontImage",value:function(e,t){this.element.frontImage(e,t)}},{key:"backImage",value:function(e,t){this.element.backImage(e,t)}},{key:"updateAngle",value:function(){var e=this;if(void 0!==this.viewer&&null!==this.viewer){var t=!0===e.isHard?0:e.flexibility,i=("vertical"===this.viewer.orientation?this.height:this.width)*(1-Math.sin(t/2*(t/2))/2-t/20);this.element.scale.y=("vertical"===this.viewer.orientation?this.width:this.height)/this.element.geometry.parameters.height;var n=e.segments,a=i/1,o=a*t,s=a,r=[],l=[],h=[],u=[],p=[],c=[],d=e.depth,f=0,g=[];g.push(f),p[0]=[],c[0]=[];var v=e.sheetAngle*Math.PI/180;"vertical"!==this.viewer.orientation&&(this.element.position.x=-Math.cos(v)*this.viewer.pageOffset),"vertical"===this.viewer.orientation&&(this.element.position.y=Math.cos(v)*this.viewer.pageOffset);var m=!0===e.isHard?v:e.curveAngle*Math.PI/180,y=e.sheetAngle*Math.PI/180,b=y-Math.PI/2,w=Math.sin(b)*d/2;p[0][0]=p[0][1]=new THREE.Vector3(-s*Math.cos(v),0,Math.sin(v)*s-w),c[0][0]=c[0][1]=new THREE.Vector3(p[0][0].x-Math.cos(b)*d,0,p[0][0].z+2*w),p[0][1]=new THREE.Vector3(-s/2*Math.cos(m),0,s/2*Math.sin(m)-w),c[0][1]=new THREE.Vector3(p[0][1].x-Math.cos(b)*d,0,p[0][1].z+2*w),y=(45+e.sheetAngle/2)*Math.PI/180,p[0][2]=new THREE.Vector3(-Math.cos(y)*o/2,0,Math.sin(y)*o-w),c[0][2]=new THREE.Vector3(p[0][2].x+Math.cos(b)*d,0,p[0][2].z+2*w),Math.abs(c[0][2].x-0)<5e-4&&(c[0][2].x=0),p[0][3]=new THREE.Vector3(0,0,-w),c[0][3]=new THREE.Vector3(p[0][3].x-Math.cos(b)*d,0,p[0][3].z+2*w),Math.abs(c[0][3].x-0)<5e-4&&(c[0][3].x=0);for(var P=0;P<1;P++){var S=Math.max(e.segments-1,1);r[P]=new THREE.CubicBezierCurve3(p[P][0],p[P][1],p[P][2],p[P][3]),h[P]=r[P].getPoints(S),S>2&&h[P].push((new THREE.Vector3).copy(h[P][S]));for(var x=void 0,C=h[P][0],T=1;T<h[P].length;T++)f+=(x=h[P][T]).distanceTo(C),g.push(f),C=x;l[P]=new THREE.CubicBezierCurve3(c[P][0],c[P][1],c[P][2],c[P][3]),u[P]=l[P].getPoints(S),S>2&&u[P].push((new THREE.Vector3).copy(u[P][S]))}var E=e.element.geometry;if(void 0!==E.attributes){var k=E.attributes.position,O=E.attributes.uv,R=n+1;k.setZ(0,h[0][n].z),k.setZ(2,h[0][n].z),k.setX(0,h[0][n].x),k.setX(2,h[0][n].x),k.setZ(1,u[0][n].z),k.setZ(3,u[0][n].z),k.setX(1,u[0][n].x),k.setX(3,u[0][n].x),k.setZ(5,h[0][0].z),k.setZ(7,h[0][0].z),k.setX(5,h[0][0].x),k.setX(7,h[0][0].x),k.setZ(4,u[0][0].z),k.setZ(6,u[0][0].z),k.setX(4,u[0][0].x),k.setX(6,u[0][0].x);for(var L=0;L<1;L++)for(var N=0;N<R;N++)k.setZ(8+0*R+N,h[0][N].z),k.setX(8+0*R+N,h[0][N].x),k.setZ(8+1*R+N,u[0][N].z),k.setX(8+1*R+N,u[0][N].x),k.setZ(8+2*R+N,h[0][N].z),k.setX(8+2*R+N,h[0][N].x),k.setZ(8+3*R+N,u[0][N].z),k.setX(8+3*R+N,u[0][N].x),k.setZ(8+4*R+N,h[0][N].z),k.setX(8+4*R+N,h[0][N].x),k.setZ(8+5*R+N,h[0][N].z),k.setX(8+5*R+N,h[0][N].x),O.setX(8+4*R+N,g[N]/f),O.setX(8+5*R+N,g[N]/f),k.setZ(8+6*R+N,u[0][n-N].z),k.setX(8+6*R+N,u[0][n-N].x),k.setZ(8+7*R+N,u[0][n-N].z),k.setX(8+7*R+N,u[0][n-N].x),O.setX(8+6*R+N,1-g[n-N]/f),O.setX(8+7*R+N,1-g[n-N]/f);E.computeBoundingBox(),e.element.scale.x=1*s/f,E.computeBoundingSphere(),k.needsUpdate=!0,O.needsUpdate=!0,E.computeVertexNormals()}else{var I=E.vertices,_=n-1,A=8;I[0].z=I[2].z=h[0][n].z,I[0].x=I[2].x=h[0][n].x,I[1].z=I[3].z=u[0][n].z,I[1].x=I[3].x=u[0][n].x,I[5].z=I[7].z=h[0][0].z,I[5].x=I[7].x=h[0][0].x,I[4].z=I[6].z=u[0][0].z,I[4].x=I[6].x=u[0][0].x;for(var M=0;M<1;M++)for(var F=1;F<n;F++)I[A].z=I[A+3*_].z=u[0][F].z,I[A].x=I[A+3*_].x=u[0][F].x,I[A+_].z=I[A+2*_].z=h[0][F].z,I[A+_].x=I[A+2*_].x=h[0][F].x,A++;for(var D=E.faceVertexUvs[0],z=E.faces,B=0,U=0;U<D.length;U++)if(z[U].materialIndex===Ie.MATERIAL_FACE.BACK){var H=g[B]/f;U%2==0?(D[U][0].x=D[U][1].x=D[U+1][0].x=H,B++):D[U-1][2].x=D[U][1].x=D[U][2].x=H}else if(z[U].materialIndex===Ie.MATERIAL_FACE.FRONT){var V=1-g[B]/f;U%2==0?(D[U][0].x=D[U][1].x=D[U+1][0].x=V,B--):D[U-1][2].x=D[U][1].x=D[U][2].x=V}E.computeBoundingBox(),e.element.scale.x=1*s/f,E.computeBoundingSphere(),E.verticesNeedUpdate=!0,E.computeFaceNormals(),E.computeVertexNormals(),E.uvsNeedUpdate=!0,E.normalsNeedUpdate=!0}r.forEach((function(e){null})),l.forEach((function(e){null})),u.forEach((function(e){null})),h.forEach((function(e){null}))}}},{key:"flip",value:function(e,t){var i=this,n=i.viewer.isBooklet;!0===i.isCover&&(0===e&&(e=2.5*i.viewer.flexibility),180===e&&(e-=2.5*i.viewer.flexibility));var a=t-e,o=e>90,s=i.viewer.isRTL,r=o?i.backPage.pageNumber:i.frontPage.pageNumber,l=this.viewer.getViewPort(r);l&&(l=We.contain(l.width,l.height,i.viewer.availablePageWidth(),i.viewer.availablePageHeight()));var h=-(i.viewer.has3DCover&&i.viewer.isClosedPage()?i.viewer.coverExtraWidth:0),u=-(i.viewer.has3DCover&&i.viewer.isClosedPage()?i.viewer.coverExtraHeight:0);i.init={angle:e,height:o?i.viewer.rightSheetHeight:i.viewer.leftSheetHeight,width:o?i.viewer.rightSheetWidth:i.viewer.leftSheetWidth,index:o&&!s||!o&&s?1:0,_index:0},i.first={angle:e+a/4,index:o&&!s||!o&&s?1:.25},i.mid={angle:e+2*a/4,index:.5},i.mid2={angle:e+3*a/4,index:o&&!s||!o&&s?.25:1},i.end={angle:t,index:o&&!s||!o&&s?0:1,height:u+(l?l.height:i.height),width:h+(l?l.width:i.width)},i.isFlipping=!0;n&&(!o&&!s||o&&s)&&(i.element.material[5].opacity=i.element.material[4].opacity=0,i.element.castShadow=!1),i.currentTween=new TWEEN.Tween(i.init).to({angle:[i.first.angle,i.mid.angle,i.mid2.angle,i.end.angle],index:[i.first.index,i.mid.index,i.mid2.index,i.end.index],_index:1,height:i.end.height,width:i.end.width},i.viewer.app.options.duration*Math.abs(a)/180).onUpdate((function(e){!function(e){i.sheetAngle=e.angle,i.curveAngle=i.isHard?e.angle:We.getCurveAngle(o,e.angle),!0===i.isHard?(i.flexibility=0,i.isCover&&i.viewer.flipCover(i)):i.flexibility=e.angle<90?i.leftFlexibility:i.rightFlexibility,i.element.position.z=(e.angle<90?i.leftPos:i.rightPos)+i.depth,n&&(i.element.material[5].opacity=i.element.material[4].opacity=e.index,i.element.castShadow=e.index>.5),i.height=e.height,i.width=e.width,i.updateAngle(!0)}(this)})).easing(TWEEN.Easing.Sinusoidal.Out).onStop((function(){i.currentTween=null,i.isFlipping=!1,i.isCover&&(i.viewer.leftCover.isFlipping=!1,i.viewer.rightCover.isFlipping=!1),i.element.material[5].opacity=i.element.material[4].opacity=1})).onComplete((function(){i.updateAngle(),i.element.material[5].opacity=i.element.material[4].opacity=1,i.element.castShadow=!0,i.isFlipping=!1,i.isCover&&(i.viewer.leftCover.isFlipping=!1,i.viewer.rightCover.isFlipping=!1),i.side=i.targetSide,i.viewer.onFlip(),i.viewer.afterFlip(),i.currentTween=null,i.viewer&&i.viewer.requestRefresh&&i.viewer.requestRefresh()})).start(),i.currentTween.update(window.performance.now())}}]),i}(Q),Ge=function(t){Be(n,t);var i=Ve(n);function n(e,t){var a,o,s,r,l;return Ae(this,n),e.viewerClass="df-flipbook-3d",(a=i.call(this,e,t)).pageOffset=5,a.spiralCount=20,a.groundDistance=null!==(o=e.groundDistance)&&void 0!==o?o:2,a.hasSpiral="true"===e.hasSpiral||!0===e.hasSpiral,a.flexibility=We.limitAt(null!==(s=e.flexibility)&&void 0!==s?s:.9,0,10),a.hasSpiral&&(a.flexibility=0),0===a.flexibility&&(e.sheetSegments=8),a.drag3D=We.isTrue(e.drag3D),a.texturePowerOfTwo=!We.isMobile&&(null===(r=e.texturePowerOfTwo)||void 0===r||r),a.color3DSheets=null!==(l=a.app.options.color3DSheets)&&void 0!==l?l:"white",a.midPosition=0,a.initMOCKUP((function(){t._viewerPrepared()})),a}return Fe(n,[{key:"initMOCKUP",value:function(e){var t=this.app;"undefined"==typeof THREE?(t.updateInfo(t.options.text.loading+" WEBGL 3D ..."),"function"==typeof window.define&&window.define.amd&&window.requirejs?(window.requirejs.config({paths:{three:t.options.threejsSrc.replace(".js","")},shim:{three:{exports:"THREE"}}}),window.require(["three"],(function(t){return window.THREE=t,Ie.init(),"function"==typeof e&&e(),t}))):"function"==typeof window.define&&window.define.amd?window.require(["three",t.options.threejsSrc.replace(".js","")],(function(t){t((function(){Ie.init(),"function"==typeof e&&e()}))})):We.getScript(t.options.threejsSrc+"?ver="+je.version,(function(){Ie.init(),"function"==typeof e&&e()}),(function(){t.updateInfo("Unable to load THREE.js...")}))):(Ie.init(),"function"==typeof e&&e())}},{key:"init",value:function(){var e=this.app;De(ze(n.prototype),"init",this).call(this);e.provider.defaultPage.pageRatio;this.pageScaleX=1,this.initDepth(),this.initStage(),this.initPages(),this.initEvents(),this.render()}},{key:"updatePageMode",value:function(){De(ze(n.prototype),"updatePageMode",this).call(this);var t=this.app;this.has3DCover=t.options.cover3DType!==e.FLIPBOOK_COVER_TYPE.NONE&&t.pageCount>7&&!this.isBooklet,this.has3DCover&&"none"===t.options.flipbookHardPages&&(t.options.flipbookHardPages="cover")}},{key:"initDepth",value:function(){var e,t;this.sheetDepth=this.pageScaleX*(null!==(e=this.app.options.sheetDepth)&&void 0!==e?e:.5),this.sheetSegments=null!==(t=this.app.options.sheetSegments)&&void 0!==t?t:20,this.coverDepth=2*this.sheetDepth,this.sheetsDepth=Math.min(10,this.app.pageCount/4)*this.sheetDepth}},{key:"initStage",value:function(){var e=this,t=e.stage=new Ie.Stage({pixelRatio:e.app.options.pixelRatio});(t.canvas=jQuery(t.renderer.domElement).addClass("df-3dcanvas")).appendTo(this.element),t.camera.position.set(0,0,600),t.camera.lookAt(new THREE.Vector3(0,0,0)),e.camera=t.camera,t.spotLight.position.set(-220,220,550),t.spotLight.castShadow=!We.isMobile&&e.app.options.has3DShadow,t.spotLight.shadow&&(t.spotLight.shadow.bias=-.005),t.ambientLight.color=new THREE.Color("#fff"),t.ambientLight.intensity=.82;var i=new THREE.ShadowMaterial;i.opacity=e.app.options.shadowOpacity,t.ground.oldMaterial=t.ground.material,t.ground.material=i,t.ground.position.z=this.has3DCover?-6:-4,t.selectiveRendering=!0;var n=t.cssRenderer=new THREE.CSS3DRenderer;jQuery(n.domElement).css({position:"absolute",top:0,pointerEvents:"none"}).addClass("df-3dcanvas df-csscanvas"),e.element[0].appendChild(n.domElement),t.cssScene=new THREE.Scene,e.wrapper.remove(),e.wrapper=new THREE.Group,e.stage.add(e.wrapper),e.wrapper.add(t.ground),e.bookWrapper=new THREE.Group,e.bookWrapper.name="bookwrapper",e.wrapper.add(e.bookWrapper),e.bookHelper=t.bookHelper=new THREE.BoxHelper(e.bookWrapper,16776960),t.add(e.bookHelper),e.bookHelper.visible=!1,e.cameraWrapper=new THREE.Group,e.cameraWrapper.add(t.camera),t.add(e.cameraWrapper),e.app.renderRequestStatus=je.REQUEST_STATUS.ON}},{key:"initPages",value:function(){for(var e={parent3D:this.bookWrapper,viewer:this,segments:this.sheetSegments,depth:this.sheetDepth,flexibility:this.flexibility},t=0;t<this.stackCount;t++){var i=new qe(e);i.index=t,i.viewer=this,this.sheets.push(i),i.setMatColor(this.color3DSheets),this.pages.push(i.frontPage),this.pages.push(i.backPage),this.stage.cssScene.add(i.frontPage.cssPage),this.stage.cssScene.add(i.backPage.cssPage)}e.depth=this.sheetsDepth,e.segments=1,e.flexibility=0,this.leftSheets=new qe(e),this.rightSheets=new qe(e),this.leftSheets.setMatColor(this.color3DSheets),this.rightSheets.setMatColor(this.color3DSheets),e.depth=this.coverDepth,this.leftCover=new qe(e),this.rightCover=new qe(e),this.leftCover.isHard=!0,this.rightCover.isHard=!0,this.set3DCoverNormal(),this.setcolor3DCover(this.app.options.color3DCover),this.stage.cssScene.add(this.leftCover.frontPage.cssPage),this.stage.cssScene.add(this.rightCover.backPage.cssPage),this.zoomViewer.leftPage.element.css({backgroundColor:this.color3DSheets}),this.zoomViewer.rightPage.element.css({backgroundColor:this.color3DSheets}),"vertical"===this.orientation&&this.bookWrapper.children.forEach((function(e){e.rotateZ(THREE.MathUtils.degToRad(-90)),e.textureCenter=new THREE.Vector2(.5,.5),e.textureRotation=90})),this.initSpiral()}},{key:"initSpiral",value:function(){this.hasSpiral=!1}},{key:"set3DCoverNormal",value:function(){}},{key:"setcolor3DCover",value:function(){}},{key:"initEvents",value:function(){this.stageDOM=this.element[0],De(ze(n.prototype),"initEvents",this).call(this)}},{key:"dispose",value:function(){De(ze(n.prototype),"dispose",this).call(this);var e=this;e.stage&&(e.stage.clearChild(),e.stage.cssRenderer.domElement.parentNode.removeChild(e.stage.cssRenderer.domElement),e.stage.cssRenderer=null,e.stage.orbitControl=We.disposeObject(e.stage.orbitControl),e.stage.renderer=We.disposeObject(e.stage.renderer),jQuery(e.stage.canvas).remove(),e.stage.canvas=null,e.stage=We.disposeObject(e.stage)),e.centerTween&&e.centerTween.stop&&e.centerTween.stop()}},{key:"render",value:function(){this.stage.render(),this.stage.cssRenderer.render(this.stage.cssScene,this.stage.camera)}},{key:"resize",value:function(){De(ze(n.prototype),"resize",this).call(this);var e=this,t=e.app,i=e.stage,a=t.dimensions,o=(a.padding,e.isSingle,this.availablePageWidth()),s=this.availablePageHeight();i.resizeCanvas(a.stage.width,a.stage.height),i.cssRenderer.setSize(a.stage.width,a.stage.height),this.pageScaleX=Math.max(Math.max(o,s)/400,1),this.initDepth(),this.sheets.forEach((function(t){t.depth=e.sheetDepth})),t.refreshRequestStart();var r=this.refSize=Math.min(s,o);this.coverExtraWidth=("vertical"==e.orientation?2:1)*r*.025,this.coverExtraHeight=("vertical"==e.orientation?1:2)*r*.025,!0!==this.has3DCover&&(this.coverExtraWidth=0,this.coverExtraHeight=0),e.zoomViewer.resize(),e.cameraPositionDirty=!0,e.centerNeedsUpdate=!0,e.checkCenter(!0),e.pagesReady(),this.pageOffset=(this.hasSpiral?6:0)*Math.min(this._defaultPageSize.width,this._defaultPageSize.height)/1e3}},{key:"fitCameraToCenteredObject",value:function(e,t,i,n){var a=new THREE.Box3;a.setFromObject(t);new THREE.Vector3;var o=new THREE.Vector3;a.getSize(o);var s=this.coverExtraHeight,r=2*this.coverExtraWidth;this.isClosedPage()&&(r=0,s=0),o.x=o.x-r+this.app.dimensions.padding.width,o.y=o.y-s+this.app.dimensions.padding.height;var l=e.fov*(Math.PI/180),h=2*Math.atan(Math.tan(l/2)*e.aspect),u=o.z/2+Math.abs(o.x/2/Math.tan(h/2)),p=o.z/2+Math.abs(o.y/2/Math.tan(l/2)),c=Math.max(u,p);void 0!==i&&0!==i&&(c*=i),e.position.set(0,0,c);var d=a.min.z,f=d<0?-d+c:c-d;e.far=3*f,e.updateProjectionMatrix(),void 0!==n&&(n.target=new THREE.Vector3(0,0,0),n.maxDistance=2*f)}},{key:"updateShadowSize",value:function(){return;var e=this.pageScaleX>2.5?1024:512,t=this.stage.spotLight.shadow;!0===this.stage.spotLight.castShadow&&t.mapSize.height!=e&&(t.radius=e/256,t.mapSize.width=e,t.mapSize.height=e,t.needsUpdate=!0)}},{key:"refresh",value:function(){var e=this,t=this.app,i=e.getBasePage();this.refreshRequested=!0;var a=1/t.pageCount*i,o=this.isRTL?1-a:a,s=1-o,r=Math.min(e.stackCount,e.totalSheets),l=We.limitAt(e.totalSheets,e.stackCount,2*e.stackCount),h=(Math.max(o,s),this.isBooklet?0:this.flexibility/l);e.leftFlexibility=h*s,e.rightFlexibility=h*o,e.midPosition=.5*r*e.sheetDepth,De(ze(n.prototype),"refresh",this).call(this);var u=!0===this.has3DCover;this.leftCover.element.visible=this.rightCover.element.visible=this.leftSheets.element.visible=this.rightSheets.element.visible=u,this.wrapper.position.z=-this.midPosition;var p=0,c=0,d=e.isRTL,f=this.isFirstPage(),g=this.isLastPage(),v=this.isLeftClosed=this.isClosedPage()&&(d&&g||!d&&f),m=this.isRightClosed=this.isClosedPage()&&(!d&&g||d&&f);if(u){e.leftSheets.depth=d?e.sheetsDepth*(1-e.getBasePage()/t.pageCount):e.sheetsDepth*i/t.pageCount,e.leftSheets.element.visible=d?t.pageCount-e.getBasePage()>2:i>2,p-=e.leftSheets.depth/2,e.leftSheets.element.position.z=p,p-=e.coverDepth+(e.leftSheets.element.visible?e.leftSheets.depth/2:0)+3*e.coverDepth,e.leftCover.depth=e.rightCover.depth=e.coverDepth;var y=Math.max(this.leftSheetHeight,this.rightSheetHeight);m&&(y=this.leftSheetHeight),v&&(y=this.rightSheetHeight),!0!==e.leftCover.isFlipping&&(e.leftCover.element.position.z=v?e.midPosition+e.coverDepth:p+e.coverDepth/2,e.leftCover.element.position.z=Math.max(e.leftCover.element.position.z,.05*-e.refSize),e.leftCover.element.position.x=0,e.leftSheets.sheetAngle=e.leftCover.sheetAngle=v?180:0,e.leftSheets.curveAngle=e.leftCover.curveAngle=v?180:0,!0!==e.rightCover.isFlipping&&(e.leftCover.height=y,e.leftCover.width=e.leftCover.sheetAngle<90?this.leftSheetWidth:this.rightSheetWidth,this.isClosedPage()||(e.leftCover.width+=this.coverExtraWidth,e.leftCover.height+=this.coverExtraHeight)),e.leftSheets.updateAngle(),e.leftCover.updateAngle()),e.rightSheets.depth=e.sheetsDepth-e.leftSheets.depth,e.rightSheets.element.visible=d?i>2:t.pageCount-e.getBasePage()>2,c-=e.rightSheets.depth/2,e.rightSheets.element.position.z=c,c-=e.coverDepth+(e.rightSheets.element.visible?e.rightSheets.depth/2:0)+3*e.coverDepth,!0!==e.rightCover.isFlipping&&(e.rightCover.element.position.z=m?e.midPosition+e.coverDepth:c+e.coverDepth/2,e.rightCover.element.position.z=Math.max(e.rightCover.element.position.z,.05*-e.refSize),e.rightCover.element.position.x=0,e.rightSheets.sheetAngle=e.rightCover.sheetAngle=m?0:180,e.rightSheets.curveAngle=e.rightCover.curveAngle=m?0:180,!0!==e.leftCover.isFlipping&&(e.rightCover.height=y,e.rightCover.width=e.rightCover.sheetAngle<90?this.leftSheetWidth:this.rightSheetWidth,this.isClosedPage()||(e.rightCover.width+=this.coverExtraWidth,e.rightCover.height+=this.coverExtraHeight)),e.rightSheets.updateAngle(),e.rightCover.updateAngle()),e.updateSheets(),e.stage.ground.position.z=Math.min(p,c)-e.refSize*e.groundDistance/100,e.stage.ground.position.z=Math.max(e.stage.ground.position.z,.1*-e.refSize)}else e.stage.ground.position.z=-e.midPosition-15*e.sheetDepth;!0===e.cameraPositionDirty&&e.updateCameraPosition(),this.refreshSpiral()}},{key:"refreshSpiral",value:function(){}},{key:"updateCameraPosition",value:function(){var e=this,t=e.app,i=e.stage,n=t.dimensions,a=n.padding,o=1/(2*Math.tan(Math.PI*i.camera.fov*.5/180)/(n.stage.height/t.zoomValue))+2.2;this.updateShadowSize(),this.stage.spotLight.position.x=330*-this.pageScaleX,this.stage.spotLight.position.y=330*this.pageScaleX,this.stage.spotLight.position.z=550*this.pageScaleX,this.stage.spotLight.shadow.camera.far=1200*this.pageScaleX,this.stage.spotLight.shadow.camera.updateProjectionMatrix();var s=(a.top-a.bottom)/t.zoomValue/2,r=-(a.left-a.right)/t.zoomValue/2;i.camera.position.z!==o&&!0===t.pendingZoom&&(i.camera.position.z=o),1===t.zoomValue&&(e.bookWrapper.rotation.set(0,0,0),e.bookHelper.rotation.set(0,0,0),e.cameraWrapper.rotation.set(0,0,0),0!==t.options.flipbook3DTiltAngleUp||0!==t.options.flipbook3DTiltAngleLeft?(i.camera.aspect=n.stage.width/n.stage.height,i.camera.updateProjectionMatrix(),e.bookWrapper.rotateZ(THREE.Math.degToRad(-t.options.flipbook3DTiltAngleLeft)),e.bookWrapper.rotateX(THREE.Math.degToRad(-t.options.flipbook3DTiltAngleUp)),"vertical"==e.orientation?e.bookWrapper.scale.y=1/(this.isSingle?2:1):e.bookWrapper.scale.x=1/(this.isSingle?2:1),e.bookHelper.update(),e.fitCameraToCenteredObject(i.camera,e.bookWrapper),e.bookWrapper.rotation.set(0,0,0),e.bookWrapper.scale.x=1,e.bookWrapper.scale.y=1,i.camera.position.set(r,s,i.camera.position.z+i.ground.position.z),this.camera.aspect=n.stage.width/n.stage.height,this.camera.updateProjectionMatrix(),e.cameraWrapper.rotateX(THREE.Math.degToRad(t.options.flipbook3DTiltAngleUp)),e.cameraWrapper.rotateZ(THREE.Math.degToRad(t.options.flipbook3DTiltAngleLeft))):i.camera.position.set(r,s,o)),i.camera.updateProjectionMatrix(),e.app.renderRequestStatus=je.REQUEST_STATUS.ON,e.cameraPositionDirty=!1}},{key:"refreshSheet",value:function(t){var i,n=this,a=t.sheet,o=t.index,s=a.sheetAngle,r=!(a.isHard||0===this.flexibility);a.leftFlexibility=r?n.leftFlexibility:0,a.rightFlexibility=r?n.rightFlexibility:0,a.leftPos=n.midPosition+(o-t.midPoint+1)*n.sheetDepth-n.sheetDepth/2,a.rightPos=n.midPosition-(o-t.midPoint)*n.sheetDepth-n.sheetDepth/2,i=a.targetSide===e.TURN_DIRECTION.LEFT?0:180,!1===a.isFlipping&&(t.needsFlip?(a.isFlipping=!0,a.isCover&&0===t.sheetNumber&&(n.isRTL?n.rightCover.isFlipping=!0:n.leftCover.isFlipping=!0),a.isCover&&n.totalSheets-t.sheetNumber==1&&(n.isRTL?n.leftCover.isFlipping=!0:n.rightCover.isFlipping=!0),a.element.position.z=Math.max(s<90?a.leftPos:a.rightPos,n.midPosition)+n.sheetDepth,a.flexibility=s<90?a.leftFlexibility:a.rightFlexibility,a.flip(s,i)):(a.skipFlip=!1,a.sheetAngle=a.curveAngle=i,a.flexibility=i<90?a.leftFlexibility:a.rightFlexibility,a.element.position.z=i<90?a.leftPos:a.rightPos,a.side=a.targetSide,a.height=i<90?this.leftSheetHeight:this.rightSheetHeight,a.width=i<90?this.leftSheetWidth:this.rightSheetWidth),a.updateAngle(),this.app.renderRequestStatus=je.REQUEST_STATUS.ON),a.element.visible=t.visible}},{key:"updateCenter",value:function(){var e=this,t=this.app,i="vertical"==this.orientation?e.wrapper.position.y:e.wrapper.position.x,n=("vertical"===this.orientation?-1:1)*e.centerShift*(this.isLeftPage()?"vertical"==this.orientation?this.leftSheetHeight:this.leftSheetWidth:"vertical"==this.orientation?this.rightSheetHeight:this.rightSheetWidth)/2;e.seamPosition=(-t.dimensions.offset.width+t.dimensions.containerWidth)/2+n,n!==e.centerEnd&&(e.centerTween&&e.centerTween.stop&&e.centerTween.stop(),e.onCenterStartAnimation(this),e.centerTween=new TWEEN.Tween({x:i}).delay(0).to({x:n},1===t.zoomValue&&!0!==e.skipCenterAnimation?e.app.options.duration:1).onStart((function(){})).onUpdate((function(){e.onCenterUpdateAnimation(this)})).onComplete((function(){e.onCenterCompleteAnimation(this)})).onStop((function(){e.onCenterStopAnimation(this)})).easing(TWEEN.Easing.Cubic.InOut).start(),this.updatePendingStatusClass(),e.skipCenterAnimation=!1,e.centerEnd=n),e.renderRequestStatus=je.REQUEST_STATUS.ON,this.zoomViewer.updateCenter()}},{key:"onCenterUpdateAnimation",value:function(e){"vertical"==this.orientation?(this.wrapper.position.y=e.x,this.stage&&this.stage.cssScene&&(this.stage.cssScene.position.y=e.x)):(this.wrapper.position.x=e.x,this.stage&&this.stage.cssScene&&(this.stage.cssScene.position.x=e.x))}},{key:"onCenterStartAnimation",value:function(e){}},{key:"onCenterStopAnimation",value:function(e){}},{key:"onCenterCompleteAnimation",value:function(e){}},{key:"flipCover",value:function(e){var t,i,n=null;0===e.pageNumber||this.isBooklet&&1===e.pageNumber?(n=this.isRTL?this.rightCover:this.leftCover,t=this.isRTL?1:-1):e.pageNumber===this.totalSheets-1&&(n=this.isRTL?this.leftCover:this.rightCover,t=this.isRTL?-1:1),null!==n&&(i=n.depth+e.depth+1,n.sheetAngle=e.sheetAngle,n.curveAngle=e.curveAngle,this.rightCover.height=this.leftCover.height=e.height+this.coverExtraHeight,this.rightCover.width=this.leftCover.width=e.width+this.coverExtraWidth,n.flexibility=e.flexibility,this.rightCover.updateAngle(),this.leftCover.updateAngle(),n.element.position.x=e.element.position.x+t*Math.sin(e.sheetAngle*Math.PI/180)*i,n.element.position.z=e.element.position.z+t*Math.cos(e.sheetAngle*Math.PI/180)*i)}},{key:"pagesReady",value:function(){if(!this.isAnimating()&&!0===this.refreshRequested){if(!1===this.app.options.flipbookFitPages){var e=this.app.viewer.getBasePage(),t=this.leftViewport=this.getViewPort(e+(this.isBooklet?0:this.isRTL?1:0)),i=this.rightViewPort=this.getViewPort(e+(this.isBooklet||this.isRTL?0:1));if(t){var n=We.contain(t.width,t.height,this.availablePageWidth(),this.availablePageHeight());this.leftSheetWidth==Math.floor(n.width)&&this.leftSheetHeight==Math.floor(n.height)||(this.cameraPositionDirty=!0),this.leftSheetWidth=Math.floor(n.width),this.leftSheetHeight=Math.floor(n.height)}if(i){var a=We.contain(i.width,i.height,this.availablePageWidth(),this.availablePageHeight());this.rightSheetWidth==Math.floor(a.width)&&this.rightSheetWidth==Math.floor(a.height)||(this.cameraPositionDirty=!0),this.rightSheetWidth=Math.floor(a.width),this.rightSheetHeight=Math.floor(a.height)}for(var o=0;o<this.sheets.length;o++){var s=this.sheets[o];s.side===je.TURN_DIRECTION.LEFT?(s.height=this.leftSheetHeight,s.width=this.leftSheetWidth,s.updateAngle()):(s.height=this.rightSheetHeight,s.width=this.rightSheetWidth,s.updateAngle())}if(this.isClosedPage()){var r=this.isRTL&&this.isLastPage()||!this.isRTL&&this.isFirstPage();this.leftCover.width=this.rightCover.width=r?this.rightSheetWidth:this.leftSheetWidth,this.leftCover.height=this.rightCover.height=r?this.rightSheetHeight:this.leftSheetHeight}else this.leftCover.height=this.rightCover.height=this.coverExtraHeight+Math.max(this.leftSheetHeight,this.rightSheetHeight),this.leftCover.width=this.coverExtraWidth+this.leftSheetWidth,this.rightCover.width=this.coverExtraWidth+this.rightSheetWidth;this.leftSheets.width=this.leftSheetWidth,this.leftSheets.height=this.leftSheetHeight,this.rightSheets.height=this.rightSheetHeight,this.rightSheets.width=this.rightSheetWidth,this.leftCover.updateAngle(),this.leftSheets.updateAngle(),this.rightCover.updateAngle(),this.rightSheets.updateAngle(),this.updateSheets(!0)}this.updateCenter(),this.updateCSSLayer(),this.updatePendingStatusClass(),this.refreshSpiral(),!0===this.cameraPositionDirty&&this.updateCameraPosition()}}},{key:"updateSheets",value:function(e){if(!0!==this.isClosedPage()){var t=this.getPageByNumber(this.getRightPageNumber());if(!0!==this.rightCover.isFlipping&&t&&t.sheet.element.geometry.attributes){var i=this.rightSheets.element.geometry.attributes.position,n=e?t.sheet.element.geometry.boundingBox.max.x*t.sheet.element.scale.x:this.rightSheets.lastSlopeX;i.setX(21,n),i.setX(23,n),i.setX(4,n),i.setX(6,n),i.setX(10,n),i.setX(14,n),i.needsUpdate=!0,this.rightSheets.element.geometry.attributes.uv.needsUpdate=!0,this.rightSheets.element.geometry.computeVertexNormals(),e&&(this.rightSheets.lastSlopeX=n)}var a=this.getPageByNumber(this.getLeftPageNumber());if(!0!==this.leftCover.isFlipping&&a&&a.sheet.element.geometry.attributes){var o=this.leftSheets.element.geometry.attributes.position,s=e?a.sheet.element.geometry.boundingBox.min.x*a.sheet.element.scale.x:this.leftSheets.lastSlopeX;o.setX(16,s),o.setX(18,s),o.setX(5,s),o.setX(7,s),o.setX(8,s),o.setX(12,s),o.needsUpdate=!0,this.leftSheets.element.geometry.attributes.uv.needsUpdate=!0,this.leftSheets.element.geometry.computeVertexNormals(),e&&(this.leftSheets.lastSlopeX=s)}}}},{key:"updateCSSLayer",value:function(){}},{key:"mouseMove",value:function(e){if(e=We.fixMouseEvent(e),this.app.renderRequestStatus=je.REQUEST_STATUS.ON,null==e.touches||2!==e.touches.length){var t=this,i=t.eventToPoint(e);if(null!==t.dragSheet&&!1!==t.drag3D&&Math.abs(i.x-t.startPoint.x)>2){!0!==t.isDragging&&(t.updatePendingStatusClass(!0),t.isDragging=!0);var n=t.dragSheet.width,a=i.x-(this.app.dimensions.origin.x+t.centerEnd-n),o=We.limitAt(1-a/n,-1,1),s=We.toDeg(Math.acos(o)),r=t.dragSheet,l=t.drag===je.TURN_DIRECTION.LEFT;r.sheetAngle=s;var h=We.getCurveAngle(l,s,45);r.isCover&&r.viewer.flipCover(r),r.curveAngle=r.isHard?s:h,r.updateAngle()}t.checkSwipe(i,e)}else this.pinchMove(e)}},{key:"mouseUp",value:function(e){var t=this;if((e=We.fixMouseEvent(e)).touches||0===e.button)if(null!=t.dragSheet||null==e.touches||0!==e.touches.length){var i=t.eventToPoint(e);if(1===t.app.zoomValue){if(null!==t.dragSheet){var n=i.x-t.startPoint.x;Math.abs(n)>2*t.swipeThreshold&&(t.drag===je.TURN_DIRECTION.LEFT&&n>0?t.app.openLeft():t.drag===je.TURN_DIRECTION.RIGHT&&n<0&&t.app.openRight()),t.requestRefresh(),t.updatePendingStatusClass()}var a=e.target||e.originalTarget,o=t.startPoint&&i.x===t.startPoint.x&&i.y===t.startPoint.y&&"A"!==a.nodeName;if(!0===e.ctrlKey&&o||!0===e.altKey&&o){const t=e.shiftKey;this.zoomOnPoint(i,t)}else o&&i.sheet&&t.clickAction===je.MOUSE_CLICK_ACTIONS.NAV&&(i.sheet.sheetAngle>90?t.app.openRight():t.app.openLeft())}t.dragSheet=null,t.drag=null,!0===t.isDragging&&(t.isDragging=!1),t.startPoint=null,t.canSwipe=!1,t.app.renderRequestStatus=je.REQUEST_STATUS.ON}else this.pinchUp(e)}},{key:"raycastCLick",value:function(e){var t=this;t.mouse=new THREE.Vector2,t.raycaster=new THREE.Raycaster,t.mouse.x=e.offsetX/t.app.dimensions.stage.width*2-1,t.mouse.y=1-e.offsetY/t.app.dimensions.stage.height*2,t.raycaster.setFromCamera(t.mouse,t.camera);var i=t.raycaster.intersectObjects(t.bookWrapper.children,!0);if(i.length>0){var n,a=0;do{if((n=null!=i[a]?i[a].object:null).sheet&&n.sheet.index&&!0!==n.sheet.isFlipping)return n;a++}while(a<i.length)}}},{key:"mouseDown",value:function(e){if((e=We.fixMouseEvent(e)).touches||0===e.button)if(null!=e.touches&&2===e.touches.length)this.pinchDown(e);else{e=We.fixMouseEvent(e);var t=this,i=t.eventToPoint(e);t.startPoint=i,t.lastPosX=i.x,t.lastPosY=i.y;var n=t.raycastCLick(e),a=i.sheet?i.sheet.width-Math.abs(i.x-(this.app.dimensions.origin.x+t.centerEnd)):0;i.sheet&&n&&i.isInsideSheet&&a<i.sheet.width/2?(t.dragSheet=n.sheet,t.drag=i.sheet.sheetAngle<90?je.TURN_DIRECTION.LEFT:je.TURN_DIRECTION.RIGHT):t.canSwipe=!0}}},{key:"eventToPoint",value:function(e){var t=this,i=this.app.dimensions,n={x:(e=We.fixMouseEvent(e)).clientX,y:e.clientY};n.x=n.x-t.parentElement[0].getBoundingClientRect().left,n.y=n.y-t.parentElement[0].getBoundingClientRect().top;var a=(-i.offset.width+i.containerWidth)/2-i.stage.width/2,o=(-i.offset.width+i.containerWidth)/2+i.stage.width/2,s=i.padding.top,r=i.padding.top+t.availablePageHeight(),l=n.x<t.seamPosition,h=t.getBasePage()+(l?0:1),u=this.getPageByNumber(h);u&&(u=u.sheet);var p=n.x>a&&n.x<o&&n.y>s&&n.y<r;return{isInsideSheet:p,isInsideDragZone:p&&n.x-a<t.foldSense||o-n.x<t.foldSense,x:n.x,y:n.y,left:a,top:s,right:o,bottom:r,raw:n,isLeftSheet:l,sheet:u}}},{key:"checkPageLoading",value:function(){for(var e=!0,t=this.getVisiblePages().main,i=0;i<(this.isBooklet?1:2);i++){var n=this.getPageByNumber(t[i]);n&&(e=n.textureLoaded&&e)}this.element.toggleClass("df-loading",!e)}},{key:"textureLoadedCallback",value:function(e){this.app.renderRequestStart(),this.pagesReady()}},{key:"getTextureSize",value:function(e){var t=De(ze(n.prototype),"getTextureSize",this).call(this,e);if(1!==this.app.zoomValue||!0===e.isAnnotation)return t;var i=We.nearestPowerOfTwo(t.height),a=t.width*i/t.height;return this.texturePowerOfTwo?{height:i,width:a}:t}},{key:"getPageByNumber",value:function(e){if(this.has3DCover){var t=!this.isBooklet&&e===this.app.pageCount&&e%2==0,i=1===e;if(!this.isRTL&&i||this.isRTL&&t)return this.leftCover.frontPage;if(!this.isRTL&&t||this.isRTL&&i)return this.rightCover.backPage}return De(ze(n.prototype),"getPageByNumber",this).call(this,e)}},{key:"setPage",value:function(e){return De(ze(n.prototype),"setPage",this).call(this,e)}},{key:"beforeFlip",value:function(){De(ze(n.prototype),"beforeFlip",this).call(this)}}]),n}(K),Ze=function(e){Be(i,e);var t=Ve(i);function i(e){var n;Ae(this,i);var a=_e(n=t.call(this,e));return a.element=null,a.face=e.face,a.parent3D=e.sheet,a.sheet=e.sheet,a.cssPage=new THREE.CSS3DObject(a.contentLayer[0]),n}return Fe(i,[{key:"setLoading",value:function(){this.sheet.viewer.checkPageLoading()}},{key:"clearMap",value:function(){this.sheet.element.material[this.face].map=null,this.sheet.element.material[this.face].needsUpdate=!0}},{key:"loadTexture",value:function(e){var t=this,i=e.texture,n=e.callback;function a(i,a){t.updateTextureLoadStatus(!0),t.sheet.resetMatColor(t.face,e.texture===t.textureLoadFallback),"function"==typeof n&&n(e)}t.textureSrc=i,"function"==typeof je.defaults.beforeLoadTexture&&je.defaults.beforeLoadTexture({texture:i,page:t}),4===this.face?this.sheet.backImage(i,a):this.sheet.frontImage(i,a)}}]),i}(O);e.defaults.maxTextureSize=2048;function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ye(e,t,i){return t&&Qe(e.prototype,t),i&&Qe(e,i),e}function Je(e){return Je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(e)}function $e(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function et(e,t){return!t||"object"!==it(t)&&"function"!=typeof t?Ke(e):t}function tt(e,t){return tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},tt(e,t)}function it(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Je(e);if(t){var a=Je(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return et(this,i)}}e.viewers={},e.viewers.flipbook=function t(i,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),0==e.utils.canSupport3D()&&(i.is3D=!1),e.utils.isTrue(i.is3D)?new Ge(i,n):new he(i,n)},e.viewers.default=e.viewers.reader=D,e.viewers.slider=Pe;var at=e.utils,ot=function(){function t(){Xe(this,t),this.baseUrl=null,this.pdfDocument=null,this.pdfApp=null,this.pdfHistory=null,this.externalLinkRel=null,this.externalLinkEnabled=!0,this._pagesRefCache=null}return Ye(t,[{key:"dispose",value:function(){this.baseUrl=null,this.pdfDocument=null,this.pdfApp=null,this.pdfHistory=null,this._pagesRefCache=null}},{key:"setDocument",value:function(e,t){this.baseUrl=t,this.pdfDocument=e,this._pagesRefCache=Object.create(null)}},{key:"setViewer",value:function(e){this.pdfApp=e,this.externalLinkTarget=e.options.linkTarget}},{key:"setHistory",value:function(e){this.pdfHistory=e}},{key:"pagesCount",get:function(){return this.pdfDocument.numPages}},{key:"page",get:function(){return this.pdfApp.currentPageNumber},set:function(e){this.pdfApp.gotoPage(e)}},{key:"navigateTo",value:function(e){this.goToDestination(e)}},{key:"addLinkAttributes",value:function(t,i){var n=this.externalLinkTarget,a=this.externalLinkRel,o=this.externalLinkEnabled;if(!i||"string"!=typeof i)throw new Error('A valid "url" parameter must provided.');var s=(0,at.removeNullCharacters)(i);o?t.href=t.title=s:(t.href="",t.title="Disabled: ".concat(s),t.onclick=function(){return!1});var r="";switch(n){case e.LINK_TARGET.NONE:break;case e.LINK_TARGET.SELF:r="_self";break;case e.LINK_TARGET.BLANK:r="_blank";break;case e.LINK_TARGET.PARENT:r="_parent";break;case e.LINK_TARGET.TOP:r="_top";break}t.target=r,t.rel="string"==typeof a?a:"noopener noreferrer nofollow"}},{key:"goToDestination",value:function(e){var t,i="",n=this,a=function(t){at.log("Requested: ",t);var o=$e(t,Object)?n._pagesRefCache[t.num+" "+t.gen+" R"]:t+1;o?((o=n.pdfApp.viewer.getViewerPageNumber(o))>n.pdfApp.pageCount&&(o=n.pdfApp.pageCount),at.log("Loading for:",t," at page ",o),n.pdfApp.requestDestRefKey===t.num+" "+t.gen+" R"?(n.pdfApp.gotoPage(o),n.pdfHistory&&n.pdfHistory.push({dest:e,hash:i,page:o})):at.log("Expired Request for ",o," with ",t)):(n.pdfApp.container.addClass("df-fetch-pdf"),n.pdfDocument.getPageIndex(t).then((function(e){var i=e+1,o=t.num+" "+t.gen+" R";n._pagesRefCache[o]=i,a(t)})))};"string"==typeof e?(i=e,t=this.pdfDocument.getDestination(e)):t=Promise.resolve(e),t.then((function(t){at.log("Started:",t),e=t,$e(t,Array)&&(n.pdfApp.requestDestRefKey=t[0].num+" "+t[0].gen+" R",a(t[0]))}))}},{key:"customNavigateTo",value:function(t){if(""!==t&&null!=t&&"null"!==t){var i=null;if(isNaN(Math.floor(t))){if("string"==typeof t&&(i=parseInt(t.replace("#",""),10),isNaN(i)))return void window.open(t,this.pdfApp.options.linkTarget===e.LINK_TARGET.SELF?"_self":"_blank")}else i=t;null!=i&&this.pdfApp.gotoPage(i)}}},{key:"getDestinationHash",value:function(e){if("string"==typeof e)return this.getAnchorUrl("#"+escape(e));if($e(e,Array)){var t=e[0],i=$e(t,Object)?this._pagesRefCache[t.num+" "+t.gen+" R"]:t+1;if(i){var n=this.getAnchorUrl("#page="+i),a=e[1];if("object"===(void 0===a?"undefined":it(a))&&"name"in a&&"XYZ"===a.name){var o=e[4]||this.pdfApp.pageScaleValue,s=parseFloat(o);s&&(o=100*s),n+="&zoom="+o,(e[2]||e[3])&&(n+=","+(e[2]||0)+","+(e[3]||0))}return n}}return this.getAnchorUrl("")}},{key:"getCustomDestinationHash",value:function(e){return"#"+escape(e)}},{key:"getAnchorUrl",value:function(e){return(this.baseUrl||"")+e}},{key:"executeNamedAction",value:function(e){switch(e){case"GoBack":this.pdfHistory&&this.pdfHistory.back();break;case"GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case"NextPage":this.page++;break;case"PrevPage":this.page--;break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1;break;default:break}var t=document.createEvent("CustomEvent");t.initCustomEvent("namedaction",!0,!0,{action:e}),this.pdfApp.container.dispatchEvent(t)}},{key:"cachePageRef",value:function(e,t){var i=t.num+" "+t.gen+" R";this._pagesRefCache[i]=e}}]),t}(),st=function(){function e(t,i){Xe(this,e),this.props=t,this.app=i,this.textureCache=[],this.pageCount=0,this.numPages=0,this.outline=[],this.viewPorts=[],this.requestedPages="",this.requestIndex=0,this.pagesToClean=[],this.defaultPage=void 0,this.pageSize=this.app.options.pageSize,this._page1Pass=!1,this._page2Pass=!1,this.pageLabels=void 0,this.textSearchLength=0,this.textSearch="",this.textContentSearch=[],this.textContentJoinedSearch=[],this.textOffsetSearch=[],this.textContent=[],this.textContentJoined=[],this.textOffset=[],this.autoLinkItemsCache=[],this.autoLinkHitsCache=[],this.searchHitItemsCache=[],this.searchHits=[],this.PDFLinkItemsCache=[],this.canPrint=!0,this.textPostion=[]}return Ye(e,[{key:"finalize",value:function(){}},{key:"dispose",value:function(){}},{key:"softDispose",value:function(){}},{key:"setCache",value:function(e,t,i){var n=this,a=i;i&&(void 0===n.textureCache[a]&&(n.textureCache[a]=[]),n.textureCache[a][e]=t)}},{key:"getCache",value:function(e,t){return void 0===this.textureCache[t]?void 0:this.textureCache[t][e]}},{key:"_isValidPage",value:function(e){return e>0&&e<=this.pageCount}},{key:"getLabelforPage",value:function(e){return this.pageLabels&&void 0!==this.pageLabels[e-1]?this.pageLabels[e-1]:e}},{key:"getThumbLabel",value:function(e){var t=this.getLabelforPage(e);return t!==e?t+" ("+e+")":e}},{key:"getPageNumberForLabel",value:function(e){if(!this.pageLabels)return e;var t=this.pageLabels.indexOf(e);return t<0?null:t+1}},{key:"processPage",value:function(e){}},{key:"cleanUpPages",value:function(){}},{key:"checkRequestQueue",value:function(){}},{key:"processAnnotations",value:function(){}},{key:"processTextContent",value:function(){}},{key:"loadDocument",value:function(){}},{key:"pagesLoaded",value:function(){var e=this;e._page1Pass&&e._page2Pass&&(e.app.viewer.checkDocumentPageSizes(),e.finalize())}},{key:"_documentLoaded",value:function(){this.finalizeOutLine(),this.app&&this.app.dimensions&&void 0===this.app.dimensions.pageFit&&at.log("Provider needs to initialize page properties for the app"),this.app._documentLoaded()}},{key:"finalizeOutLine",value:function(){if(null!==this.app&&null!==this.app.options){var e=this.app.options.outline;if(e)for(var t=0;t<e.length;t++)e[t].custom=!0,e[t].dest=e[t].dest.replace(/javascript:/g,""),this.outline.push(e[t])}}},{key:"search",value:function(){}}]),e}(),rt=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(a,t);var n=nt(a);function a(t,o){var s;Xe(this,a);var r,l=function(t){h.updateInfo(h.options.text.loading+" PDF Worker ...");var i=document.createElement("a");i.href=h.options.pdfjsWorkerSrc+u.cacheBustParameters,i.hostname!==window.location.hostname&&!0===e.loadCorsPdfjsWorker?(h.updateInfo(h.options.text.loading+" PDF Worker CORS ..."),jQuery.ajax({url:h.options.pdfjsWorkerSrc+u.cacheBustParameters,cache:!0,success:function(e){h.options.pdfjsWorkerSrc=at.createObjectURL(e,"text/javascript"),"function"==typeof t&&t()}})):"function"==typeof t&&t()},h=(s=n.call(this,t,o)).app,u=Ke(s);return u.pdfDocument=void 0,u._page2Ratio=void 0,u.cacheBustParameters="?ver="+e.version+"&pdfver="+h.options.pdfVersion,r=function(){pdfjsLib.GlobalWorkerOptions.workerSrc=h.options.pdfjsWorkerSrc+u.cacheBustParameters,pdfjsLib.canvasWillReadFrequently=e.defaults.canvasWillReadFrequently,u.loadDocument()},"undefined"==typeof pdfjsLib?(h.updateInfo(h.options.text.loading+" PDF Service ..."),at.getScript(h.options.pdfjsSrc+u.cacheBustParameters,(function(){"function"==typeof define&&i.amdO&&window.requirejs&&window.require&&window.require.config?(h.updateInfo(h.options.text.loading+" PDF Service (require) ..."),window.require.config({paths:{"pdfjs-dist/build/pdf.worker":h.options.pdfjsWorkerSrc.replace(".js","")}}),window.require(["pdfjs-dist/build/pdf"],(function(e){window.pdfjsLib=e,l(r)}))):l(r)}),(function(){h.updateInfo("Unable to load PDF service.."),u.dispose()}),h.options.pdfjsSrc.indexOf("pdfjs-4")>1)):"function"==typeof r&&r(),s}return Ye(a,[{key:"dispose",value:function(){this.pdfDocument&&this.pdfDocument.destroy(),this.linkService=at.disposeObject(this.linkService),this.pdfLoadProgress&&this.pdfLoadProgress.destroy(),this.pdfLoadProgress=null,this.pdfDocument=null}},{key:"loadDocument",value:function(){var e=this.app,t=this.app.options,i=this,n=t.pdfParameters||{};if(n.url=at.httpsCorrection(n.url||t.source),n.rangeChunkSize=t.rangeChunkSize,n.cMapPacked=!0,n.disableAutoFetch=t.disableAutoFetch,n.disableStream=t.disableStream,n.disableRange=!0===t.disableRange,n.disableFontFace=t.disableFontFace,n.isEvalSupported=!1,n.cMapUrl=t.cMapUrl,n.imagesLocation=t.imagesLocation,n.imageResourcesPath=t.imageResourcesPath,n.url||n.data||n.range){var a=i.pdfLoadProgress=pdfjsLib.getDocument(n);a._worker.promise.then((function(t){e.updateInfo(e.options.text.loading+" PDF ...")})),a.onPassword=function(e,t){switch(t){case pdfjsLib.PasswordResponses.NEED_PASSWORD:if(null===(i=prompt("Enter the password to open the PDF file.")))throw new Error("No password givsen.");e(i);break;case pdfjsLib.PasswordResponses.INCORRECT_PASSWORD:var i;if(!(i=prompt("Invalid password. Please try again.")))throw new Error("No password givaen.");e(i);break}},a.promise.then((function(n){i.pdfDocument=n,n.getPage(1).then((function(a){i.defaultPage=a;var o,s=i.defaultPage.viewPort=a.getViewport({scale:1,rotation:a._pageInfo.rotate+e.options.pageRotation}),r=i.defaultPage.pageRatio=s.width/s.height,l=r>1;i.viewPorts[1]=s,e.dimensions.defaultPage={ratio:r,viewPort:s,width:s.width,height:s.height},e.dimensions.maxTextureHeight=(null!==(o=t.maxTextureSize)&&void 0!==o?o:3200)/(l?r:1),e.dimensions.maxTextureWidth=e.dimensions.maxTextureHeight*r,e.dimensions.autoHeightRatio=1/r,i.pageCount=n.numPages,i.numPages=n.numPages,i._page1Pass=!0,i.pagesLoaded()})),n.numPages>1&&!0===e.checkSecondPage?n.getPage(2).then((function(t){var n=t.getViewport({scale:1,rotation:t._pageInfo.rotate+e.options.pageRotation});i._page2Ratio=n.width/n.height,i.viewPorts[2]=n,i._page2Pass=!0,i.pagesLoaded()})):(i._page2Pass=!0,i.pagesLoaded())})).catch((function(t){if(null!==e&&null!=e.options){var n,a="",o=document.createElement("a");o.href=e.options.source,o.hostname===window.location.hostname||-1!==o.href.indexOf("file://")||at.isChromeExtension()||-1!==o.href.indexOf("blob:")||(a="<strong>CROSS ORIGIN!! </strong>");var s=(null===(n=e.options)||void 0===n?void 0:n.fileName)||o.href;e.updateInfo(a+"<strong>Erreur: Problme d'accs au fichier!  </strong>"+s+"<br><br>"+t.message,"df-error"),e.container.removeClass("df-loading").addClass("df-error"),i.dispose()}})),a.getTotalLength=function(){return i.pdfLoadProgress._transport._networkStream._fullRequestReader.contentLength},a.onProgress=function(t){if(null!==e){var i=100*t.loaded/a.getTotalLength();isNaN(i)?t&&t.loaded?(void 0===a.lastLoaded||a.lastLoaded+25e4<t.loaded)&&(a.lastLoaded=t.loaded,e.updateInfo(e.options.text.loading+" PDF "+(Math.ceil(t.loaded/1e4)/100).toFixed(2).toString()+"MB ...")):e.updateInfo(e.options.text.loading+" PDF ..."):e.updateInfo(e.options.text.loading+" PDF "+Math.ceil(Math.min(100,i)).toString().split(".")[0]+"% ...")}}}else e.updateInfo("ERROR : No PDF File provided! ","df-error")}},{key:"pdfFetchStarted",value:function(){this.pdfFetchStatusCount=0,this.app.container.addClass("df-fetch-pdf"),this.pdfFetchStatus=e.REQUEST_STATUS.COUNT}},{key:"checkRequestQueue",value:function(){return;var t=e.REQUEST_STATUS;this.pdfFetchStatus===t.ON?(this.app.container.removeClass("df-fetch-pdf"),this.pdfFetchStatus=t.OFF):this.pdfFetchStatus===t.COUNT&&(this.pdfFetchStatusCount++,this.pdfFetchStatusCount>30&&(this.pdfFetchStatusCount=0,this.pdfFetchStatus=t.ON))}},{key:"finalize",value:function(){var e=this.app,t=this;null!==e&&null!==e.options&&(t.linkService=new ot,t.linkService.setDocument(t.pdfDocument,null),t.linkService.setViewer(e),t.pdfDocument.getOutline().then((function(i){!0===e.options.overwritePDFOutline&&(i=[]),i=i||[],t.outline=i})).finally((function(){t._getLabels()})))}},{key:"_getLabels",value:function(){var e=this.app,t=this;t.pdfDocument.getPageLabels().then((function(i){if(i&&!0!==e.options.disablePageLabels){for(var n=i.length,a=0,o=0,s=0;s<n;s++){var r=i[s];if(r===(s+1).toString())a++;else{if(""!==r)break;o++}}a>=n||o>=n||(t.pageLabels=i)}})).finally((function(){t._getPermissions()}))}},{key:"_getPermissions",value:function(){var e=this.app,t=this;t.pdfDocument.getPermissions().then((function(i){null!==i&&Array.isArray(i)&&(t.canPrint=i.indexOf(pdfjsLib.PermissionFlag.PRINT)>-1,0==t.canPrint&&(e.options.showPrintControl=e.options.showPrintControl&&t.canPrint))})).finally((function(){t._documentLoaded()}))}},{key:"processPage",value:function(e){var t=this.app,i=this,n=e.pageNumber,a=performance.now(),o=t.viewer.getTextureSize(e);if(!0===DEARFLIP.defaults.cachePDFTexture&&void 0!==this.getCache(n,o.height))return t.applyTexture(this.getCache(n,o.height),e),void at.log("Texture loaded from cache for : "+n);var s=t.viewer.getDocumentPageNumber(n);at.log("Requesting PDF Page:"+s),i.pdfDocument.getPage(s).then((function(r){i.viewPorts[n]||(e.isFreshPage=!0,i.viewPorts[n]=r.getViewport({scale:1,rotation:r._pageInfo.rotate+t.options.pageRotation}));var l,h=t.viewer.getRenderContext(r,e);e.isFreshPage&&(null===(l=t.viewer.getPageByNumber(e.pageNumber))||void 0===l||l.changeTexture(e.pageNumber,h.canvas.height));at.log("Page "+n+" rendering - "+h.canvas.width+"x"+h.canvas.height),e.trace=i.requestIndex++,i.requestedPages+=","+e.trace+"["+s+"|"+h.canvas.height+"]",r.cleanupAfterRender=!1,r.render(h).promise.then((function(){if(t.applyTexture(h.canvas,e),!0===DEARFLIP.defaults.cachePDFTexture&&i.setCache(e.pageNumber,h.canvas,o.height),!0===t.options.cleanupAfterRender){var l=","+e.trace+"["+s+"|"+h.canvas.height+"]";at.log("CleanUp Requesting for ("+n+") actual "+s),i.requestedPages.indexOf(l)>-1&&(i.requestedPages=i.requestedPages.replace(l,""),-1==i.requestedPages.indexOf("["+s+"|")?(at.log("CleanUp Passed for ("+n+") actual "+s),i.pagesToClean.push(r),i.pagesToClean.length>0&&i.cleanUpPages()):at.log("CleanUp Cancelled waiting for ("+n+") actual "+s+" : "+i.requestedPages))}h=null,at.log("Rendered "+n+" in "+(performance.now()-a)+" milliseconds")})).catch((function(e){}))})).catch((function(e){}))}},{key:"cleanUpPages",value:function(){for(;this.pagesToClean.length>0;){var e=this.pagesToClean.splice(-1)[0];at.log("Cleanup Completed for PDF page: "+(e._pageIndex+1)),e.cleanup()}}},{key:"clearSearch",value:function(){var e=this;e.searchHits=[],e.searchHitItemsCache=[],e.totalHits=0,e.app.searchResults.html(""),e.app.container.removeClass("df-search-open"),e.textSearch="",e.app.container.find(".df-search-hits").remove()}},{key:"search",value:function(e){var t=this;t.textSearch!==e&&(t.clearSearch(),e.length<3&&""!=e?t.app.updateSearchInfo("Minimum 3 letters required."):(t.textSearch=e,t.textSearchLength=e.length,t.app.searchContainer.addClass("df-searching"),t.app.container.addClass("df-fetch-pdf"),t._search(e,1)))}},{key:"_search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this;i.app.updateSearchInfo("Searching Page: "+t),i.searchPage(t).then((function(n){for(var a,o=n,s=new RegExp(e,"gi"),r=[];a=s.exec(o);)r.push({index:a.index,length:i.textSearchLength});if(i.searchHits[t]=r,r.length>0){var l=i.app.viewer.searchPage(t);!0===l.include&&(i.totalHits+=r.length,i.app.searchResults.append('<div class="df-search-result '+(i.app.currentPageNumber===t?"df-active":"")+'" data-df-page="'+t+'"><span>Page '+l.label+"</span><span>"+r.length+" "+(r.length>1?"results":"result")+"</span></div>"))}i.app.viewer.isActivePage(t)&&(i.processTextContent(t,i.app.viewer.getTextElement(t,!0)),i.app.ui.update()),i._search(e,t+1)})).catch((function(){})).finally((function(){0==i.totalHits?i.app.updateSearchInfo("No results Found!"):i.app.updateSearchInfo(i.totalHits+" results found"),i.app.searchContainer.removeClass("df-searching"),i.app.container.removeClass("df-fetch-pdf")}))}},{key:"prepareTextContent",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==(n=this).textContentJoinedSearch[t]||i){var n,a,o=0,s=0,r=0;(n=this).textContentSearch[t]=[],n.textContent[t]=[],n.textOffsetSearch[t]=[],n.textOffset[t]=[],n.textContentJoinedSearch[t]=[],n.textContentJoined[t]=[];for(var l=0;l<e.items.length;l++)a=e.items[l],n.textContentSearch[t].push(!0===a.hasEOL?a.str+" ":a.str),n.textContent[t].push(a.str+" "),s+=r=(a.str.length||0)+(!0===a.hasEOL?1:0),n.textOffsetSearch[t].push({length:r,offset:s-r}),o+=r=(a.str.length||0)+1,n.textOffset[t].push({length:r,offset:o-r});n.textContentJoinedSearch[t]=n.textContentSearch[t].join(""),n.textContentJoined[t]=n.textContent[t].join("")}}},{key:"searchPage",value:function(e){var t=this;return new Promise((function(i,n){if(t._isValidPage(e))try{var a=t.app.viewer.getDocumentPageNumber(e);null==t.textContentJoinedSearch[a]?t.pdfDocument.getPage(a).then((function(e){e.getTextContent().then((function(e){t.prepareTextContent(e,a),i(t.textContentJoinedSearch[a])}))})):i(t.textContentJoinedSearch[a])}catch(e){at.log(e),n(e)}else n()}))}}]),a}(st);function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ht(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ut(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pt(e,t,i){return t&&ut(e.prototype,t),i&&ut(e,i),e}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}function dt(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?lt(e):t;var i}function ft(e,t){return ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ft(e,t)}function gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=ct(e);if(t){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return dt(this,i)}}e.providers.pdf=rt;var vt=e.utils,mt=function(){function e(t){ht(this,e),this._viewPort=new bt(0,0),this._pageInfo={rotate:0},this.src=t.src}return pt(e,[{key:"getViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scale:1};return new bt(this._viewPort.height*e.scale,this._viewPort.width*e.scale,e.scale)}}]),e}(),yt=function(){function e(t){ht(this,e),this.source=[],this.pages=[],this.numPages=t.length;for(var i=0;i<t.length;i++)this.source[i]=vt.httpsCorrection(t[i].toString()),this.pages.push(new mt({src:this.source[i]}))}return pt(e,[{key:"getPage",value:function(e){var t=this;return new Promise((function(i,n){try{jQuery("<img/>").attr("src",t.source[e-1]).prop("crossOrigin","Anonymous").on("load",(function(){jQuery(this).off();var e=new mt({src:this.src});e._viewPort.height=this.height,e._viewPort.width=this.width,e._viewPort.scale=1,e.image=this,i(e)}))}catch(e){n(e)}}))}}]),e}(),bt=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;ht(this,e),this.scale=n,this.height=t,this.width=i,this.scale=n,this.transform=[0,0,0,0,0,this.height]}return pt(e,[{key:"clone",value:function(){return new e(this.height,this.width,this.scale)}}]),e}(),wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(i,e);var t=gt(i);function i(e,n){var a;ht(this,i);var o=(a=t.call(this,e,n)).app,s=lt(a);return s.document=new yt(o.options.source),s.pageCount=s.document.numPages,s.numPages=s.document.numPages,s.loadDocument(),a}return pt(i,[{key:"dispose",value:function(){}},{key:"loadDocument",value:function(){var e=this.app,t=this.app.options,i=this;i.document.getPage(1).then((function(n){i.defaultPage=n;var a,o=i.defaultPage.viewPort=n._viewPort,s=i.defaultPage.pageRatio=o.width/o.height,r=s>1;i.viewPorts[1]=o,e.dimensions.defaultPage={ratio:s,viewPort:o,width:o.width,height:o.height},e.dimensions.maxTextureHeight=(null!==(a=t.maxTextureSize)&&void 0!==a?a:3200)/(r?s:1),e.dimensions.maxTextureWidth=e.dimensions.maxTextureHeight*s,e.dimensions.autoHeightRatio=1/s,i._page1Pass=!0,i.pagesLoaded()})),i.pageCount>1&&!0===e.checkSecondPage?i.document.getPage(2).then((function(e){var t=e._viewPort;i._page2Ratio=t.width/t.height,i.viewPorts[2]=t,i._page2Pass=!0,i.pagesLoaded()})):(i._page2Pass=!0,i.pagesLoaded())}},{key:"finalize",value:function(){var e=this.app,t=this;null!==e&&null!==e.options&&(t.linkService=new ot,t.linkService.setViewer(e),t._documentLoaded())}},{key:"processPage",value:function(e){var t=this.app,i=this,n=e.pageNumber,a=performance.now(),o=t.viewer.getDocumentPageNumber(n);vt.log("Requesting PDF Page:"+o),i.document.getPage(o).then((function(o){i.viewPorts[n]||(e.isFreshPage=!0,i.viewPorts[n]=o._viewPort);var s,r,l=t.viewer.getRenderContext(o,e);e.isFreshPage&&(null===(s=t.viewer.getPageByNumber(e.pageNumber))||void 0===s||s.changeTexture(e.pageNumber,l.canvas.height));(e.preferCanvas=!0,!0===e.preferCanvas)?(l.canvas.getContext("2d").drawImage(o.image,l.viewport.transform[4],0,l.canvas.width*(null!==(r=l.viewport.widthFix)&&void 0!==r?r:1),l.canvas.height),t.applyTexture(l.canvas,e)):t.applyTexture({src:o.src,height:l.canvas.height,width:l.canvas.width},e);vt.log("Rendered "+n+" in "+(performance.now()-a)+" milliseconds")}))}}]),i}(st);e.providers.image=wt;i(101);function Pt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function St(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xt(e,t,i){return t&&St(e.prototype,t),i&&St(e,i),e}function Ct(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}var Tt=e.jQuery,Et=e.utils,kt=e.REQUEST_STATUS,Ot=function(){function t(e,i){Pt(this,t),this.options=e,this.app=i,this.parentElement=this.app.container,this.element=Tt("<div>",{class:"df-ui"}),this.leftElement=Tt("<div>",{class:"df-ui-left"}).appendTo(this.element),this.centerElement=Tt("<div>",{class:"df-ui-center"}).appendTo(this.element),this.rightElement=Tt("<div>",{class:"df-ui-right"}).appendTo(this.element),this.parentElement.append(this.element),this.events={},this.controls={}}return xt(t,[{key:"init",value:function(){var t=this,i="<div>",n=this.app,a=this.controls,o=n.options.text,s=n.options.icons;t.createLogo(),this.openRight=a.openRight=Tt(i,{class:"df-ui-nav df-ui-next",title:n.isRTL?o.previousPage:o.nextPage,html:'<div class="df-ui-btn '+s.next+'"></div>'}).on("click",(function(){n.openRight()})),this.openLeft=a.openLeft=Tt(i,{class:"df-ui-nav df-ui-prev",title:n.isRTL?o.nextPage:o.previousPage,html:'<div class="df-ui-btn '+s.prev+'"></div>'}).on("click",(function(){n.openLeft()})),1==n.options.autoPlay&&(this.play=a.play=Et.createBtn("play",s.play,o.play).on("click",(function(){var e=Tt(this);n.setAutoPlay(!e.hasClass(n.options.icons.pause))})),n.setAutoPlay(n.options.autoPlayStart)),this.pageNumber=a.pageNumber=Et.createBtn("page").on("change",(function(){n.gotoPageLabel(a.pageInput.val())})).on("keyup",(function(e){13===e.keyCode&&n.gotoPageLabel(a.pageInput.val())}));var r="df_book_page_number_"+Math.ceil(performance.now()/10);this.pageInput=a.pageInput=Tt('<input id="'+r+'" type="text"/>').appendTo(a.pageNumber),this.pageLabel=a.pageLabel=Tt('<label for="'+r+'"></label>').appendTo(a.pageNumber),this.thumbnail=a.thumbnail=Et.createBtn("thumbnail",s.thumbnail,o.toggleThumbnails),a.thumbnail.on("click",(function(){var e=Tt(this);null==n.thumblist&&n.initThumbs(),n.thumbContainer.toggleClass("df-sidemenu-visible"),e.toggleClass("df-active"),e.hasClass("df-active")&&(e.siblings(".df-active").trigger("click"),n.thumbRequestStatus=kt.ON),t.update(),!1===n.options.sideMenuOverlay&&n.resizeRequestStart()})).addClass("df-sidemenu-trigger"),n.hasOutline()&&(this.outline=a.outline=Et.createBtn("outline",s.outline,o.toggleOutline),a.outline.on("click",(function(){var e=Tt(this);if(null==n.outlineViewer&&n.initOutline(),n.outlineContainer){var i=n.outlineContainer;e.toggleClass("df-active"),i.toggleClass("df-sidemenu-visible"),e.hasClass("df-active")&&e.siblings(".df-active").trigger("click"),t.update(),!1===n.options.sideMenuOverlay&&n.resizeRequestStart()}})).addClass("df-sidemenu-trigger")),!0===n.options.showSearchControl&&!0!==Et.isMobile&&"string"==typeof n.options.source&&(a.search=Et.createBtn("search",s.search,o.search),a.search.on("click",(function(){var e=Tt(this);if(null==n.searchContainer&&n.initSearch(),n.searchContainer){var i=n.searchContainer;e.toggleClass("df-active"),i.toggleClass("df-sidemenu-visible"),e.hasClass("df-active")&&(e.siblings(".df-active").trigger("click"),n.searchBox.focus()),t.update(),!1===n.options.sideMenuOverlay&&n.resizeRequestStart()}})).addClass("df-sidemenu-trigger"));var l=t.element;if(this.zoomIn=a.zoomIn=Et.createBtn("zoomin",s.zoomin,o.zoomIn).on("click",(function(){n.zoom(1),t.update()})),this.zoomOut=a.zoomOut=Et.createBtn("zoomout",s.zoomout,o.zoomOut).on("click",(function(){n.zoom(-1),t.update()})),this.resetZoom=a.resetZoom=Et.createBtn("resetzoom",s.resetzoom,o.resetZoom).on("click",(function(){n.resetZoom(-1),t.update()})),n.viewer.isFlipBook){if(n.pageCount>2){var h=n.viewer.pageMode===e.FLIPBOOK_PAGE_MODE.SINGLE;this.pageMode=a.pageMode=Et.createBtn("pagemode",s[h?"doublepage":"singlepage"],h?o.doublePageMode:o.singlePageMode).on("click",(function(){var e=Tt(this);n.viewer.setPageMode({isSingle:!e.hasClass(s.doublepage)}),n.viewer.pageModeChangedManually=!0}))}}else this.pageFit=a.pageFit=Et.createBtn("pagefit",s.pagefit,o.pageFit).on("click",(function(){var e=a.pageFit;!0===!e.hasClass(s.widthfit)?(e.addClass(s.widthfit),e.html("<span>"+o.widthFit+"</span>"),e.attr("title",o.widthFit)):(e.removeClass(s.widthfit),e.html("<span>"+o.pageFit+"</span>"),e.attr("title",o.pageFit))}));if(t.shareBox=new Rt(n.container,n.options),this.share=a.share=Et.createBtn("share",s.share,o.share).on("click",(function(){!0===t.shareBox.isOpen?t.shareBox.close():(t.shareBox.update(n.getURLHash()),t.shareBox.show())})),this.more=a.more=Et.createBtn("more",s.more).on("click",(function(e){!0!==t.moreContainerOpen&&(Tt(this).addClass("df-active"),t.moreContainerOpen=!0,e.stopPropagation())})),this.startPage=a.startPage=Et.createBtn("start",s.start,o.gotoFirstPage).on("click",(function(){n.start()})),this.endPage=a.endPage=Et.createBtn("end",s.end,o.gotoLastPage).on("click",(function(){n.end()})),!0===n.options.showPrintControl&&!0!==Et.isMobile&&"string"==typeof n.options.source&&(this.print=a.print=Et.createBtn("print",s.print,o.print).on("click",(function(){e.printHandler=e.printHandler||new Nt,e.printHandler.printPDF(n.options.source)}))),!0===n.options.showDownloadControl&&"string"==typeof n.options.source){var u="df-ui-btn df-ui-download "+s.download;this.download=a.download=Tt('<a download target="_blank" class="'+u+'"><span>'+o.downloadPDFFile+"</span></a>"),a.download.attr("href",Et.httpsCorrection(n.options.source)).attr("title",o.downloadPDFFile)}t.moreContainer=Tt(i,{class:"df-more-container"}),a.more.append(t.moreContainer),!0===n.options.isLightBox&&!0!==n.fullscreenSupported||(this.fullScreen=a.fullScreen=Et.createBtn("fullscreen",s.fullscreen,o.toggleFullscreen).on("click",n.switchFullscreen.bind(n))),n.viewer.initCustomControls();var p=n.options.allControls.replace(/ /g,"").split(","),c=","+n.options.moreControls.replace(/ /g,"")+",",d=","+n.options.hideControls.replace(/ /g,"")+",";n.options.leftControls.replace(/ /g,""),n.options.rightControls.replace(/ /g,"");d+=",";for(var f=0;f<p.length;f++){var g=p[f];if(d.indexOf(","+g+",")<0){var v=a[g];null!=v&&"object"==(void 0===v?"undefined":Ct(v))&&(c.indexOf(","+g+",")>-1&&"more"!==g&&"pageNumber"!==g?t.moreContainer.append(v):1==n.options.controlsFloating?l.append(v):this.centerElement.append(v))}}0==t.moreContainer.children().length&&this.more.addClass("df-hidden"),n.container.append(l),n.container.append(a.openLeft),n.container.append(this.controls.openRight),window.addEventListener("click",t.events.closePanels=t.closePanels.bind(t),!1),window.addEventListener("keyup",t.events.keyup=t.keyUp.bind(t),!1),document.addEventListener("fullscreenchange",t.events.fullscreenChange=t.fullscreenChange.bind(t),!1),!0===n.options.autoOpenThumbnail&&t.controls.thumbnail.trigger("click"),n.hasOutline()&&!0===n.options.autoOpenOutline&&t.controls.outline.trigger("click"),n.executeCallback("onCreateUI")}},{key:"closePanels",value:function(e){var t;!0===this.moreContainerOpen&&(null===(t=this.controls.more)||void 0===t||t.removeClass("df-active"),this.moreContainerOpen=!1)}},{key:"fullscreenChange",value:function(e){void 0===Et.getFullscreenElement()&&!0===this.app.isFullscreen&&this.app.switchFullscreen()}},{key:"keyUp",value:function(t){var i=this.app;if("INPUT"!==t.target.nodeName){var n=!1;switch(i.options.arrowKeysAction===e.ARROW_KEYS_ACTIONS.NAV&&(!0!==i.isFullscreen&&!0!==i.options.isLightBox||(n=!0),1!=i.options.isLightBox&&e.activeEmbeds.length<2&&!1===Tt("body").hasClass("df-lightbox-open")&&(n=!0)),t.keyCode){case 27:e.activeLightBox&&e.activeLightBox.app&&!Et.isChromeExtension()&&e.activeLightBox.closeButton.trigger("click");break;case 37:n&&i.openLeft();break;case 39:n&&i.openRight();break;default:break}}}},{key:"createLogo",value:function(){var e=this.app,t=null;e.options.logo.indexOf("<")>-1?t=Tt(e.options.logo).addClass("df-logo df-logo-html"):e.options.logo.trim().length>2&&(t=Tt('<a class="df-logo df-logo-img" target="_blank" href="'+e.options.logoUrl+'"><img alt="" src="'+e.options.logo+'"/>')),this.element.append(t)}},{key:"dispose",value:function(){var e=this;for(var t in this.controls)if(this.controls.hasOwnProperty(t)){var i=this.controls[t];null!==i&&"object"==(void 0===i?"undefined":Ct(i))&&i.off().remove()}e.element.remove(),e.shareBox=Et.disposeObject(e.shareBox),window.removeEventListener("click",e.events.closePanels,!1),window.removeEventListener("keyup",e.events.keyup,!1),document.removeEventListener("fullscreenchange",e.events.fullscreenChange,!1)}},{key:"update",value:function(){var e=this.app,t=this.controls;!0!==this._pageLabelWidthSet&&(this.pageLabel.width(""),e.provider.pageLabels?this.pageLabel.html("88888888888888888".substring(0,3*e.pageCount.toString().length+4)):this.pageLabel.html("88888888888".substring(0,2*e.pageCount.toString().length+3)),this.pageNumber.width(this.pageLabel.width()),this.pageLabel.width(this.pageLabel.width()),this.pageLabel.html(""),this._pageLabelWidthSet=!0);var i=e.getCurrentLabel();i.toString()!==e.currentPageNumber.toString()?t.pageLabel.html(i+"("+e.currentPageNumber+"/"+e.pageCount+")"):t.pageLabel.html(i+"/"+e.pageCount),t.pageInput.val(i),e.container.toggleClass("df-sidemenu-open",e.container.find(".df-sidemenu-visible").length>0);var n=e.provider.totalHits>0&&e.container.find(".df-sidemenu-visible.df-search-container").length>0;if(e.container.toggleClass("df-search-open",n),n){var a=e.searchContainer.find(".df-search-result[data-df-page="+e.currentPageNumber+"]");if(e.searchContainer.find(".df-search-result.df-active").removeClass("df-active"),a.length>0&&!a.hasClass(".df-active")){a.addClass("df-active");var o=e.searchResults[0],s=o.scrollTop;s+o.getBoundingClientRect().height<(a=a[0]).offsetTop+a.scrollHeight?Et.scrollIntoView(a,null,!1):s>a.offsetTop&&Et.scrollIntoView(a)}}t.zoomIn.toggleClass("disabled",e.zoomValue===e.viewer.maxZoom),t.zoomOut.toggleClass("disabled",e.zoomValue===e.viewer.minZoom);var r=e.isRTL,l=e.currentPageNumber===e.startPage,h=e.currentPageNumber===e.endPage,u=l&&!r||h&&r,p=h&&!r||l&&r;t.openRight.toggleClass("df-hidden",p),t.openLeft.toggleClass("df-hidden",u),e.viewer.afterControlUpdate()}}]),t}(),Rt=function(){function e(t,i){Pt(this,e);var n=this;n.isOpen=!1,n.shareUrl="",n.init(t,i)}return xt(e,[{key:"init",value:function(e,t){var i=function(e){if(t.share.hasOwnProperty(e)&&t.hideShareControls.indexOf(e)<0){var i=t.share[e];null!==i&&(n[e]=Tt("<div>",{class:a+" df-share-"+e+" "+t.icons[e]}).on("click",(function(e){e.preventDefault(),window.open(i.replace("{{url}}",encodeURIComponent(n.shareUrl)).replace("{{mailsubject}}",t.text.mailSubject),"Sharer",o),e.stopPropagation()})),n.box.append(n[e]))}},n=this,a="df-share-button",o="width=500,height=400";for(var s in n.wrapper=Tt('<div class="df-share-wrapper" style="display: none;">').on("click",(function(){n.close()})),n.box=Tt('<div class="df-share-box">'),n.box.on("click",(function(e){e.preventDefault(),e.stopPropagation()})),n.box.appendTo(n.wrapper).html('<span class="df-share-title">'+t.text.share+"</span>"),n.urlInput=Tt('<textarea name="df-share-url" class="df-share-url">').on("click",(function(){Tt(this).select()})),n.box.append(n.urlInput),t.share)i(s);Tt(e).append(n.wrapper)}},{key:"show",value:function(){this.wrapper.fadeIn(300),this.urlInput.val(this.shareUrl),this.urlInput.trigger("click"),this.isOpen=!0}},{key:"dispose",value:function(){var e=this;for(var t in e)e.hasOwnProperty(t)&&e[t]&&e[t].off&&e[t].off();e.wrapper.remove()}},{key:"close",value:function(){this.wrapper.fadeOut(300),this.isOpen=!1}},{key:"update",value:function(e){this.shareUrl=e}}]),e}(),Lt=function(){function t(i){Pt(this,t),this.duration=300;var n=this;return n.lightboxWrapper=Tt("<div>").addClass("df-lightbox-wrapper"),n.backGround=Tt("<div>").addClass("df-lightbox-bg").appendTo(n.lightboxWrapper),n.element=Tt("<div>").addClass("df-app").appendTo(n.lightboxWrapper),n.controls=Tt("<div>").addClass("df-lightbox-controls").appendTo(n.lightboxWrapper),n.closeButton=Tt("<div>").addClass("df-lightbox-close df-ui-btn "+e.defaults.icons.close).on("click",(function(){n.close(i)})).appendTo(n.controls),n.lightboxWrapper.append(n.element),n}return xt(t,[{key:"show",value:function(e){return 0===this.lightboxWrapper.parent().length&&Tt("body").append(this.lightboxWrapper),Tt("html,body").addClass("df-lightbox-open"),this.lightboxWrapper.fadeIn(this.duration),"function"==typeof e&&e(),this}},{key:"close",value:function(t){return this.lightboxWrapper.fadeOut(this.duration),Array.prototype.forEach.call(e.utils.getSharePrefixes(),(function(e){0===window.location.hash.indexOf("#"+e)&&history.replaceState(void 0,void 0,"#_")})),"function"==typeof t&&setTimeout(t,this.duration),Tt("html,body").removeClass("df-lightbox-open"),this.element.attr("class","df-app").attr("style",""),this.lightboxWrapper.attr("class","df-lightbox-wrapper").attr("style",""),this.backGround.attr("style",""),this}}]),t}(),Nt=function(){function e(){Pt(this,e);var t=this;return t.frame=Tt('<iframe id="df-print-frame" style="display:none">').appendTo(Tt("body")),t.frame.on("load",(function(){try{t.frame[0].contentWindow.print()}catch(e){}})),t}return xt(e,[{key:"printPDF",value:function(e){this.frame[0].src=e}}]),e}(),It=function(){function e(t,i){Pt(this,e),this.options=t,this.app=i,this.parentElement=t.parentElement,this.element=Tt("<div>",{class:"df-sidemenu-wrapper"}),this.parentElement.append(this.element),this.buttons=Tt("<div>",{class:"df-sidemenu-buttons df-ui-wrapper"}).appendTo(this.element),this.close=Et.createBtn("close",i.options.icons.close,i.options.text.close),this.buttons.append(this.close)}return xt(e,[{key:"dispose",value:function(){this.element.remove()}}]),e}(),_t=function(){function e(t){Pt(this,e),this.outline=null,this.lastToggleIsShow=!0,this.container=t.container,this.linkService=t.linkService,this.outlineItemClass=t.outlineItemClass||"outlineItem",this.outlineToggleClass=t.outlineToggleClass||"outlineItemToggler",this.outlineToggleHiddenClass=t.outlineToggleHiddenClass||"outlineItemsHidden"}return xt(e,[{key:"dispose",value:function(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.linkService=null}},{key:"reset",value:function(){this.outline=null,this.lastToggleIsShow=!0;for(var e=this.container;e.firstChild;)e.removeChild(e.firstChild)}},{key:"_dispatchEvent",value:function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("outlineloaded",!0,!0,{outlineCount:e}),this.container.dispatchEvent(t)}},{key:"_bindLink",value:function(e,t){var i=this.linkService;if(!0===t.custom)e.href=i.getCustomDestinationHash(t.dest),e.onclick=function(){return i.customNavigateTo(t.dest),!1};else{if(t.url)return void pdfjsLib.addLinkAttributes(e,{url:t.url});e.href=i.getDestinationHash(t.dest),e.onclick=function(){return i.navigateTo(t.dest),!1}}}},{key:"_addToggleButton",value:function(e){var t=this,i=document.createElement("div");i.className=this.outlineToggleClass+" "+this.outlineToggleHiddenClass,i.onclick=function(n){if(n.stopPropagation(),i.classList.toggle(this.outlineToggleHiddenClass),n.shiftKey){var a=!i.classList.contains(this.outlineToggleHiddenClass);t._toggleOutlineItem(e,a)}}.bind(this),e.insertBefore(i,e.firstChild)}},{key:"_toggleOutlineItem",value:function(e,t){this.lastToggleIsShow=t;for(var i=e.querySelectorAll("."+this.outlineToggleClass),n=0,a=i.length;n<a;++n)i[n].classList[t?"remove":"add"](this.outlineToggleHiddenClass)}},{key:"render",value:function(e){var t=e&&e.outline||null,i=0;if(this.outline&&this.reset(),this.outline=t,t){for(var n=document.createDocumentFragment(),a=[{parent:n,items:this.outline,custom:!1}],o=!1;a.length>0;)for(var s=a.shift(),r=s.custom,l=0,h=s.items.length;l<h;l++){var u=s.items[l],p=document.createElement("div");p.className=this.outlineItemClass;var c=document.createElement("a");if(null==u.custom&&null!=r&&(u.custom=r),this._bindLink(c,u),c.textContent=u.title.replace(/\x00/g,""),p.appendChild(c),u.items&&u.items.length>0){o=!0,this._addToggleButton(p);var d=document.createElement("div");d.className=this.outlineItemClass+"s",p.appendChild(d),a.push({parent:d,custom:u.custom,items:u.items})}s.parent.appendChild(p),i++}o&&(null!=this.container.classList?this.container.classList.add(this.outlineItemClass+"s"):null!=this.container.className&&(this.container.className+=" picWindow")),this.container.appendChild(n),this._dispatchEvent(i)}}}]),e}(),At=function(){function t(e){Pt(this,t);var i=function(){o.thumbRequestCount=0,o.thumbRequestStatus=kt.COUNT},n=this.itemHeight=e.itemHeight,a=this.itemWidth=e.itemWidth,o=this.app=e.app;this.items=e.items,this.generatorFn=e.generatorFn,this.totalRows=e.totalRows||e.items&&e.items.length,this.addFn=e.addFn,this.scrollFn=e.scrollFn,this.container=document.createElement("div");for(var s=this,r=0;r<this.totalRows;r++){var l=document.createElement("div"),h=r+1;l.id="df-thumb"+h;var u=document.createElement("div"),p=document.createElement("div"),c=document.createElement("div");c.className="df-wrapper",p.className="df-thumb-number",l.className="df-thumb",u.className="df-bg-image",c.style.height=n+"px",c.style.width=a+"px",p.innerText=o.provider.getLabelforPage(h),l.appendChild(c),c.appendChild(p),c.appendChild(u),this.container.appendChild(l)}s.dispose=function(){s.container&&s.container.parentNode&&s.container.parentNode.removeChild(s.container),s.container.removeEventListener("scroll",i)},s.container.addEventListener("scroll",i)}return xt(t,[{key:"processThumbRequest",value:function(){Et.log("Thumb Request Initiated");var t=this.app;if((t.thumbRequestStatus=kt.OFF,t.activeThumb!==t.currentPageNumber)&&(null!=t.thumbContainer&&t.thumbContainer.hasClass("df-sidemenu-visible"))){var i=t.thumblist.container,n=i.scrollTop,a=i.getBoundingClientRect().height,o=t.thumbContainer.find("#df-thumb"+t.currentPageNumber);o.length>0?(t.thumbContainer.find(".df-selected").removeClass("df-selected"),o.addClass("df-selected"),n+a<(o=o[0]).offsetTop+o.scrollHeight?Et.scrollIntoView(o,null,!1):n>o.offsetTop&&Et.scrollIntoView(o),t.activeThumb=t.currentPageNumber):(Tt(i).scrollTop(124*t.currentPageNumber),t.thumbRequestStatus=kt.ON)}if(0===t.thumblist.container.getElementsByClassName("df-thumb-requested").length){var s=Et.getVisibleElements({container:t.thumblist.container,elements:t.thumblist.container.children});Tt.inArray(s)&&s.unshift(t.activeThumb);for(var r=0;r<s.length;r++){var l=t.thumblist.container.children[s[r]-1];if(void 0!==l&&!1===l.classList.contains("df-thumb-loaded")&&!1===l.classList.contains("df-thumb-requested"))return l.classList.add("df-thumb-requested"),Et.log("Thumb Requested for "+s[r]),t.provider.processPage({pageNumber:s[r],textureTarget:e.TEXTURE_TARGET.THUMB}),!1}}}},{key:"setPage",value:function(t){var i=this.app,n=t.pageNumber,a=t.texture;if(t.textureTarget===e.TEXTURE_TARGET.THUMB){var o=i.container.find("#df-thumb"+n);o.find(".df-wrapper").css({height:t.height,width:t.width}),o.find(".df-bg-image").css({backgroundImage:Et.bgImage(a)}),o.addClass("df-thumb-loaded").removeClass("df-thumb-requested")}Et.log("Thumbnail set for "+t.pageNumber),i.thumbRequestStatus=kt.ON}}]),t}();function Mt(){if(void 0===e.openLocalFileInput){var t=e.openLocalFileInput=Tt('<input type="file" accept=".pdf" style="display:none">').appendTo(Tt("body")).data("df-option",e.openFileOptions);t.change((function(){var i,n=t[0].files;n.length&&(i=n[0],t.val(""),e.openFile(i))}))}}function Ft(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.openLightBox=function(t){e.activeLightBox||(e.activeLightBox=new Lt((function(){e.activeLightBox.app&&(e.activeLightBox.app.closeRequested=!0,e.activeLightBox.app.analytics({eventAction:e.activeLightBox.app.options.analyticsViewerClose,options:e.activeLightBox.app.options})),e.activeLightBox.app=Et.disposeObject(e.activeLightBox.app)}))),e.activeLightBox.duration=300,void 0!==e.activeLightBox.app&&null!==e.activeLightBox.app&&!0!==e.activeLightBox.app.closeRequested&&e.openLocalFileInput!=t||(e.activeLightBox.app=Et.disposeObject(e.activeLightBox.app),null===e.activeLightBox.app&&e.activeLightBox.show((function(){e.activeLightBox.app=Tt(e.activeLightBox.element).dearviewer({transparent:!1,isLightBox:!0,hashNavigationEnabled:!0,height:"100%",dataElement:t}),history.pushState({},null,"#"),e.activeLightBox.lightboxWrapper.toggleClass("df-lightbox-padded",!1===e.activeLightBox.app.options.popupFullsize),e.activeLightBox.lightboxWrapper.toggleClass("df-rtl",e.activeLightBox.app.options.readDirection===e.READ_DIRECTION.RTL),e.activeLightBox.backGround.css({backgroundColor:"transparent"===e.activeLightBox.app.options.backgroundColor?e.defaults.popupBackGroundColor:e.activeLightBox.app.options.backgroundColor})})))},e.checkBrowserURLforDefaults=function(){if(!Et.isIEUnsupported){var t=new URL(location.href).searchParams.get("viewer-type")||new URL(location.href).searchParams.get("viewertype"),i=new URL(location.href).searchParams.get("is-3d")||new URL(location.href).searchParams.get("is3d");t&&(e.defaults.viewerType=t),"true"!==i&&"false"!==i||(e.defaults.is3D="true"===i)}},e.checkBrowserURLforPDF=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!Et.isIEUnsupported){var i=new URL(location.href).searchParams.get("pdf-source");return i&&(i=decodeURI(i),t&&e.openURL(i)),i}},e.fileDropHandler=function(t,i){var n=t[0];"application/pdf"===n.type&&(i.preventDefault(),i.stopPropagation(),e.openFile(n))},e.openFile=function(t){var i;t?(e.oldLocalFileObjectURL&&window.URL.revokeObjectURL(e.oldLocalFileObjectURL),e.oldLocalFileObjectURL=window.URL.createObjectURL(t),null===(i=e.openFileSelected)||void 0===i||i.call(e,{url:e.oldLocalFileObjectURL,file:t}),e.openURL(e.oldLocalFileObjectURL)):e.openURL()},e.openURL=function(t){Mt(),t&&(e.openFileOptions.source=t,e.openFileOptions.pdfParameters=null),e.openLightBox(e.openLocalFileInput)},e.openBase64=function(t){e.openFileOptions.source=null,e.openFileOptions.pdfParameters={data:atob(t)},e.openURL()},e.openLocalFile=function(){Mt(),e.openLocalFileInput.click()},e.initControls=function(){var t=Tt("body");if(!1!==e.defaults.autoPDFLinktoViewer&&t.on("click",'a[href$=".pdf"]',(function(t){var i=Tt(this);void 0!==i.attr("download")||"_blank"===i.attr("target")||i.hasClass("df-ui-btn")||i.parents(".df-app").length>0||(t.preventDefault(),i.data("df-source",i.attr("href")),e.openLightBox(i))})),window.addEventListener("popstate",(function(t){e.activeLightBox&&e.activeLightBox.app&&!Et.isChromeExtension()&&e.activeLightBox.closeButton.trigger("click")})),t.on("click",".df-open-local-file",(function(t){e.openLocalFile()})),t.on("click",".df-sidemenu-buttons .df-ui-close",(function(){Tt(this).closest(".df-app").find(".df-ui-btn.df-active").trigger("click")})),t.on("mouseout",".df-link-content section.squareAnnotation, .df-link-content section.textAnnotation, .df-link-content section.freeTextAnnotation",(function(){var t=Tt(this);e.handlePopup(t,!1)})),t.on("mouseover",".df-link-content section.squareAnnotation, .df-link-content section.textAnnotation, .df-link-content section.freeTextAnnotation",(function(){var t=Tt(this);e.handlePopup(t,!0)})),e.handlePopup=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.closest(".df-container"),n=i.find(".df-comment-popup");if(n.toggleClass("df-active",t),t){var a=e[0].getBoundingClientRect(),o=i[0].getBoundingClientRect(),s=e.find(".popupWrapper").first();if(e.hasClass("popupTriggerArea")){var r=e.data("annotation-id");void 0!==r&&(s=e.siblings("[data-annotation-id=popup_"+r+"]"))}n.html(s.html());var l=a.left-o.left;l+360>o.width?l=o.width-360-10:l<10&&(l=10);var h=a.top-o.top+a.height+5;h+n.height()>o.height?h=a.top-n.height()-a.height-10:h<10&&(h=10),n.css({left:l,top:h})}},null!=e.fileDropElement){var i=Tt(e.fileDropElement);i.length>0&&(i.on("dragover",(function(e){e.preventDefault(),e.stopPropagation(),Tt(this).addClass("df-dragging")})),i.on("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),Tt(this).removeClass("df-dragging")})),i.on("drop",(function(t){var i=t.originalEvent.dataTransfer.files;i.length&&e.fileDropHandler(i,t)})))}};var Dt=e.jQuery,zt=e.REQUEST_STATUS,Bt=e.utils,Ut=function(){function t(i){var n,a,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=i,this.viewerType=this.options.viewerType,this.startPage=1,this.endPage=1,this.element=Dt(this.options.element),i.maxTextureSize=null!==(n=i.maxTextureSize)&&void 0!==n?n:2048,Bt.isMobile&&(i.maxTextureSize=4096===i.maxTextureSize?3200:i.maxTextureSize),this.dimensions={padding:{},offset:{},pageFit:{},stage:{},isAutoHeight:"auto"===i.height,maxTextureSize:i.maxTextureSize},this.is3D=i.is3D,this.options.pixelRatio=Bt.limitAt(this.options.pixelRatio,1,this.options.maxDPI),this.options.fakeZoom=null!==(a=this.options.fakeZoom)&&void 0!==a?a:1,this.events={},this.links=i.links,this.thumbSize=128,this.pendingZoom=!0,this.currentPageNumber=this.options.openPage||this.startPage,this.hashNavigationEnabled=!0===this.options.hashNavigationEnabled,this.pendingZoom=!0,this.zoomValue=1,this.pageScaling=e.PAGE_SCALE.MANUAL,this.isRTL=i.readDirection===e.READ_DIRECTION.RTL,this.jumpStep=1,this.resizeRequestStatus=zt.OFF,this.refreshRequestStatus=zt.OFF,this.refreshRequestCount=0,this.resizeRequestCount=0,this.fullscreenSupported=Bt.hasFullscreenEnabled(),this.thumbRequestCount=0,this.isExternalReady=null===(o=this.options.isExternalReady)||void 0===o||o,this.init(),!0===this.options.autoLightBoxFullscreen&&!0===this.options.isLightBox&&this.switchFullscreen(),this.executeCallback("onCreate"),this.target=this}var i,n,a;return i=t,n=[{key:"init",value:function(){var t=this.options,i=this;return i.initDOM(),i.initResourcesLocation(),i.initInfo(),null!=t.source&&0!==t.source.length||null!=t.pdfParameters?Bt.isIEUnsupported?(i.updateInfo("Your browser (Internet Explorer) is out of date! <br><a href='https://browsehappy.com/'>Upgrade to a new browser.</a>","df-old-browser"),void i.container.removeClass("df-loading").addClass("df-error")):(i.commentPopup=Dt('<div class="df-comment-popup">').appendTo(i.container),i.viewer=new i.viewerType(t,this),i.sideMenu=new It({parentElement:this.container},i),i.provider=new e.providers[t.providerType](t,i),i.state="loading",void i.checkRequestQueue()):(i.updateInfo("ERROR: Set a Valid Document Source.",e.INFO_TYPE.ERROR),void i.container.removeClass("df-loading").addClass("df-error"))}},{key:"initDOM",value:function(){this.element.addClass("df-app").removeClass("df-container df-loading"),this.container=Dt("<div>").appendTo(this.element),this.container.addClass("df-container df-loading df-init df-controls-"+this.options.controlsPosition+(!0===this.options.controlsFloating?" df-float":" df-float-off")+("transparent"===this.options.backgroundColor?" df-transparent":"")+(!0===this.isRTL?" df-rtl":"")+(!0===Bt.isIOS||!0===Bt.isIPad?" df-ios":"")),this._offsetParent=this.container[0].offsetParent,this.backGround=Dt("<div class='df-bg'>").appendTo(this.container).css({backgroundColor:this.options.backgroundColor,backgroundImage:this.options.backgroundImage?"url('"+this.options.backgroundImage+"')":""}),this.viewerContainer=Dt("<div>").appendTo(this.container),this.viewerContainer.addClass("df-viewer-container")}},{key:"initResourcesLocation",value:function(){var t=this.options;if(void 0!==window[e.locationVar]&&(t.pdfjsSrc=window[e.locationVar]+"js/libs/pdf.min.js",t.threejsSrc=window[e.locationVar]+"js/libs/three.min.js",t.pdfjsWorkerSrc=window[e.locationVar]+"js/libs/pdf.worker.min.js",t.soundFile=window[e.locationVar]+t.soundFile,t.imagesLocation=window[e.locationVar]+t.imagesLocation,t.imageResourcesPath=window[e.locationVar]+t.imageResourcesPath,t.cMapUrl=window[e.locationVar]+t.cMapUrl,void 0!==t.pdfVersion)){var i="";"latest"==t.pdfVersion||"beta"==t.pdfVersion?i="latest":"stable"==t.pdfVersion&&(i="stable"),("latest"==t.pdfVersion||"default"==t.pdfVersion)&&(Array.prototype.at,void 0===Array.prototype.at&&(i="stable")),"default"!==i&&""!==i&&(t.pdfjsSrc=window[e.locationVar]+"js/libs/pdfjs/"+i+"/pdf.min.js",t.pdfjsWorkerSrc=window[e.locationVar]+"js/libs/pdfjs/"+i+"/pdf.worker.min.js"),"stable"===i&&(this.options.fakeZoom=1)}this.executeCallback("onInitResourcesLocation")}},{key:"initEvents",value:function(){var e=this,t=this.container[0];window.addEventListener("resize",e.events.resize=e.resetResizeRequest.bind(e),!1),t.addEventListener("mousemove",e.events.mousemove=e.mouseMove.bind(e),!1),t.addEventListener("mousedown",e.events.mousedown=e.mouseDown.bind(e),!1),window.addEventListener("mouseup",e.events.mouseup=e.mouseUp.bind(e),!1),t.addEventListener("touchmove",e.events.touchmove=e.mouseMove.bind(e),!1),t.addEventListener("touchstart",e.events.touchstart=e.mouseDown.bind(e),!1),window.addEventListener("touchend",e.events.touchend=e.mouseUp.bind(e),!1)}},{key:"mouseMove",value:function(e){e.touches&&e.touches.length>1&&e.preventDefault(),!0===this.viewer.acceptAppMouseEvents&&this.viewer.mouseMove(e)}},{key:"mouseDown",value:function(e){this.userHasInteracted=!0,!0===this.viewer.acceptAppMouseEvents&&0===Dt(e.srcElement).closest(".df-sidemenu").length&&this.viewer.mouseDown(e)}},{key:"mouseUp",value:function(e){this.viewer&&!0===this.viewer.acceptAppMouseEvents&&this.viewer.mouseUp(e)}},{key:"softDispose",value:function(){var e=this;e.softDisposed=!0,e.provider.dispose(),e.viewer.dispose()}},{key:"softInit",value:function(){var t=this;t.viewer=new t.viewerType(t.options,this),t.provider=new e.providers[t.options.providerType](t.options,t),t.softDisposed=!1}},{key:"dispose",value:function(){var e,t,i,n,a,o=this,s=this.container[0];clearInterval(this.autoPlayTimer),this.autoPlayTimer=null,this.autoPlayFunction=null,o.provider=Bt.disposeObject(o.provider),o.contentProvider=null,o.target=null,o.viewer=Bt.disposeObject(o.viewer),o.sideMenu=Bt.disposeObject(o.sideMenu),o.ui=Bt.disposeObject(o.ui),o.thumblist=Bt.disposeObject(o.thumblist),o.outlineViewer=Bt.disposeObject(o.outlineViewer),this.events&&(window.removeEventListener("resize",o.events.resize,!1),s.removeEventListener("mousemove",o.events.mousemove,!1),s.removeEventListener("mousedown",o.events.mousedown,!1),window.removeEventListener("mouseup",o.events.mouseup,!1),s.removeEventListener("touchmove",o.events.touchmove,!1),s.removeEventListener("touchstart",o.events.touchstart,!1),window.removeEventListener("touchend",o.events.touchend,!1)),o.events=null,o.options=null,o.element.removeClass("df-app"),o.viewerType=null,o.checkRequestQueue=null,null===(e=o.info)||void 0===e||e.remove(),o.info=null,null===(t=o.loadingIcon)||void 0===t||t.remove(),o.loadingIcon=null,null===(i=o.backGround)||void 0===i||i.remove(),o.backGround=null,null===(n=o.outlineContainer)||void 0===n||n.remove(),o.outlineContainer=null,null===(a=o.commentPopup)||void 0===a||a.remove(),o.commentPopup=null,o.viewerContainer.off(),o.viewerContainer.remove(),o.viewerContainer=null,o.container.off(),o.container.remove(),o.container=null,o.element.off(),o.element.data("df-app",null),o.element=null,o._offsetParent=null,o.dimensions=null}},{key:"resetResizeRequest",value:function(){this.resizeRequestStatus=zt.COUNT,this.resizeRequestCount=0,this.container.addClass("df-pendingresize"),this.pendingResize=!0}},{key:"initInfo",value:function(){this.info=Dt("<div>",{class:"df-loading-info"}),this.container.append(this.info),this.info.html(this.options.text.loading+"..."),this.loadingIcon=Dt("<div>",{class:"df-loading-icon"}).appendTo(this.container)}},{key:"updateInfo",value:function(e,t){Bt.log(e),void 0!==this.info&&this.info.html(e)}},{key:"_documentLoaded",value:function(){Bt.log("Document Loaded"),this.isDocumentReady=!0,this.contentProvider=this.provider,this.executeCallback("onDocumentLoad"),this.endPage=this.pageCount=this.provider.pageCount,this.currentPageNumber=this.getValidPage(this.currentPageNumber)}},{key:"_viewerPrepared",value:function(){Bt.log("Viewer Prepared"),this.isViewerPrepared=!0,this.executeCallback("onViewerLoad")}},{key:"requestFinalize",value:function(){!0===this.isDocumentReady&&!0===this.isViewerPrepared&&!0===this.isExternalReady&&!0!==this.finalizeRequested&&(this.finalizeRequested=!0,this.finalize())}},{key:"finalizeComponents",value:function(){this.ui=new Ot({},this),this.ui.init(),this.calculateLayout(),this.viewer.init()}},{key:"finalize",value:function(){this.resize(),this.ui.update(),this.initEvents(),1==this.options.isLightBox&&this.analytics({eventAction:this.options.analyticsViewerOpen,options:this.options}),this.container.removeClass("df-loading df-init"),this.viewer.onReady(),this.analytics({eventAction:this.options.analyticsViewerReady,options:this.options}),this.executeCallback("onReady"),!0===this.options.dataElement.hasClass("df-hash-focused")&&(Bt.focusHash(this.options.dataElement),this.options.dataElement.removeClass("df-hash-focused")),!0===this.hashNavigationEnabled&&this.getURLHash(),Bt.log("App Finalized")}},{key:"initOutline",value:function(){var e=this,t=Dt("<div>").addClass("df-outline-container df-sidemenu");t.append('<div class="df-sidemenu-title">'+this.options.text.outlineTitle+"</div>");var i=Dt("<div>").addClass("df-wrapper");t.append(i),e.sideMenu.element.append(t),e.outlineContainer=t,e.outlineViewer=new _t({container:i[0],linkService:e.provider.linkService,outlineItemClass:"df-outline-item",outlineToggleClass:"df-outline-toggle",outlineToggleHiddenClass:"df-outlines-hidden"}),e.outlineViewer.render({outline:e.provider.outline})}},{key:"initThumbs",value:function(){var e=this;e.thumblist=new At({app:e,addFn:function(e){},scrollFn:function(){e.thumbRequestStatus=zt.ON},itemHeight:e.thumbSize,itemWidth:Bt.limitAt(Math.floor(e.dimensions.defaultPage.ratio*e.thumbSize),32,180),totalRows:e.pageCount}),e.thumblist.lastScrolled=Date.now(),e.thumbRequestStatus=zt.ON;var t=Dt("<div>").addClass("df-thumb-container df-sidemenu");t.append('<div class="df-sidemenu-title">'+this.options.text.thumbTitle+"</div>"),t.append(Dt(e.thumblist.container).addClass("df-wrapper")),e.thumbContainer=t,e.sideMenu.element.append(t),e.container.on("click",".df-thumb-container .df-thumb",(function(t){t.stopPropagation();var i=Dt(this).attr("id").replace("df-thumb","");e.gotoPage(parseInt(i,10))}))}},{key:"initSearch",value:function(){var e=this,t=Dt("<div>").addClass("df-search-container df-sidemenu");t.append('<div class="df-sidemenu-title">'+this.options.text.searchTitle+"</div>"),e.searchForm=Dt('<div class="df-search-form">').appendTo(t),e.searchBox=Dt('<input type="text" class="df-search-text" placeholder="'+this.options.text.searchPlaceHolder+'">').on("keyup",(function(t){13===t.keyCode&&e.search()})).appendTo(e.searchForm),e.searchButton=Dt('<div class="df-ui-btn df-search-btn df-icon-search">').on("click",(function(t){e.search()})).appendTo(e.searchForm),e.clearButton=Dt('<a class="df-search-clear">Clear</a>').on("click",(function(t){e.clearSearch()})).appendTo(e.searchForm),e.searchInfo=Dt('<div class="df-search-info">').appendTo(t),e.searchResults=Dt('<div class="df-wrapper df-search-results">').appendTo(t),e.searchContainer=t,e.sideMenu.element.append(t),e.container.on("click",".df-search-result",(function(t){t.stopPropagation();var i=Dt(this).data("df-page");e.gotoPage(parseInt(i,10))}))}},{key:"search",value:function(e){null==e&&(e=this.searchBox.val()),this.provider.search(e.trim())}},{key:"clearSearch",value:function(){this.searchBox.val(""),this.searchInfo.html(""),this.provider.clearSearch()}},{key:"updateSearchInfo",value:function(e){Bt.log(e),void 0!==this.searchInfo&&this.searchInfo.html(e)}},{key:"checkRequestQueue",value:function(){var e=this;if(e.checkRequestQueue&&requestAnimationFrame((function(){e&&e.checkRequestQueue&&e.checkRequestQueue()})),!e.softDisposed){if("ready"!=e.state)return"loading"===e.state&&!0===this.isDocumentReady&&!0===this.isViewerPrepared&&!0===this.isExternalReady&&(e.state="finalizing",this.finalizeComponents()),void("finalizing"===e.state&&(e.state="ready",e.finalize()));e.container&&e.container[0]&&e._offsetParent!==e.container[0].offsetParent&&(e._offsetParent=e.container[0].offsetParent,null!==e._offsetParent&&(e.resize(),e.resizeRequestStatus=zt.OFF),Bt.log("Visibility Resize Detected")),(null!==e._offsetParent||e.isFullscreen)&&(TWEEN.getAll().length>0&&(TWEEN.update(),e.renderRequestStatus=zt.ON),e.resizeRequestStatus===zt.ON?(e.resizeRequestStatus=zt.OFF,e.resize()):e.resizeRequestStatus===zt.COUNT&&(e.resizeRequestCount++,e.resizeRequestCount>10&&(e.resizeRequestCount=0,e.resizeRequestStatus=zt.ON)),e.refreshRequestStatus===zt.ON?(e.refreshRequestStatus=zt.OFF,e.pendingResize=!1,e.viewer.refresh(),this.container.removeClass("df-pendingresize")):e.refreshRequestStatus===zt.COUNT&&(e.refreshRequestCount++,e.refreshRequestCount>3&&(e.refreshRequestCount=0,e.refreshRequestStatus=zt.ON)),e.textureRequestStatus===zt.ON&&e.processTextureRequest(),e.thumbRequestStatus===zt.ON?e.processThumbRequest():e.thumbRequestStatus===zt.COUNT&&(e.thumbRequestCount++,e.thumbRequestCount>3&&(e.thumbRequestCount=0,e.thumbRequestStatus=zt.ON)),e.renderRequestStatus===zt.ON&&(e.viewer.render(),e.renderRequestStatus=zt.OFF),e.provider.checkRequestQueue(),e.viewer.checkRequestQueue())}}},{key:"processTextureRequest",value:function(){var t,i,n=this,a=this.viewer,o=this.provider,s=a.getVisiblePages().main,r=0,l=n.zoomValue>1;if(a.isAnimating()&&!0!==DEARFLIP.defaults.instantTextureProcess)n.textureRequestStatus=zt.ON;else{Bt.log("Texture Request Working");for(var h=0;h<s.length;h++){r=0;var u=s[h];if(u>0&&u<=n.pageCount&&((t=l?a.zoomViewer.getPageByNumber(u):a.getPageByNumber(u))&&(i=a.getTextureSize({pageNumber:u}),t.changeTexture(u,Math.floor(i.height))&&(o.processPage({pageNumber:u,textureTarget:l?e.TEXTURE_TARGET.ZOOM:e.TEXTURE_TARGET.VIEWER}),r++,n.viewer.getAnnotationElement(u,!0))),r>0))break}0===r&&(n.textureRequestStatus=zt.OFF)}}},{key:"applyTexture",value:function(t,i){var n=this,a=void 0!==t.toDataURL;if(i.textureTarget===e.TEXTURE_TARGET.THUMB){if(i.height=t.height,i.width=t.width,a){var o=t.toDataURL("image/png");n.provider.setCache(i.pageNumber,o,n.thumbSize),i.texture=o}else i.texture=t.src;n.thumblist.setPage(i)}else i.texture=a?t:t.src,!0===n.viewer.setPage(i)&&(n.provider.processAnnotations(i.pageNumber,n.viewer.getAnnotationElement(i.pageNumber,!0)),n.provider.processTextContent(i.pageNumber,n.viewer.getTextElement(i.pageNumber,!0)))}},{key:"processThumbRequest",value:function(){null!==this.thumblist&&void 0!==this.thumblist&&this.thumblist.processThumbRequest()}},{key:"refreshRequestStart",value:function(){this.refreshRequestStatus=zt.COUNT,this.refreshRequestCount=0}},{key:"renderRequestStart",value:function(){this.renderRequestStatus=zt.ON}},{key:"resizeRequestStart",value:function(){this.resizeRequestStatus=zt.ON}},{key:"zoom",value:function(e,t){let i=this;i.pendingZoom=!0,i.zoomDelta=e;let n=Math.min(Math.max(1,i.viewer.camera.zoom+.01*e),4);if(i.viewer.camera.zoom=n,e<0&&(i.viewer.zoomCenter=t),e>0&&n>1&&n<4){let e=getDeltaPercentage(t,screenWidth,screenHeight);i.viewer.camera.position.x+=e.x,i.viewer.camera.position.y-=e.y}else i.viewer.camera.position.x=0,i.viewer.camera.position.y=0;i.viewer.camera.updateProjectionMatrix()}},{key:"resetZoom",value:function(){1!==this.zoomValue&&(this.zoomValue=1.001,this.zoom(-1))}},{key:"calculateLayout",value:function(){var t=this,i=t.isSideMenuOpen=t.container.hasClass("df-sidemenu-open"),n=t.dimensions,a=t.dimensions.padding,o=Dt(window).height();n.offset={top:0,left:t.options.sideMenuOverlay||!i||t.isRTL?0:220,right:!t.options.sideMenuOverlay&&i&&t.isRTL?220:0,bottom:0,width:!t.options.sideMenuOverlay&&i?220:0},t.viewerContainer.css({left:n.offset.left,right:n.offset.right});var s,r,l=n.controlsHeight=t.container.find(".df-ui").height();if(a.top=t.options.paddingTop+(t.options.controlsPosition===e.CONTROLS_POSITION.TOP?l:0),a.left=t.options.paddingLeft,a.right=t.options.paddingRight,a.bottom=t.options.paddingBottom+(t.options.controlsPosition===e.CONTROLS_POSITION.BOTTOM?l:0),a.height=a.top+a.bottom,a.width=a.left+a.right,a.heightDiff=a.top-a.bottom,a.widthDiff=a.left-a.right,n.isFullSize=!0===t.isFullscreen,n.isFixedHeight=n.isFullSize||!n.isAutoHeight,n.containerWidth=n.isFullSize?Dt(window).width():this.element.width(),t.container.toggleClass("df-xs",n.containerWidth<400).toggleClass("df-xss",n.containerWidth<320),n.maxHeight=o-(n.containerWidth>600&&null!==(r=Dt(null!==(s=t.options.headerElementSelector)&&void 0!==s?s:"#wpadminbar").height())&&void 0!==r?r:0),n.isFixedHeight)if(n.isFullSize)n.maxHeight=o;else{t.element.height(t.options.height);var h=t.element.height();n.maxHeight=Math.min(h,n.maxHeight)}n.width,n.stage.innerWidth=this.viewer._getInnerWidth();var u=n.stage.innerHeight=this.viewer._getInnerHeight(),p=this.viewer._getOuterHeight(u+n.padding.height);n.containerHeight=n.isFullSize?o:p,t.element.height(n.containerHeight);var c=t.element.height();n.isFullSize||c==n.containerHeight||(n.containerHeight=c,n.stage.innerHeight=c-n.padding.height,n.stage.height=c),n.origin={x:(a.widthDiff+n.containerWidth-n.offset.left-n.offset.right)/2,y:(a.heightDiff+n.containerHeight)/2},t.viewer.determinePageMode()}},{key:"resize",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Bt.log("Resize Request Initiated");var t=this;this.calculateLayout(),t.viewer.handleZoom(),t.viewer.resize(),!1!==e&&(t.pendingZoom?(this.viewer.refresh(),Bt.log("Pending Zoom updated")):this.refreshRequestStart(),this.ui.update(),this.renderRequestStatus=zt.ON,t.zoomChanged=!1,t.pendingZoom=!1,this.executeCallback("afterResize"))}},{key:"hasOutline",value:function(){if(this.provider.outline.length>0)return!0}},{key:"switchFullscreen",value:function(){var e,t,i=this,n=i.container[0];if(i.container.toggleClass("df-fullscreen",!0!==i.isFullscreen),(null==i||null===(t=i.ui)||void 0===t||null===(e=t.controls)||void 0===e?void 0:e.fullscreen)&&i.ui.controls.fullScreen.toggleClass(i.options.icons["fullscreen-off"],!0!==i.isFullscreen),!0!==i.isFullscreen){var a=null;n.requestFullscreen?a=n.requestFullscreen():n.msRequestFullscreen?a=n.msRequestFullscreen():n.mozRequestFullScreen?a=n.mozRequestFullScreen():n.webkitRequestFullscreen&&(a=n.webkitRequestFullscreen()),a&&a.then&&a.then((function(){i.refreshRequestStatus,zt.ON,i.resize()})),i.isFullscreen=!0}else i.isFullscreen=!1,document.exitFullscreen?document.fullscreenElement&&document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),Bt.hasFullscreenEnabled()||i.container[0].scrollIntoView();Bt.hasFullscreenEnabled()||(i.resizeRequestStatus=zt.ON)}},{key:"next",value:function(){this.jumpBy(this.jumpStep)}},{key:"prev",value:function(){this.jumpBy(-this.jumpStep)}},{key:"jumpBy",value:function(e){var t=this.currentPageNumber+e;t=Bt.limitAt(t,this.startPage,this.endPage),1!=this.anyFirstPageChanged&&(this.analytics({eventAction:this.options.analyticsFirstPageChange,options:this.options}),this.anyFirstPageChanged=!0),this.gotoPage(t),this.ui.update()}},{key:"openRight",value:function(){this.isRTL?this.prev():this.next()}},{key:"openLeft",value:function(){this.isRTL?this.next():this.prev()}},{key:"start",value:function(){this.gotoPage(this.startPage)}},{key:"end",value:function(){this.gotoPage(this.endPage)}},{key:"gotoPage",value:function(e){var t=this;e=t.getValidPage(parseInt(e,10)),null!==t.viewer&&!1!==t.viewer.validatePageChange(e)&&(this.executeCallback("beforePageChanged"),t.requestDestRefKey=void 0,t.container.removeClass("df-fetch-pdf"),t.oldPageNumber=t.currentPageNumber,t.currentPageNumber=e,t.thumbRequestStatus=zt.ON,t.viewer.gotoPageCallBack&&t.viewer.gotoPageCallBack(),t.ui.update(),1==this.autoPlay&&this.setAutoPlay(this.autoPlay),!0===this.hashNavigationEnabled&&this.getURLHash(),this.executeCallback("onPageChanged"))}},{key:"gotoPageLabel",value:function(e){this.gotoPage(this.provider.getPageNumberForLabel(e.toString().trim()))}},{key:"getCurrentLabel",value:function(){return this.provider.getLabelforPage(this.currentPageNumber)}},{key:"autoPlayFunction",value:function(){this&&this.autoPlay&&(Bt.limitAt(this.currentPageNumber+this.jumpStep,this.startPage,this.endPage)!==this.currentPageNumber?this.next():this.setAutoPlay(!1))}},{key:"setAutoPlay",value:function(e){if(this.options.autoPlay){var t=(e=1==e)?this.options.text.pause:this.options.text.play;this.ui.controls.play.toggleClass(this.options.icons.pause,e),this.ui.controls.play.html("<span>"+t+"</span>"),this.ui.controls.play.attr("title",t),clearInterval(this.autoPlayTimer),e&&(this.autoPlayTimer=setInterval(this.autoPlayFunction.bind(this),this.options.autoPlayDuration)),this.autoPlay=e}}},{key:"isValidPage",value:function(e){return this.provider._isValidPage(e)}},{key:"getValidPage",value:function(e){var t=this;return isNaN(e)?e=t.currentPageNumber:e<1?e=1:e>t.pageCount&&(e=t.pageCount),e}},{key:"getURLHash",value:function(){if(null!=this.options.id){var e=Bt.getSharePrefix(this.options.sharePrefix)+(null!=this.options.slug?this.options.slug:this.options.id)+"/";null!=this.currentPageNumber&&(e+=this.currentPageNumber+"/"),history.replaceState(void 0,void 0,"#"+e)}return window.location.href}},{key:"executeCallback",value:function(e){}},{key:"analytics",value:function(e){}}],n&&Ft(i.prototype,n),a&&Ft(i,a),t}();e.prepareOptions=function(t){var i,n;i=t.element,(null!=(n=Dt)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](i):i instanceof n)||(t.element=Dt(t.element));var a=t.element;null==t.dataElement&&(t.dataElement=a);var o=t.dataElement,s=e.utils.getOptions(o),r=Dt.extend(!0,{},e.defaults,t,s);r=Bt.fallbackOptions(r),Bt.log(r);var l=Dt.extend(!0,{},e._defaults,r);return Bt.isMobile&&"function"==typeof e.viewers[l.mobileViewerType]&&(l.viewerType=l.mobileViewerType),"function"!=typeof e.viewers[l.viewerType]?l.viewerType=e.viewers.default:l.viewerType=e.viewers[l.viewerType],l=Bt.finalizeOptions(Bt.sanitizeOptions(l))},e.Application=function(t){var i=e.prepareOptions(t),n=new Ut(i);return t.element.data("df-app",n),null!=i.id&&!0!==i.isLightBox&&(window[i.id.toString()]=n),n},Dt.fn.extend({dearviewer_options:function(t){return null==t&&(t={}),t.element=Dt(this),new e.prepareOptions(t)},dearviewer:function(t){return null==t&&(t={}),t.element=Dt(this),new e.Application(t)}});var Ht=e.jQuery,Vt=window.DFLIP=window.DEARFLIP=e;Vt.defaults.viewerType="flipbook",Vt.slug="dflip",Vt.locationVar="dFlipLocation",Vt.locationFile="dflip",Vt.PAGE_MODE={SINGLE:1,DOUBLE:2,AUTO:null},Vt.SINGLE_PAGE_MODE={ZOOM:1,BOOKLET:2,AUTO:null},Vt.CONTROLSPOSITION={HIDDEN:"hide",TOP:"top",BOTTOM:"bottom"},Vt.DIRECTION={LTR:1,RTL:2},Vt.PAGE_SIZE={AUTO:0,SINGLE:1,DOUBLEINTERNAL:2},Vt.parseFallBack=function(){Ht(".df-posts").addClass("dflip-books"),Ht(".dflip-books").addClass("df-posts"),Ht("._df_button, ._df_thumb, ._df_book").each((function(){var e=Ht(this);"true"!==e.data("df-parsed")&&(e.addClass("df-element"),e.hasClass("_df_book")||(e.hasClass("_df_thumb")?(e.attr("data-df-lightbox","thumb"),void 0!==e.attr("thumb")&&e.data("df-thumb",e.attr("thumb"))):e.attr("data-df-lightbox","button")))}))},Vt.parseBooks=function(){Vt.parseFallBack(),Vt.parseElements()};var jt=function(e){var t,i;return null!=e.source&&(Array===e.source.constructor||Array.isArray(e.source)||(t=e.source,null!=(i=Array)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](t):t instanceof i))&&(e.providerType="image"),null!=e.cover3DType&&(1==e.cover3DType||"true"==e.cover3DType?e.cover3DType=Vt.FLIPBOOK_COVER_TYPE.BASIC:0!=e.cover3DType&&"false"!=e.cover3DType||(e.cover3DType=Vt.FLIPBOOK_COVER_TYPE.NONE)),void 0!==e.pageSize&&("1"===e.pageSize||1===e.pageSize||e.pageSize===Vt.FLIPBOOK_PAGE_SIZE.SINGLE?e.pageSize=Vt.FLIPBOOK_PAGE_SIZE.SINGLE:"2"===e.pageSize||2===e.pageSize||e.pageSize===Vt.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL?e.pageSize=Vt.FLIPBOOK_PAGE_SIZE.DOUBLE_INTERNAL:e.pageSize===Vt.FLIPBOOK_PAGE_SIZE.DOUBLE_COVER_BACK||(e.pageSize=Vt.FLIPBOOK_PAGE_SIZE.AUTO)),void 0!==e.pageMode&&("1"===e.pageMode||1===e.pageMode||e.pageMode===Vt.FLIPBOOK_PAGE_MODE.SINGLE?e.pageMode=Vt.FLIPBOOK_PAGE_MODE.SINGLE:"2"===e.pageMode||2===e.pageMode||e.pageMode===Vt.FLIPBOOK_PAGE_MODE.DOUBLE?e.pageMode=Vt.FLIPBOOK_PAGE_MODE.DOUBLE:e.pageMode=Vt.FLIPBOOK_PAGE_MODE.AUTO),void 0!==e.singlePageMode&&("1"===e.singlePageMode||1===e.singlePageMode||e.singlePageMode===Vt.FLIPBOOK_SINGLE_PAGE_MODE.ZOOM?e.singlePageMode=Vt.FLIPBOOK_SINGLE_PAGE_MODE.ZOOM:"2"===e.singlePageMode||2===e.singlePageMode||e.singlePageMode===Vt.FLIPBOOK_SINGLE_PAGE_MODE.BOOKLET?e.singlePageMode=Vt.FLIPBOOK_SINGLE_PAGE_MODE.BOOKLET:e.singlePageMode=Vt.FLIPBOOK_SINGLE_PAGE_MODE.AUTO),void 0!==e.controlsPosition&&"hide"===e.controlsPosition&&(e.controlsPosition=Vt.CONTROLS_POSITION.HIDDEN),void 0!==e.overwritePDFOutline&&(e.overwritePDFOutline=u.isTrue(e.overwritePDFOutline)),void 0!==e.webgl&&(e.is3D=e.webgl=e.webgl,delete e.webgl),void 0!==e.webglShadow&&(e.has3DShadow=u.isTrue(e.webglShadow),delete e.webglShadow),void 0!==e.scrollWheel&&(u.isTrue(e.scrollWheel)&&(e.mouseScrollAction=Vt.MOUSE_SCROLL_ACTIONS.ZOOM),delete e.scrollWheel),void 0!==e.stiffness&&delete e.stiffness,void 0!==e.soundEnable&&(e.enableSound=u.isTrue(e.soundEnable),delete e.soundEnable),void 0!==e.enableDownload&&(e.showDownloadControl=u.isTrue(e.enableDownload),delete e.enableDownload),void 0!==e.autoEnableOutline&&(e.autoOpenOutline=u.isTrue(e.autoEnableOutline),delete e.autoEnableOutline),void 0!==e.autoEnableThumbnail&&(e.autoOpenThumbnail=u.isTrue(e.autoEnableThumbnail),delete e.autoEnableThumbnail),void 0!==e.direction&&("2"===e.direction||2===e.direction||e.direction===Vt.READ_DIRECTION.RTL?e.readDirection=Vt.READ_DIRECTION.RTL:e.readDirection=Vt.READ_DIRECTION.LTR,delete e.direction),void 0!==e.hard&&(e.flipbookHardPages=e.hard,"hard"===e.flipbookHardPages&&(e.flipbookHardPages="all"),delete e.hard),void 0!==e.forceFit&&delete e.forceFit,u.sanitizeOptions(e)};Ht.fn.extend({flipBook:function(t,i){return null==i&&(i={}),i.source=t,i.element=Ht(this),new e.Application(i)}}),Ht(document).ready((function(){var e=Ht("body");Vt.executeCallback("beforeDearFlipInit"),void 0!==window.dFlipWPGlobal&&Ht.extend(!0,Vt.defaults,jt(window.dFlipWPGlobal)),Vt.initUtils(),Vt.initControls(),e.on("click",".df-element[data-df-lightbox],.df-element[data-lightbox]",(function(e){var t=Ht(this);e.preventDefault(),e.stopPropagation(),Vt.openLightBox(t)})),Vt.checkBrowserURLforDefaults(),Vt.parseCSSElements(),Vt.parseFallBack(),u.detectHash(),Vt.parseNormalElements(),Vt.checkBrowserURLforPDF(!0),Vt.executeCallback("afterDearFlipInit")})),u.finalizeOptions=function(e){return jt(e)},Vt.executeCallback("onDearFlipLoad")}()}();